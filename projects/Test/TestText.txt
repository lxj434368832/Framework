PDF 1.1允许文档包含Type 1和TrueType字体的子集。描述字体子集的字体和字体描述符与普通字体略有不同。这些差异允许应用程序识别字体子集，和合并包含相同字体的不同子集的文档。(有关字体描述符的更多信息，请参见5.7节“Font Descriptors”。)
对于字体子集，字体的PostScript名称(即字体的BaseFont条目的值和字体描述符的FontName条目的值)以一个标记( tag)后跟一个加号(+)开始。标记恰好由六个大写字母组成;字母的选择是任意的，但是同一个PDF文件中的不同子集必须具有不同的标记。例如，EOODIA+Poetica是Type 1字体Poetica?的一个子集名称。(见附录h中的实现说明63)
5.5.4 Type 3 Fonts
Type 3字体与PDF支持的其他字体不同。Type 3字体字典定义字体; 其他字体的字体字典简单包含有关字体的信息，并引用一个单独的字体程序来获得实际的字形描述。在Type 3字体中，字形是由PDF图形运算符流定义的。这些流与字符名相关联。一个单独的编码条目将字符编码映射到字形的适当字符名称。
类型3字体比类型1字体更灵活，因为字形描述可能包含任意PDF图形操作符。然而，Type 3字体没有提示机制来提高在小尺寸或低分辨率的输出。Type 3字体字典包含表5.9中列出的条目。
TABLE 5.9 Entries in a Type 3 font dictionary
KEY	TYPE	VALUE
Type	name	(必需)本字典描述的PDF对象类型;字体字典必须是Font。
Subtype	name	(必选)字体类型;Type3字体必须是Type3。
Name	name	(PDF 1.0必须;否则可选)见第413页表5.8。
FontBBox	rectangle	(必选)一个字形坐标系统表示的矩形(见3.8.4节“Rectangles”)，指定字体边界框。这是包围该形状的最小矩形，如果将该字体的所有字形以它们的原点重合的方式放置，然后填充该形状而拟合的结果。
如果矩形的所有四个元素都为零，则不基于字体边界框进行任何假设。如果任何元素是非零的，字体边界框必须准确。如果任何字形的标记落在这个边界框之外，可能会导致不正确的行为。
FontMatrix	array	(必选)指定字体矩阵的6个数字数组，将字形空间映射到文本空间(见第5.1.3节，“Glyph Positioning and Metrics”)。通常的做法是按照1000-unit字形坐标系统来定义字形，在这种情况下，字体矩阵为[0.001 0 0 0.001 0 0]。
CharProcs	dictionary	(必选)一个字典，其中每个键是一个字符名，与该键关联的值是一个内容流，该内容流构造和绘制该字符的字形。流的第一个操作符必须是d0或d1，后跟描述一个或多个图形对象的操作符，可能包括路径、文本或图像对象。参见下面关于Type 3字形描述的更多细节。
Encoding	name or dictionary	(必选)一个编码字典，其差异数组指定该字体的完整字符编码(见5.5.5节，“Character Encoding”;也参见附录H中的实现说明64)。
FirstChar	integer	
LastChar	integer	
Widths	array	
FontDescriptor	dictionary	
Resources	dictionary	
ToUnicode	stream	
待续...
5.5.5 Character Encoding字符编码
一个字体的编码是字符编码(从显示的文本字符串中获得)和字形描述之间的关联。本节描述简单PDF字体使用的字符编码方案。合成字体(Type 0)使用不同的字符映射算法，如第5.6节“Composite Fonts”中所述。
除了Type 3字体，每个字体程序都有一个内置的编码。在某些情况下，PDF字体字典可以更改字体的内置编码，以匹配生成显示文本的应用程序的要求。字符编码的这种灵活性有两个价值:
1.它允许显示的文本根据各种现有约定进行编码。例如，Microsoft Windows和Apple Mac OS操作系统对拉丁文本使用不同的标准编码，许多应用程序使用它们自己的特殊用途编码。
2.它允许应用程序指定如何对从大字符集中选择的字符进行编码。一些字符集包含超过256个字符，包括连字符、重音字符和其他高质量排版或非拉丁书写系统所需的符号。不同的编码可以选择同一字符集的不同子集。
Adobe Systems生产的拉丁文本字体程序使用Adobe standard encoding，通常称为StandardEncoding。StandardEncoding这个名字在PDF中没有特殊的含义，但是这个编码作为默认编码起着作用(如下面的表5.11所示)。在Mac OS和Windows系统上，用于拉丁文本字体的常规编码分别被命名为MacRomanEncoding和WinAnsiEncoding。一种名为MacExpertEncoding的编码与“专家(expert)”字体一起使用，这些字体包含对复杂的排版有用的额外字符。附录D提供了这些编码和典型字体中出现的字符的完整细节。
在PDF中，根据字体的所有字符是否都是Adobe标准拉丁字符集的成员，将其分类为非符号(nonsymbolic)或符号(symbolic)。这由字体描述符中的标志(flags)指示; 参见第5.7.1节“Font Descriptor Flags”。符号(Symbolic)字体包含其他字符集，上面提到的编码通常不适用于这些字符集。这样的字体程序有内置的编码，通常对每个字体都是唯一的。标准的14种字体包括两种符号字体Symbol和ZapfDingbats，它们的编码和字符集在附录D中有文档说明。
字体程序的内置编码可以通过在PDF字体字典中包含Encoding条目来重写或更改。可能的编码修改取决于字体类型，如下所述。Encoding条目的值是一个命名编码(预定义编码MacRomanEncoding、MacExpertEncoding或WinAnsiEncoding之一的名称)或一个编码字典。编码字典包含表5.11中列出的条目。
TABLE 5.11 Entries in an encoding dictionary
KEY	TYPE	VALUE
Type	name	(可选) 本字典描述的PDF对象类型; 如果存在，编码字典必须为Encoding。
BaseEncoding	name	(可选) 基本编码(base encoding)，即Differences条目(如果存在)描述差异的编码，指定为预定义编码MacRomanEncoding、MacExpertEncoding或WinAnsiEncoding(请参见附录D)的名称。
如果该条目不存在，则Differences条目描述与隐式基编码的差异。对于嵌入在PDF文件中的字体程序，隐式基编码是字体程序的内置编码，如上所述，并在下面的特定字体类型章节中进一步阐述。否则，对于非符号字体，它是StandardEncoding，对于符号字体，它是字体的内置编码。
Differences	Array	(可选;TrueType字体不推荐) 一个数组描述与BaseEncoding指定的编码或(如果BaseEncoding不存在)与隐式基编码的差异。下面将描述Differences数组。
Differences条目的值是一个由字符编码和字符名称组成的数组，其组织方式如下:
code1 name1,1 name1,2 …
code2 name2,1 name2,2 …
…
coden namen,1 namen,2 …
每个编码是要更改的字符编码序列中的第一个索引。编码后的第一个字符名称成为该编码对应的名称。后续名称将替换连续的编码索引，直到下一个编码出现在数组中或数组结束。这些序列可以以任何顺序指定，但不应重叠。
例如，在示例5.9的编码字典中，名称quotesingle(')与字符代码39相关联，Adieresis (?)与代码128相关联，Aring (?)与129相关联，而trademark(?)与170相关联。
Example 5.9
25 0 obj
<< /Type /Encoding
/Differences
[  39 /quotesingle
96 /grave
128 /Adieresis /Aring /Ccedilla /Eacute /Ntilde /Odieresis /Udieresis
/aacute /agrave /acircumflex /adieresis /atilde /aring /ccedilla
/eacute /egrave /ecircumflex /edieresis /iacute /igrave /icircumflex
/idieresis /ntilde /oacute /ograve /ocircumflex /odieresis /otilde
/uacute /ugrave /ucircumflex /udieresis /dagger /degree /cent
/sterling /section /bullet /paragraph /germandbls /registered
/copyright /trademark /acute /dieresis
174 /AE /Oslash
177 /plusminus
180 /yen /mu
187 /ordfeminine /ordmasculine
190 /ae /oslash /questiondown /exclamdown /logicalnot
196 /florin
199 /guillemotleft /guillemotright /ellipsis
203 /Agrave /Atilde /Otilde /OE /oe /endash /emdash /quotedblleft
/quotedblright /quoteleft /quoteright /divide
216 /ydieresis /Ydieresis /fraction /currency /guilsinglleft /guilsinglright
/fi /fl /daggerdbl /periodcentered /quotesinglbase /quotedblbase
/perthousand /Acircumflex /Ecircumflex /Aacute /Edieresis /Egrave
/Iacute /Icircumflex /Idieresis /Igrave /Oacute /Ocircumflex
241 /Ograve /Uacute /Ucircumflex /Ugrave /dotlessi /circumflex /tilde
/macron /breve /dotaccent /ring /cedilla /hungarumlaut /ogonek
/caron
]
>>
endobj
按照惯例，名称.notdef可用于表示没有字符名称与给定字符编码相关联。
Encodings for Type 1 Fonts
Type1字体程序的字形描述的键是字符名称(names),而不是字符编码(code)。字符名称通常是 PDF名称对象。对拉丁字母字符的描述通常与由单个字母(如 A 或a)组成的名称相关。其他字符与由单词(如three、ampersand或者parenleft)组成的名称相关。Type1字体的内置编码应由组成字体程序的encoding数组定义,不要将它同 PDF字体字典中的 Encoding条目相混淆。
PDF字体字典的Encoding条目可以重写 Type1字体从字符编码到字符名称的映射。Differences数组可将编码映射为存在于字体程序中的任何字形描述的名称,无论字形是由字体的内置编码引用还是由在BaseEncoding条目中指定的编码引用。 
所有Type1字体程序都应包含一个名为.notdef的实际字形。显示.notdef字形的效果由字体设计师决定。如果一个编码映射到Type1字体程序中不存在的字符名称, 则用 .notdef字形替换(substitute)。
Encodings for Type 3 Fonts
与Type 1字体一样，Type 3字体包含由字符名称键控的字形描述;在这种情况下，它们为字体的CharProcs字典中的显式键。Type 3字体从字符编码到字符名称的映射完全由它的Encoding条目定义，在在这种情况下是必需的。
Encodings for TrueType Fonts
TrueType字体程序的内置编码将字符编码直接映射到字形描述，即code==gid，通过一个称为“cmap”(不要与5.6.4“CMaps”中介绍的 CMap相混淆)的内部数据结构。本节介绍如何使用 PDF字体字典的Encoding条目结合“cmap”来将字符串中的字符编码映射为TrueType字体程序中的字形描述。 
“cmap”表可包含一个或多个子表,它们涵盖用于不同平台(如 MacOS和 Windows)的多种编码。每个子表应由两个数字标识,比如(3,1),其中一个代表平台ID,一个代表特定于平台的编码ID，如下图所示




在 TrueType字体中字形名称不是必需的,但是也有一些字体程序有一个可选的”post”表列出字形名称。如果用户应用程序需要根据名称选择字形描述,它会使用字体程序”cmap”表中给定的某个编码将字形名称转换为编码。如果在”cmap”中没有对应于某个字形名称的字符编码,则应使用”post”表直接从字形名称中选择字形描述。 
因为选择TrueType字形有时依赖于用户应用程序的实现或者操作系统,所以使用 TrueType字体的PDF文件应该遵循一些规则来确保所有应用程序的可预测行为: 
1.应当嵌入字体程序;
2.一个非符号字体(nonsymbolic)宜指定 MacRomanEncoding或者 WinAnsiEncoding作为Encoding条目的值,并且没有Differences数组；
3.如果字体用于显示不使用MacRomanEncoding或者 WinAnsiEncoding的字形,则不宜指定它的Encoding条目。宜设置字体描述符的符号标志(参见表5.20),而且字体程序的”cmap”表要包含(1,0)子表。它还可能包含(3,0)子表,如果存在,该子表宜映射从0xF000到0xF0FF的字符编码,方法是使用0xF0预先代替(1,0)子表中的单字节代码并映射到相应的字形描述。
注:一些常见的 TrueType字体程序包含错误的编码信息。TrueType字体解释器的实现发展了试探法来解决此类问题,但此处不对这些试探法进行介绍。为了最大程度地实现便携性,PDF文件宜使用组织良好的TrueType字体程序。因此,可对PDF文件中的TrueTyp字体程序进行修改以遵循这些规则。
以下几段介绍从 PDF1.3中开始的TrueType字体编码处理，在Acrobat5.0和后续的查看器中实现。这些信息并不一定适用于早期的版本或实现。
如果字体有一个名为 Encoding的条目(MacRomanEncoding或者 WinAnsiEncoding),或者如果设置了字体描述符的非符号标志（Nonsymbolic flag）(见表5.20)，符合本部分的阅读器应创建一个映射字符编码到字形名称的表。
1.如果Encoding条目为MacRomanEncoding或者WinAnsiEncoding,则应使用附录D介绍的映射初始化表;
2.如果Encoding条目是一个字典,则应使用字典的BaseEncoding条目(见表5.11)初始化表。Differences数组中的所有条目都应被用来更新表。最后,表中未定义的任何条目都应使用StandardEncoding填充。
如果一个(3,1)“cmap”子表(Microsoft Unicode)存在: 
1.首先使用上述的表将字符编码映射为字形名称;
2.然后通过查询 Adobe Glyph List(参见参考文献)将字形名称映射为Unicode值;
3.最后根据(3,1)子表将Unicode值映射为一个字形描述(glyph index)。

如果(3,1)子表不存在,而(1,0)子表(Macintosh Roman)存在:
1.首先使用上述的表将字符编码映射为字形名称;
2.然后根据 MacOS上使用的标准Roman编码将字形名称映射回字符编码(如下注意所述); 
3.最后根据(1,0)子表将编码映射为字形描述(GID)。 
在上述情况下,如果不能按指定方式映射字形名称,应在字体程序的“post”表(如果存在一个)中查找字形名称,且应使用相关的字形描述。 
注意：MacOS上使用的标准Roman编码与附录D中介绍的MacRomanEncoding相同,增加了以下15个条目，并且使用欧元字形替换货币字形，如表5.12所示:
TABLE 5.12 Differences between MacRomanEncoding and Mac OS Roman encoding
NAME	CODE (OCTAL)	CODE (DECIMAL)
notequal	255	173
infinity	260	176
lessequal	262	178
greaterequal	263	179
partialdiff	266	182
summation	267	183
product	270	184
pi	271	185
integral	272	186
Omega	275	189
radical	303	195
approxequal	305	197
Delta	306	198
lozenge	327	215
Euro	333	219
apple	360	240

如果字体没有Encoding条目,或者设置了字体描述的symbol(这种情况下Encoding条目被忽略),应出现以下情况: 
1.如果字体包含(3,0)子表,则字符编码的范围应为以下四种结果之一: 0x0000-0x00FF、0xF000-0xF0FF、0xF100-0xF1FF或者0xF200-0xF2FF。根据编码的范围不同,字符串中的每个字节都应是高字节优先,形成一个双字节字符,并将其用于从子表中选择相关的字形描述;
2.否则,如果字体包含一个(1,0)子表,应使用字符串中的单字节来在子表中查找相关的字形描述。
如果不能以上述任何方式映射字符,则结果依赖于实现。
5.6 Composite Fonts合成字体
合成字体，也称为Type0字体，是一种其字形从称为CIDFont的类似字体对象中获得。合成字体由一个其Subtype值是Type0的字体字典表示。Type 0字体称为根字体(root font)，其关联的CIDFont称为其后代(descendant,使用DescendantFonts条目进行关联)。
注意:PDF中的合成字体类似于PostScript中的合成字体，但有一些限制。特别是，PDF要求字符编码由CMap(下面将进行描述)定义，这只是PostScript中可用的几种编码方法之一。此外，PostScript允许Type 0字体有多个后代，这些后代也可能是Type 0字体。PDF只支持一个后代，这后代必须是一个CIDFont。
当字体是合成字体时，文本显示操作符的行为与简单字体不同。对于简单字体，要显示的字符串的每个字节选择一个字形，而对于合成字体，可以对一个或多个字节序列进行解码，然后从后代CIDFont中选择一个字形。这个工具支持使用非常大的字符集，比如用于中文、日文和韩文的字符集(CJK)。它还简化了具有复杂编码要求的字体的组织。
本节首先介绍CID-keyed fonts的架构，这是PDF中支持的唯一一种合成字体。然后描述CIDFont和CMap字典，它们是PDF对象，代表CID-keyed font对应的命名组件。最后，描述了Type0字体字典，它结合了CIDFont和CMap来产生一种字体，这种字体的字形可以通过显示的字符串中的可变长度字符编码来访问。
5.6.1CID-Keyed Fonts Overview(CID字体概述)
CID-keyed字体为定义多字节字符编码、具有大量字形的字体以及合并从其他字体获得的字形的字体提供了一种方便而有效的方法。这些功能为在具有大字符集的语言(如中文、日文和韩文CJK)的书写系统中表示文本提供了极大的灵活性。
CID-keyed字体架构指定了特定字体程序的外部表示，称为CMap和CIDFont文件，以及一些组合和使用这些文件的约定。如前所述，PDF不支持整个CID-keyed字体架构，这是独立于PDF的; CID-keyed字体可以在其他环境中使用。架构和文件格式的完整文档，请参见Adobe Technical Notes #5092, CID-Keyed Font Technology Overview，和Adobe CMap and CIDFont Files Specification。本节仅描述表示这些字体程序的PDF对象。
术语CID-keyed字体反映了CID(character identifier)数字用于索引和访问字体中的字形描述的事实。对于大字体，这种方法比通过字符名访问的方法(如用于一些简单字体)更有效。CIDs的范围从0到受实现限制的最大值(见第992页的表C.1)。
一个字符集(character collection)是支持特定语言的一个或多个流行字符集所需的所有字形的有序集合。字符集中字形的顺序决定了每个字形的CID编号。每个CID-keyed字体必须显式引用其CID编号所基于的字符集;参见第5.6.2节“CIDSystemInfo Dictionaries”。
一个CMap(character map)文件指定字符编码和用于标识字形的CID数字之间的对应关系。它相当于简单字体中的编码概念。一个简单的字体允许一次最多编码和访问256个字形，而CMap可以描述从多字节代码到大型CID-keyed字体中的数千个字形的映射。例如，它可以描述Shift-JIS，日语中几种广泛使用的编码之一。
一个CMap可以引用整个字符集、子集或多个字符集。它也可以通过字符编码或字符名称引用其他字体中的字符。CMap映射产生一个字体编号(font number，在PDF中总是0)和字符选择器(character selector，在PDF中总是CID)。此外，一个CMap可以通过引用合并另一个CMap，而不必复制它。这些特性允许组合或补充字符集合，并使所有组成的字符通过单一编码被文本显示操作符访问。
一个CIDFont文件包含一个字符集的字形描述。字形描述本身的格式通常与Type 1等简单字体中使用的格式类似。但是，它们是通过CIDs而不是名称标识的，而且它们的组织方式也不同。
在PDF中，CMap和CIDFont由PDF对象表示，如下所述。CMap和CIDFont程序本身可以通过名称引用，也可以作为流对象嵌入到PDF文件中。如前所述，外部文件格式在Adobe Technical Note #5014, Adobe CMap and CIDFont Files Specification中有记载。
因此，CID-keyed字体是CMap与包含字形描述的CIDFont的组合。它用Type 0字体表示。它包含一个值是一个CMap的Encoding条目，它的DescendantFonts条目引用将CMap结合的CIDFont字典。
5.6.2 CIDSystemInfo Dictionaries(CIDSystemInfo字典)
CIDFont和CMap字典包含一个CIDSystemInfo条目，该条目指定与CMap相关联的CIDFont所假定的字符集，即CIDFont所使用的CID编号的解释。字符集由CIDSystemInfo字典中的Registry、Ordering和Supplement条目唯一标识，如表5.13所示。Registry和Ordering值相同的字符集是兼容的。
CIDFont中的CIDSystemInfo条目是一个指定CIDFont字符集的字典。CIDFont不需要包含集合中所有CIDs的字形描述;它可以包含一个子集。CMap中的CIDSystemInfo条目要么是一个字典，要么是一个字典数组，这取决于它是将编码与单个字符集关联还是与多个字符集关联;见第5.6.4节“CMaps”。
为了正确的行为，CMap的CIDSystemInfo条目应该与CIDFonts或它所使用的CIDFont兼容。如果两者不相容，产生的结果是不可预测的。
TABLE 5.13 Entries in a CIDSystemInfo dictionary
KEY	TYPE	VALUE
Registry	ASCII string	(必选) 标识字符集发行人的字符串,例如Adobe。有关分配注册标识的信息，请联系Adobe Solutions Network或咨询ASN Web site(参见参考书目)。
Ordering	ASCII string	(必选) 一个字符串，唯一命名指定的Registry内的字符集，例如Japan1。
Supplement	integer	(必选) 字符集的补充编号(supplement number)。原始字符集的补充编号为0。每当在字符集中分配额外的CIDs时，补充编号就会增加。补充不会改变字符集中现有CIDs的顺序。此值不用于确定字符集之间的兼容性。
以下为定义的CID集

5.6.3 CIDFonts
一个CIDFont程序包含使用CID作为字符选择器访问的字形描述。有两种类型的CIDFonts:
1.一个Type 0 CIDFont（CIDFontType0）包含基于adobe type 1字体格式的字形描述。
注意：术语“Type 0”应用于CIDFont时，与“Type 0 font”有不同的含义。
2.Type 2 CIDFont（CIDFontType2）包含基于TrueType字体格式的字形描述。
CIDFont字典是一个包含CIDFont程序信息的PDF对象。虽然它的Type值是Font，CIDFont字典实际上不是字体。它没有Encoding条目，不能在资源字典的Font子字典中列出，也不能用作Tf操作符的操作数。它仅用作Type 0字体的后代。Type 0字体中的CMap(通过Encoding条目指定)定义了编码，将字符编码映射到CIDFont中的CIDs。CIDFont字典中的条目如表5.14所示:
TABLE 5.14 Entries in a CIDFont dictionary
KEY	TYPE	VALUE
Type	name	(必选) 本字典描述的PDF对象类型; 必须是CIDFont字典的Font。
Subtype	name	(必选) CIDFont类型; CIDFontType0或CIDFontType2
BaseFont	name	(必选) CIDFont的PostScript名称。对于Type 0 CIDFonts，这通常是CIDFont程序中CIDFontName条目的值。对于Type 2 CIDFonts，它的派生方式与简单的TrueType字体相同; 见第5.5.2节“TrueType Fonts”。在这两种情况下，如果合适的话，名称可以有一个子集前缀; 见第5.5.3节“Font Subsets”。
CIDSystemInfo	dictionary	(必选) 一个字典，包含定义CIDFont字符集的条目。见5.6.2节表5.13。
FontDescriptor	dictionary	(必选;必须是间接引用) 一个字体描述符，描述CIDFont的默认度量，而不是它的字形宽度(见5.7节“Font Descriptors”)。
DW	integer	(可选) CIDFont中字形的默认宽度(default width,见439页“Glyph Metrics in CIDFonts”)。默认值:1000。
W	array	(可选) CIDFont中字形宽度的描述。数组的元素有一个可变的格式，可以为连续的CIDs指定单个宽度或为一系列CIDs指定一个宽度(见第439页“Glyph Metrics in CIDFonts”)。默认值:none (DW值用于所有字形)。
DW2	array	(可选;仅在CIDFonts用于垂直书写时应用) 一个由两个指定垂直书写的默认度量的数字组成的数组(见439页“Glyph Metrics in CIDFonts”)。默认值:[880 1000]。
W2	array	(可选;仅在CIDFonts用于垂直书写时应用)  CIDFont中字形垂直书写度量的描述(见439页“Glyph Metrics in CIDFonts”)。默认值:none (DW2值用于所有字形)。
CIDToGIDMap	stream or name	(可选; 仅用于Type 2 CIDFonts) 从CIDs到字形索引映射的规范。如果该值是一个流,流中的字节包含从CIDs映射到字形索引:特定CID值c的字形索引是一个存储在字节2×c和2×c + 1的2字节值,其中第一个字节是高字节。如果CIDToGIDMap的值是名称，则必须是Identity，表示CIDs和字形索引之间的映射是恒等(identity)映射。默认值:Identity。
该条目可能只出现在Type 2 CIDFont中，其关联的TrueType字体程序嵌入到PDF文件中(见下一节)。
Glyph Selection in CIDFonts
Type 0和Type 2 CIDFonts以不同的方式处理从CIDs到字形描述的映射。
对于Type 0, CIDFont程序包含由CIDs标识的字形描述。CIDFont程序通过CIDSystemInfo字典标识字符集，该字典应该简单地复制到PDF CIDFont字典中。在所有支持给定字符集的CIDFont程序中都统一解释CIDs，无论该程序是嵌入在PDF文件中还是从外部来源获得。(Code->CID)
当CIDFont包含一个以紧凑字体格式(Compact Font Format,CFF)表示的嵌入式字体程序时，字体描述符(descriptor见5.8表5.23)中的FontFile3条目可以是CIDFontType0C或OpenType。有两种情况，取决于字体程序的内容:
1.“CFF”字体程序有一个使用CIDFont操作符的顶层DICT: 通过使用CFF程序的charset table，CIDs用于确定字形程序的GID(glyph identifier)值。然后通过使用CharStrings INDEX表将GID值用于查找字形程序。虽然在许多字体中CID值和GID值是相同的，但CID和GID值可能不同。CID -> GID
2.“CFF”字体程序没有使用CIDFont操作符的顶层DICT:  CIDs直接作为GID值使用，然后使用CharStrings INDEX检索字形程序。GID=CID
对于Type 2, CIDFont程序实际上是一个TrueType字体程序，它没有本地的CIDs概念。在TrueType字体程序中，字形描述由字形索引(glyph index,GID)值标识。字形索引是字体内部的，并且从一种字体到另一种字体的定义并不一致。相反，TrueType字体程序包含一个“cmap”表，该表为一种或多种预定义编码直接提供从字符编码到字形索引的映射。(code->GID，identity表示code==GID)
TrueType字体程序以两种方式之一与CID-keyed字体架构集成，取决于字体程序是否嵌入PDF文件:
1.如果TrueType字体程序被嵌入，Type 2 CIDFont字典必须包含一个CIDToGIDMap条目，该条目将CIDs映射到该字体程序中适当的字形描述的字形索引。
2.如果TrueType字体程序没有嵌入，但是通过名称引用，Type 2 CIDFont字典不能包含CIDToGIDMap条目，因为引用外部字体程序中的字形索引是没有意义的。在这种情况下，CIDs不参与字形选择，并且只有预定义的CMap可以与此CIDFont一起使用(见第5.6.4节“CMaps”)。用户应用程序通过将预定义的CMap指定的编码字符转换为TrueType字体的“cmap”表中的字符编码来选择字形。实现这一点的方法依赖于实现。
尽管CIDs有时不用于在Type 2 CIDFont中选择字形，但它们总是用于决定字形度量，如下一节所述。
每个CIDFont必须包含CID 0的字形描述，类似于在简单字体中.notdef字符名称(见454页的“Handling Undefined Characters”)。
Glyph Metrics in CIDFonts
如第5.1.3节“Glyph Positioning and Metrics”中所讨论的，字形的宽度指的是在以水平方式书写时，字形的原点和下一个字形的原点之间的水平位移。在这种模式下，原点之间的垂直位移始终为0。CIDFont的宽度是使用CIDFont字典中的DW和W条目定义的。这些宽度必须与CIDFont程序中给出的实际宽度一致。(见附录h中的实现说明61)
DW条目定义默认宽度，用于宽度没有单独指定的所有字形。这个条目对于中文、日文和韩文字体特别有用，因为在这些字体中，许多字形具有相同的宽度。
W数组允许为单个CIDs定义宽度。数组的元素被组织成两组或三组，每组有以下两种格式之一:
c [ w1 w2 … wn ] 一个数字加一个数组
cfirst clast w    三个数字
在第一种格式中，c是一个整数，指定起始CID值;它后面是一个由n个数字组成的数组，这个数组指定从c开始的n个连续的CID的宽度。第二种格式定义相同的宽度w，对于范围从cfirst到clast的所有CIDs。
下面是一个W条目的示例:
/W [ 120 [ 400 325 500 ]
7080 8032 1000
]
在本例中，具有CIDs 120、121和122的字形分别是400、325和500个单位宽。在7080到8032范围内的CIDs 都有1000个单位的宽度。
CIDFont的字形可以在垂直书写模式中显示。(这是由关联的CMap字典中的WMode条目选择的;参阅5.6.4节，“CMaps”）要以这种方式使用，CIDFont必须定义每个字形的垂直位移向量和位置向量，位置向量与水平和垂直书写原点相关。
默认的位置向量和垂直位移向量由CIDFont字典中的DW2条目指定。DW2是两个值的数组:位置向量v的垂直分量和位移向量w1的垂直分量(见第396页图5.5)。位置向量的水平分量总是字形宽度的一半，而位移向量的水平分量总是0。例如，如果DW2条目是
/ DW2 [ 880 ?1000 ]
则一个字形的位置向量和垂直位移向量为
V = (w0 / 2, 880)
W1 = (0, -1000)
其中w0是同一字形的宽度(水平位移)。请注意，垂直分量的负值将下一个字形的原点置于当前字形之下，因为标准坐标系中的垂直坐标从下往上递增。
W2数组允许为单个CIDs 定义垂直度量。数组的元素被组织成两组或五组，每组有以下两种格式之一:
c [ w11y v1x v1y w12y v2x v2y … ]
cfirst clast w11y v1x v1y
在第一种格式中，c是一个起始CID，后面是一个包含三组数字的数组。每组由垂直位移向量w1的垂直分量(其水平分量总是0)后跟位置向量v的水平分量和垂直分量。连续组定义以c开头的连续CIDs 的垂直度量。第二种格式定义从cfirst 到clast的CIDs的范围，后跟定义此范围内所有CIDs的垂直度量的三个数字。例如:
/W2 [ 120 [ ?1000 250 772 ]
7080 8032 ?1000 500 900
]
这个W2条目定义了CID 120的字形的垂直位移向量为(0，?1000)，位置向量为(250,772)。它还将7080到8032范围内的CIDs的位移向量定义为(0，?1000)，位置向量定义为(500,900)。
5.6.4 CMaps
CMap指定从字符编码到字符选择器的映射。在PDF中，字符选择器总是CIDFont中的CIDs(如前所述，PostScript CMaps也可以使用名称或编码)。CMap的功能类似于简单字体的Encoding字典。CMap不直接引用一个特定的CIDFont; 相反，它合并到CIDFont中作为CID-keyed字体的一部分，CID-keyed字体在PDF中表示为Type 0字体字典(见5.6.5节，Type 0 Font Dictionaries)。在CMap中，字符映射根据字体编号(font number)引用关联的CIDFont，在PDF中该字体编号总是0。
注意:PDF也使用一种特殊类型的CMap来映射字符编码到Unicode值(见章节5.9.2，“ToUnicode CMaps”)。
CMap还为合并CMap的任何CIDFont指定书写模式(水平或垂直)。书写模式决定在从该字体绘制字形时使用哪些度量。(书写模式被指定为CMap的一部分，因为在某些情况下，水平和垂直书写时会使用不同的形状。在这种情况下，CMap的水平和垂直变体为给定的字符编码指定不同的CIDs。)
CMap可以通过两种方式指定:
1.作为一个名称对象标识预定义CMap，其定义为用户应用程序所知道。
2.作为一个流对象，其内容是一个CMap文件(参见附录H中的实现说明66)。
Predefined CMaps
表5.15列出了预定义CMaps的名称。这些CMaps将字符编码映射到一个单独后代CIDFont中的CIDs。名称以H结尾的CMaps指定水平书写模式; 以V结尾的指定垂直书写模式。
注意:一些CMaps定义了从Unicode编码到字符集的映射。出现在文本字符串中的Unicode值以大端顺序表示(高字节在前)。包含“UCS2”的CMap名称使用UCS-2编码;包含“UTF16”的名称使用UTF-16BE(大端)编码。
TABLE 5.15 Predefined CJK CMap names
NAME	DESCRIPTION	
Chinese (Simplified)	
GB?EUC?H	Microsoft Code Page 936 (lfCharSet 0x86)， GB 2312-80字符集，EUC-CN编码	
GB?EUC?V	GB?EUC?H的垂直版本	
GBpc?EUC?H	Mac OS, GB 2312-80字符集，EUC-CN编码, 脚本管理器代码19	
GBK?EUC?H	Microsoft Code Page 936 (lfCharSet 0x86)， GBK字符集，GBK编码	
GBKp?EUC?H	与GBK?EUC?H相同，但用比例形式替换半宽拉丁字符，并将字符代码0x24映射为美元符号($)而不是元符号(￥)	
GBK2K?H	GB 18030-2000字符集，1字节、2字节和4字节混合编码	
UniGB?UCS2?H	Adobe-GB1字符集的Unicode (UCS-2)编码
Adobe-GB1 -> Unicode (UCS-2)	
UniGB?UTF16?H	Adobe-GB1字符集的Unicode (UTF-16BE)编码;包含GB18030-2000字符集中所有字符的映射	
Chinese (Traditional)	
B5pc?H	Mac OS, Big 5字符集，Big 5编码，脚本管理器代码2	
B5pc?V	B5pc?H的垂直版本	
HKscs?B5?H	Hong Kong SCS，是对Big5字符集及编码的扩展	
ETen?B5?H	微软代码页950 (lfCharSet 0x88)，大五字符集与ETen扩展	
ETenms?B5?H	与ETen?B5?H相同，但用比例形式替换半宽拉丁字符	
CNS?EUC?H	CNS 11643-1992字符集，EUC-TW编码	
UniCNS?UCS2?H	Adobe-CNS1字符集的Unicode (UCS-2)编码	
Japanese	
EUC?H	JIS X 0208字符集，EUC-JP编码	
H	JIS X 0208字符集， ISO-2022-JP编码	
V	H的垂直版本	
Generic	
Identity?H	2字节CID的水平恒等映射;可以与使用任何Registry、Ordering和Supplement值的CIDFonts一起使用。它将从0到65535的双字节字符编码映射为相同的双字节CID值,转换过程中先解释高位字节（见下文）。	
Identity?V	Identity?H垂直版本。映射方式与Identity?H相同。	

当显示文本字符串时，可以使用Identity?H和Identity?V CMap的CIDs直接引用字形。当字体为Type 0，其Encoding条目为Identity?H或Identity?V时，将显示的字符串解释为代表CIDs的成对字节，高字节在前(code为CID)。这适用于任何CIDFont，独立于其字符集。此外，当与Type2 CIDFont配合的CIDToGIDMap条目为Identity时，2字节的CID值表示TrueType字体程序中字形描述的字形索引(GID)。只有当TrueType字体程序嵌入到PDF文件中时，这才有效。
表5.16列出了不同版本的PDF中预定义的CMaps引用的字符集。破折号(-)表示该CMap在该PDF版本中没有预定义
TABLE 5.16 Character collections for predefined CMaps, by PDF version
CMAP	PDF1.2	PDF1.3	PDF1.4	PDF1.5
Chinese (Simplified)
GB?EUC?H/V	Adobe-GB1-0	Adobe-GB1-0	Adobe-GB1-0	Adobe-GB1-0
GBpc?EUC?H	Adobe-GB1-0	Adobe-GB1-0	Adobe-GB1-0	Adobe-GB1-0
GBK?EUC?H/V	―	Adobe-GB1-2	Adobe-GB1-2	Adobe-GB1-2
Chinese (Traditional)
B5pc?H/V	Adobe-CNS1-0	Adobe-CNS1-0	Adobe-CNS1-0	Adobe-CNS1-0
HKscs?B5?H/V	―	―	Adobe-CNS1-3	Adobe-CNS1-3
ETen?B5?H/V	Adobe-CNS1-0	Adobe-CNS1-0	Adobe-CNS1-0	Adobe-CNS1-0
CNS?EUC?H/V	Adobe-CNS1-0	Adobe-CNS1-0	Adobe-CNS1-0	Adobe-CNS1-0
UniCNS?UCS2?H/V	―	Adobe-CNS1-0	Adobe-CNS1-3	Adobe-CNS1-3
Generic
Identity?H/V	Adobe-Identity-0	Adobe-Identity-0	Adobe-Identity-0	Adobe-Identity-0

如第5.6.2节“CIDSystemInfo Dictionaries”所述，字符集由registry,ordering,和supplement number标识，补充是累积的; 也就是说，高编号的补充包括低编号补充中包含的CIDs，以及一些额外的CIDs。因此，根据给定PDF版本的预定义CMaps编码的文本在支持相同或更高版本PDF的用户应用程序解释时是有效的。当由支持早期PDF版本的应用程序解释时，如果遇到未为该PDF版本预定义的CMap，那个文本会导致错误。如果遇到字符编码被添加到一个比支持的PDF版本对应的更高编号的补充中，这些编码将不显示任何字符;请参见第454页“Handling Undefined Characters”。也可参见附录H中的实现说明67。
注意:如果一个应用程序产生一个PDF文件遇到包括的文本使用来自更高编号补充的CIDs，而不是正在生成的PDF版本对应的CIDs, 应用程序应该嵌入更高编号补充的CMap而不是引用预定义的CMap (参见下一节)。
定义预定义CMap的CMap程序可以通过ASN网站获得，也可以与Ken Lunde的 《CJKV Information Processing》书一起提供。关于字符集的详细信息，包括所有CIDs的样例字形，可以在许多Adobe Technical Notes中找到。有关这些Notes和上述书的更多信息，请参阅参考书目。
freetype中的预定义编码：

Embedded CMap Files
对于没有预定义的字符编码，PDF文件必须包含定义CMap的流。除了流的标准条目(如第62页表3.4所示)，CMap流字典还包含表5.17所示的条目。流中的数据定义了从字符编码到字体编号和字符选择器的映射。数据必须遵循Adobe Technical Note #5014、Adobe CMap and CIDFont Files Specification中定义的语法。
TABLE 5.17 Additional entries in a CMap dictionary
KEY	TYPE	VALUE
Type	name	(必选) 本字典描述的PDF对象类型;CMap字典必须是CMap。(虽然在Type 0字体中该对象是一个名为Encoding条目的值，但它的类型是CMap。)
CMapName	name	(必选) CMap的PostScript名称。它应该与CMap文件中CMapName的值相同。
CIDSystemInfo	dictionary	(必选) 一个字典(见章节5.6.2，“CIDSystemInfo dictionary”)，包含定义CIDFont或与CMap相关的CIDFonts字符集的条目。
该条目的值应该与CMap文件中的CIDSystemInfo值一致。(但是，对于Identity-H或Identity-V CMaps，它不需要匹配CIDSystemInfo的值。)
WMode	integer	(可选) 一个代码，它决定了任何合并当前CMap的CIDFont的书写模式。可能的值是0表示水平，1表示垂直。默认值:0。
该条目的值应该与CMap文件中的WMode值相同。
UseCMap	name or stream	(可选) 一个预定义的CMap的名称，或一个包含CMap的流，它将被用作这个CMap的基础。这个基础允许区别地定义CMap，只指定与基础CMap不同的字符映射。

CMap Example and Operator Summary
CMap文件完整地记录在Adobe Technical Note #5014, Adobe CMap and CIDFont Files Specification。下面的CMap流对象示例演示并部分解释了CMap文件的内容。在这里包括这些材料有几个原因:
1.它记录了一些对CMap文件内容的限制，这些内容可以嵌入到PDF文件中。
2.它提供了背景知识，以帮助理解后续材料，特别是5.6.5节的“CMap映射”。
3.它是PDF特性ToUnicode CMap的基础，它是CMap文件格式的一个小扩展。这个扩展在5.9节描述，“Extraction of Text Content”。
例5.10是一个用于日文Shift-JIS编码的CMap示例。此编码中的字符编码的长度可以是1字节或2字节。这个CMap可以与CIDFont一起使用，CIDFont使用与CIDSystemInfo条目中指定的相同的CID顺序。注意，流字典中的几个条目也被复制到流数据中。
Example 5.10
22 0 obj
<< /Type /CMap
/CMapName /90ms?RKSJ?H
/CIDSystemInfo << /Registry ( Adobe )
/Ordering ( Japan1 )
/Supplement 2
>>
/WMode 0
/Length 23 0 R
>>
stream
%!PS?Adobe?3 . 0 Resource?CMap
%%DocumentNeededResources : ProcSet ( CIDInit )
%%IncludeResource : ProcSet ( CIDInit )
%%BeginResource : CMap ( 90ms?RKSJ?H )
%%Title : ( 90ms?RKSJ?H Adobe Japan1 2 )
%%Version : 10 . 001
%%Copyright : Copyright 1990?2001 Adobe Systems Inc .
%%Copyright : All Rights Reserved .
%%EndComments
/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo
3 dict dup begin
/Registry ( Adobe ) def
/Ordering ( Japan1 ) def
/Supplement 2 def
end def
/CMapName /90ms?RKSJ?H def
/CMapVersion 10 . 001 def
/CMapType 1 def
/UIDOffset 950 def
/XUID [ 1 10 25343 ] def
/WMode 0 def
4 begincodespacerange
< 00 >< 80 >
< 8140 >< 9FFC >
< A0 >< DF >
< E040 >< FCFC >
endcodespacerange
1 beginnotdefrange
< 00 >< 1F >231
endnotdefrange
100 begincidrange
< 20 >< 7D >231
< 7E >< 7E >631
< 8140 >< 817E >633
< 8180 >< 81AC >696
< 81B8 >< 81BF >741
< 81C8 >< 81CE >749
… Additional ranges …
< FB40 >< FB7E >8518
< FB80 >< FBFC >8581
< FC40 >< FC4B >8706
endcidrange
endcmap
CMapName currentdict /CMap defineresource pop
end
end
%%EndResource
%%EOF
endstream
endobj
从这个例子中可以看出，CMap文件符合PostScript语言语法; 然而，不需要一个完整的PostScript解释器来解释它。除了一些必需的样板文件外，CMap文件还包含一个或多个特殊的CMap构造操作符，它们以特定的顺序被调用。以下是这些操作符的摘要:
1.beginmap和endcmap包含了CMap的定义。
2.usecmap合并了来自另一个CMap文件的代码映射。在PDF中，其他的CMap也必须在CMap字典的UseCMap条目中被识别(见448页的表5.17)。
3.begincodespacerange和endcodespacerange定义代码空间范围(codespace ranges,有效的输入字符代码范围)，通过指定一对特定长度的代码并给出每个范围的上下限; 参见453页的“CMap Mapping”。
4.Usefont指定一个字体编号，它是随后所有字符代码映射操作的隐式操作数。在PDF中，字体编号必须为0; 因此，usefont通常不会实际出现。
5.Beginbfchar和endbfchar定义了单个输入字符编码到关联字体中的字符编码(unicode)或字符名称的映射。Beginbfrange和endbfrange对输入编码的范围做相同的操作。在PDF中，这些操作符可能不会出现在用作Type 0字体Encoding条目的CMap中; 然而，它们可能出现在ToUnicode CMap的定义中(见第5.9节，“Extraction of Text Content”)。
6.begincidchar和endcidchar定义了单个输入字符编码到关联CIDFont中的CIDs的映射。Begincidrange和endcidrange做同样的工作，但用于输入编码的范围。
7.beginnotdefchar、endnotdefchar、beginnotdefrange和endnotdefrangedefine定义notdef从字符编码到CIDs的映射。如第454页“Handling Undefined Characters”一节所述，如果正常映射产生的CID在关联的CIDFont中不存在字形，则使用notdef映射。
Adobe Technical Note #5014, Adobe CMap and CIDFont Files Specification中描述的beginrearrangedfont、endrearrangedfont、beginusmatrix和endusmatrix操作符不能用于嵌入在PDF文件中的CMap文件。
5.6.5 Type 0 Font Dictionaries
Type 0字体字典包含表5.18中列出的条目。
例5.11显示了一个引用了单个CIDFont的Type 0字体。所使用的CMap是在第442页的表5.15中列出的预定义CMap之一，并通过名称引用。
TABLE 5.18 Entries in a Type 0 font dictionary
KEY	TYPE	VALUE
Type	name	(必选) 本字典描述的PDF对象类型; 必须是字体字典的Font。
Subtype	name	(必选) 字体类型;Type 0字体必须为Type0。
BaseFont	name	(必选) 字体的PostScript名称。原则上，这是一个任意的名称，因为没有字体程序直接与Type 0字体字典关联。这里描述的约定确保了与现有Acrobat产品的最大兼容性。
如果后代是Type 0 CIDFont，这个名称应该是CIDFont的BaseFont名称，一个连字符，和Encoding条目给出的CMap名称(或CMap中的CMapName条目)的连接。如果后代是Type 2 CIDFont，这个名称应该与CIDFont的BaseFont名字相同。
Encoding	name or stream	(必选) 预定义CMap的名称或包含CMap的流，CMap将字符编码映射到字体编号和CIDs。如果后代是Type 2 CIDFont，其关联的TrueType字体程序没有嵌入到PDF文件中，Encoding条目必须是预定义的CMap名称(见第437页“Glyph Selection in CIDFonts”)。
DescendantFonts	array	(必选) 一个元素的数组，指定该Type 0字体的后代CIDFont字典。
ToUnicode	stream	(可选) 一个包含CMap文件的流，CMap将字符编码映射到Unicode值(见5.9节,“Extraction of Text Content”)。
Example 5.11
14 0 obj
<< /Type /Font
/Subtype /Type0
/BaseFont /HeiseiMin?W5?90ms?RKSJ?H
/Encoding /90ms?RKSJ?H
/DescendantFonts [ 15 0 R ]
>>
endobj
CMap Mapping
Type 0字体字典的Encoding条目指定了一个CMap，该CMap决定了在当前字体为Type 0字体时，文本显示操作符(例如Tj)如何解释要显示的字符串中的字节。下面的段落描述了字符串中的字符如何解码并映射到字符选择器(在PDF中必须始终是CIDs)。
CMap中的codespace范围(由begincodespacerange和endcodespacerange分隔)确定了每个连续字符代码从字符串中提取的字节数。codespace范围是由一对特定长度的代码指定的，这对代码给出了该范围的上下限。如果代码的长度与边界代码的长度相同，并且其每个字节的值位于上下界对应的字节里面，则认为该代码匹配该范围。代码长度不能超过整数中可表示的字节数(参见附录C)。
从字符串中提取一个或多个字节的序列，并根据CMap中的codespace范围进行匹配。也就是说，第一个字节匹配1-byte的codespace范围;如果没有找到匹配，则提取第二个字节，并2-byte codespace范围匹配2-byte代码。此过程将继续处理连续较长的代码，直到找到匹配或测试了所有codespace范围。最多有一个匹配，因为codespace范围不重叠。
从字符串中提取的编码将在字符编码映射中查找该长度的编码。(这些映射是由beginbfchar、endbfchar、begincidchar、endcidchar以及这些范围对应的操作符定义。)如果做不到这一点，则在notdef映射中查找它，如下一节所述。
CMap映射算法的结果是一个字体号和一个字符选择器。字体编号用作Type 0字体的DescendantFonts数组的索引来选择一个CIDFont。在PDF中，字体编号总是0，字符选择器总是一个CID;这是这里描述的唯一一种情况。 CID然后被用来在CIDFont中选择一个字形。如果CIDFont不包含该CID的字形，则会参考notdef映射，如下一节所述。
Handling Undefined Characters
CMap映射操作可能由于各种原因无法选择字形。本节将描述这些原因以及它们发生时的情况。
如果编码映射到后代CIDFont中不存在此类字形的CID，则参考CMap中的notdef映射以获得替代字符选择器。这些映射(这类似于简单字体中的.notdef字符机制)由操作符beginnotdefchar、endnotdefchar、beginnotdefrange和endnotdefrange分隔。它们总是映射到一个CID。如果找到匹配的notdef映射，CID在关联的后代(它必须是CIDFont)中选择一个字形。如果该CID不存在字形，则用CID 0的字形(这是必需出现的)替换。
如果CMap不包含编码的字符映射或notdef映射，则选中后代0，用关联的CIDFont的CID 0的字形替换。
如果编码无效――即从要显示的字符串中提取的字节与CMap中的任何codespace范围不匹配――则按照刚才描述的方式选择替代字形(substitute glyph)。字符映射算法被重置到其在字符串中的原始位置，一个改进的映射算法选择最佳的部分来匹配codespace范围:
1.如果从要显示的字符串中提取的第一个字节与任何codespace范围的第一个字节不匹配，则选择具有最短编码的范围。
2.否则(也就是说，如果有部分匹配)，对于提取的每个附加字节，到目前为止累积的编码将与所有较长的codespace范围的开头进行匹配，直到找到最长的部分匹配为止。如果多个codespace范围具有相同长度的部分匹配，则选择编码最短的那个。
所选codespace范围内的编码长度决定了当前映射操作从字符串中消耗的字节总数。
5.7 Font Descriptors字体描述
字体描述符(font descriptor)作为一个整体指定简单字体或CIDFont的度量和其他属性，与单个字形的度量不同。这些字体度量提供的信息使用户应用程序能够在字体程序不可用时合成替代(substitute)字体或选择类似的字体。字体描述符也可以用于将字体程序嵌入到PDF文件中。
Type 0字体不使用字体描述符。从PDF 1.5开始，在Tagged PDF文档中的Type 3字体可以使用字体描述符(见第10.7节，“Tagged PDF”)。
字体描述符是一个字典，它的条目指定各种字体属性。表5.19列出了简单字体和CIDFont的所有字体描述符的共同条目。CIDFont的字体描述符中的其他条目在章节5.7.2“Font Descriptors for CIDFonts”中描述。所有整数值都是字形空间中的单位。从字形空间到文本空间的转换在第5.1.3节“Glyph Positioning and Metrics”中进行了描述。
TABLE 5.19 Entries common to all font descriptors
KEY	TYPE	VALUE
Type	name	(必选) 本字典描述的PDF对象类型;对于字体描述符必须是FontDescriptor
FontName	name	(必选) 字体的PostScript名称。该名称应该与引用该字体描述符的字体或CIDFont字典中的BaseFont的值相同。
FontFamily	Byte string	(可选;PDF 1.5;强烈推荐用于Tagged PDF文档中的Type 3字体) 一个字节字符串指定首选字体族的名称。例如，对于Times Bold Italic字体，FontFamily值为Times。
FontStretch	name	(可选;PDF 1.5; 强烈推荐用于Tagged PDF文档中的Type 3字体) 字体拉伸值。必须是以下名称之一(从窄到宽顺序):UltraCondensed, ExtraCondensed, Condensed, semi-densed, Normal, SemiExpanded, Expanded, extra-Expanded或UltraExpanded。
FontWeight	number	(可选;PDF 1.5;强烈推荐用于Tagged PDF文档中的Type 3字体) 全限定字体名称或字体说明符的粗细(厚度)分量。可能的值为100、200、300、400、500、600、700、800或900，其中每个数字表示粗细，粗细至少与其前一个数字一样暗。400表示一个正常的粗细(normal weight); 700表示加粗(bold)。
Flags	integer	(必选) 定义字体各种特征的标志集合(见章节5.7.1“Font Descriptor Flags”)。
FontBBox	rectangle	(必选，Type 3字体除外) 一个矩形(见第3.8.4节“Rectangles”)，以字形坐标系表示，指定字体边界框。这是包围形状的最小矩形，如果将该字体的所有字形以它们的原点重合的方式放置然后填充该形状 拟合的结果。
ItalicAngle	number	(必选) 倾斜角度，以字体主要垂直笔画的垂直线逆时针方向表示。(例如，9点钟方向是90度，3点钟方向是-90度。) 对于向右倾斜的字体，这个值是负的，就像几乎所有斜体字一样。
Ascent	number	(必选，Type 3字体除外) 此字体中字形所达到的高于基线的最大高度，不包括重音字符的符号高度。
Descent	number	(必选，Type 3字体除外) 此字体中字形所达到的低于基线的最大深度。取值为负数。
Leading	number	(可选) 连续文本行之间的基线间距。默认值:0。
CapHeight	number	(对于有拉丁字符的字体必须，除了Type 3字体) 平大写字母top的垂直坐标，从基线开始测量。
XHeight	number	(可选) 字体的x height：平非上升的小写字母（如字母x）top的垂直坐标，在带有拉丁字符的字体中从基线开始测量。默认值:0。
StemV	number	(必选，Type 3字体除外) 粗细，水平测量，字体中字形的主要垂直茎粗细。
StemH	number	(可选) 粗细，垂直测量，字体中字形的主要水平茎粗细。默认值:0。
AvgWidth	number	(可选) 字体中字形的平均宽度。默认值:0。
MaxWidth	number	(可选) 字体中字形的最大宽度。默认值:0。
MissingWidth	number	(可选) 用于宽度未在字体字典的Widths数组中指定的字符编码的宽度。只有当所有这些字符编码映射到的字形的实际宽度都与MissingWidth条目的值相同时，这才会有一个预测的效果。默认值:0。
FontFile	stream	(可选) 包含Type 1字体程序的流(见5.8节“Embedded Font Programs”)。
FontFile2	stream	(可选;PDF1.1) 包含TrueType字体程序的流(见5.8节“Embedded Font Programs”)。
FontFile3	stream	(可选;PDF 1.2) 包含字体程序的流，其格式由流字典中的Subtype条目指定(见表5.23和附录H中的实现说明68)。
最多只能存在FontFile、FontFile2和FontFile3中的一个条目。
CharSet	ASCII string or byte string	(可选;只有Type 1字体才有意义;PDF1.1) 列出在字体子集中定义的字符名称的字符串。该字符串中的名称必须为PDF语法――即，每个名称前面都有一个斜杠(/)。名称可以以任何顺序出现。.Notdef名称应该被省略;假定它存在于字体子集中。如果该条目不存在，字体子集的唯一指示就是FontName条目中的子集标签(见章节5.5.3，“Font Subsets”)。
5.7.1 Font Descriptor Flags 字体描述符标志
字体描述符中的Flags条目的值是一个32位无符号整数，其中包含指定字体各种特征的标志。标志字中的位位置从1(低序)到32(高序)进行编号。表5.20给出了标志的含义;所有未定义的标志位都保留，并且必须设置为0。图5.13显示了具有这些特征的字体示例。
TABLE 5.20 Font flags
BIT POSITION	NAME	MEANING
1	FixedPitch	所有的字形都有相同的宽度(相对于比例字体或可变间距字体，它们有不同的宽度)。等宽
2	Serif	字形有衬线，这是在字形茎的顶部和底部以一个角度绘制的短笔画。(无衬线字体没有衬线。)
3	Symbolic	字体包含Adobe标准拉丁字符集之外的字形。这个标志和Nonsymbolic不能同时被设置或都被清除(见下文)。符号
4	Script	字形类似草书。
6	Nonsymbolic	字体使用Adobe标准拉丁字符集或其子集(见下文)。
7	Italic	字形的主要垂直笔画是倾斜的。
17	AllCap	字体不包含小写字母; 通常用于显示目的，如标题或首行。
18	SmallCap	字体包含大写字母和小写字母。大写字母与相同字体族的常规版本中的字母相似。用于小写字母的字形具有与相应的大写字母相同的形状，但它们的大小和比例被调整，以便它们与相同字体族中的小写符号具有相同的大小和笔画粗细。
19	ForceBold	见下文。

Nonsymbolic标志(Flags条目中的第6位)表明字体字符集是Adobe标准拉丁字符集(或它的子集)，并且它使用这些字形的标准名称。这个字符集在章节D.1，“Latin Character Set and Encodings”。如果字体包含此集合之外的任何字形，则应该设置Symbolic标志并清除Nonsymbolic标志。换句话说，任何其字符集不是Adobe标准字符集子集的字体都被认为是symbolic。这会影响字体的隐式基码编码(base encoding)，并可能影响用户应用程序的字体替换策略。
FIGURE 5.13 Characteristics represented in the Flags entry of a font descriptor

注意:nonsymbolic和symbolic字体的这种分类是PDF特有的。字体可能包含在拉丁书写系统中使用但不在Adobe标准拉丁字符集中的其他字符; PDF认为这样的字体是symbolic。使用两个标志来代表一个二项选择是一个历史偶然。
ForceBold标志(第19位)决定粗体字形是否用额外的像素绘制，即使文本大小非常小。通常，当字形在非常低分辨率的设备(如显示屏)上以较小的尺寸绘制时，粗体字形的特征可能只出现1像素宽。因为这是基于像素的设备上的最小特征宽度，普通(非粗体)字形也以1像素宽的特征出现，因此无法与粗体字形区分。如果设置了ForceBold标志，粗体字形的特征可能会在较小的文本大小下加粗。
例5.12演示了一个字体描述符，它的Flags条目设置了Serif、Nonsymbolic和ForceBold标志(位2、6和19)。
Example 5.12
7 0 obj
<< /Type /FontDescriptor
/FontName /AGaramond?Semibold
/Flags 262178					% Bits 2, 6, and 19
/FontBBox [ ?177 ?269 1123 866 ]
/MissingWidth 255
/StemV 105
/StemH 45
/CapHeight 660
/XHeight 394
/Ascent 720
/Descent ?270
/Leading 83
/MaxWidth 1212
/AvgWidth 478
/ItalicAngle 0
>>
Endobj
5.7.2 Font Descriptors for CIDFonts
除了第456页表5.19中的条目外，CIDFonts的FontDescriptor字典可能包含表5.21中的条目。
TABLE 5.21 Additional font descriptor entries for CIDFonts
KEY	TYPE	VALUE
Style	dictionary	(可选) 一个包含描述该字体中字形样式的条目字典(见下面的“Style”)。
Lang	name	(可选) 一个名称，指定字体的语言，用于编码本身不暗示语言的编码。可能的值是Internet RFC 3066(Tags for the Identification of Languages,参见参考书目)定义的编码。如果没有此条目，则认为该语言是未知的。
注意:此允许语言编码规范在PDF 1.5中介绍。以前的版本支持一个子集:由ISO 639定义的2字符语言编码(见参考文献)。
FD	dictionary	(可选) 一个字典，它的键标识CIDFont中的字形的类型。每个值都是一个字典，为该类字形包含的条目将覆盖主字体描述符字典中的相应值(请参阅第462页的“FD”)。
CIDSet	stream	(可选) 一个流，标识CIDFont文件中存在哪些CIDs。如果这个条目存在，CIDFont只包含CIDSystemInfo字典定义的字符集合中字形的子集。如果没有，CIDFont子集的唯一指示是FontName条目中的子集标识(见章节5.5.3，“Font Subsets”)。
流的数据被组织成一个由CID索引的位表。位应该以高位在前的字节形式存储。每一位对应一个CID。第一个字节的最高位对应CID 0，下一位对应CID 1，依此类推。
Style
Style字典包含了定义CIDFont样式属性和值的条目。目前只定义了Panose条目。Panose的值是一个12字节的字符串，由以下元素组成:
1.字体家族类和子类ID字节，由TrueType字体的“OS/2”表的sFamilyClass字段给出。该字段记录在Microsoft’s TrueType 1.0 Font Files Technical Specification。
2.10字节表示字体的PANOSE分类号。PANOSE分类系统记录在惠普公司的PANOSE分类度量指南中。
有关这些文档的更多信息，请参阅参考书目。
以下是字体描述符中的Style条目的示例:
/Style << /Panose < 01 05 02 02 03 00 00 00 00 00 00 00 > >>
（PANOSE）一种按照字体外观来归类字体的方法
FD(font descriptors)
CIDFont可能由不同的字形类型组成，每种类型需要不同的字体宽( font-wide)属性集,这些属性集出现在字体描述符中。例如，拉丁字形可能需要不同于汉字字形的属性。字体描述符定义了应用于CIDFont中所有字形的默认属性集。字体描述符中的FD条目包含这些默认值的异常。
FD字典中每个条目的键是一个字形类(class)的名称― ―也就是说，CIDFont字符集的一个特定子集。条目的值是一个字体描述符，其内容仅覆盖该类型的字体宽(font-wide)属性。这个字体描述符应该只包含度量信息的条目;它不应该包含FontFile, FontFile2, FontFile3，或表5.21中列出的任何项。
强烈建议FD字典至少包含适当的拉丁字形的度量。有了这些字形的信息，就可以创建更准确的替代字体。
字形类(classes)的名称依赖于字符集，由CIDSystemInfo字典中的Registry, Ordering和Supplement条目标识。表5.22列出了Adobe-GB1、Adobe-CNS1、Adobe-Japan1、Adobe-Japan2和Adobe-Korea1字符集的有效键。
TABLE 5.22 Glyph classes in CJK fonts
CHARACTER COLLECTION	CLASS	GLYPHS IN CLASS
Adobe-GB1	Alphabetic
Dingbats
Generic
Hanzi
HRoman
HRomanRot
Kana
Proportional
ProportionalRot	Full-width Latin, Greek, and Cyrillic glyphs
Special symbols
Typeface-independent glyphs, such as line-drawing
Full-width hanzi (Chinese) glyphs
Half-width Latin glyphs
Same as HRoman but rotated for use in vertical writing
Japanese kana (katakana and hiragana) glyphs
Proportional Latin glyphs
Same as Proportional but rotated for use in vertical writing
Adobe-CNS1	Alphabetic
Dingbats
Generic
Hanzi
HRoman
HRomanRot
Kana
Proportional
ProportionalRot	Full-width Latin, Greek, and Cyrillic glyphs
Special symbols
Typeface-independent glyphs, such as line-drawing
Full-width hanzi (Chinese) glyphs
Half-width Latin glyphs
Same as HRoman but rotated for use in vertical writing
Japanese kana (katakana and hiragana) glyphs
Proportional Latin glyphs
Same as Proportional but rotated for use in vertical writing
Adobe-Japan1	Alphabetic
AlphaNum
Dingbats
DingbatsRot
Generic
GenericRot
HKana
HKanaRot
HRoman
HRomanRot
Kana
Kanji
Proportional
ProportionalRot
Ruby	Full-width Latin, Greek, and Cyrillic glyphs
Numeric glyphs
Special symbols
Same as Dingbats but rotated for use in vertical writing
Typeface-independent glyphs, such as line-drawing
Same as Generic but rotated for use in vertical writing
Half-width kana (katakana and hiragana) glyphs
Same as HKana but rotated for use in vertical writing
Half-width Latin glyphs
Same as HRoman but rotated for use in vertical writing
Full-width kana (katakana and hiragana) glyphs
Full-width kanji (Chinese) glyphs
Proportional Latin glyphs
Same as Proportional but rotated for use in vertical writing
Glyphs used for setting ruby (small glyphs that serve to annotate other glyphs with meanings or readings)
Adobe-Japan2	Alphabetic
Dingbats
HojoKanji	Full-width Latin, Greek, and Cyrillic glyphs
Special symbols
Full-width kanji glyphs
Adobe-Korea1	Alphabetic
Dingbats
Generic
Hangul
Hanja
HRoman
HRomanRot
Kana
Proportional
ProportionalRot	Full-width Latin, Greek, and Cyrillic glyphs
Special symbols
Typeface-independent glyphs, such as line-drawing
Hangul and jamo glyphs
Full-width hanja (Chinese) glyphs
Half-width Latin glyphs
Same as HRoman but rotated for use in vertical writing
Japanese kana (katakana and hiragana) glyphs
Proportional Latin glyphs
Same as Proportional but rotated for use in vertical writing

例5.13演示了一个包含两个条目的FD字典。
Example 5.13
/FD << /Proportional 25 0 R
/HKana 26 0 R
>>
25 0 obj
<< /Type /FontDescriptor
/FontName /HeiseiMin?W3?Proportional
/Flags 2
/AvgWidth 478
/MaxWidth 1212
/MissingWidth 250
/StemV 105
/StemH 45
/CapHeight 660
/XHeight 394
/Ascent 720
/Descent ?270
/Leading 83
>>
endobj
26 0 obj
<< /Type /FontDescriptor
/FontName /HeiseiMin?W3?HKana
/Flags 3
/AvgWidth 500
/MaxWidth 500
/MissingWidth 500
/StemV 50
/StemH 75
/Ascent 720
/Descent 0
/Leading 83
>>
endobj
5.8 Embedded Font Programs嵌入字体编程
字体程序可以作为包含在PDF流对象中的数据嵌入到PDF文件中。这样的流对象也称为字体文件(font file)，类似于从用户应用程序外部来源获得的字体程序。(参见附录h中的实现说明69)。
字体程序受版权保护，版权所有人可为字体程序设定使用条件。这些许可要么记录在字体程序中，要么作为单独许可的一部分。其中一个条件可能是字体程序不能嵌入，在这种情况下，它不应该被合并到PDF文件中。字体程序允许嵌入的唯一目的是查看和打印文档，但不允许使用该字体创建新文本或修改文本(在同一文档或其他文档中)。后一种操作要求执行该操作的用户拥有字体程序的许可副本，而不是从PDF文件中提取的副本。在没有相反的明确信息的情况下，PDF使用者应该假定任何嵌入式字体程序仅用于查看和打印文档，而不是用于任何其他目的。
表5.23总结了PDF文件中嵌入字体程序的方式，具体取决于字体程序的表示方式。关键字(key)是字体描述符(font descriptor)中用来引用字体文件流的名称; 子类型是Subtype键的值，如果存在的话，在字体文件流字典中。具体字体程序表示的进一步细节如下所示。
TABLE 5.23 Embedded font organization for various font types
KEY	SUBTYPE	DESCRIPTION
FontFile	―	Type 1字体程序，采用adobe type 1字体格式中描述的原始(非压缩)格式。该条目可以出现在Type1或MMType1字体字典的字体描述符中。
FontFile2	―	(PDF 1.1) TrueType字体程序，如TrueType参考手册所述。该条目可以出现在TrueType字体字典或(PDF1.3)CIDFontType2 CIDFont字典的字体描述符中。
FontFile3	Type1C




CIDFontType0C




OpenType
	(PDF 1.2) 在紧凑字体格式(Compact Font Format,CFF)中表示的Type 1等效字体程序，如Adobe Technical Note #5176, The Compact Font Format Specification中所述。该条目可以出现在Type1或MMType1字体字典的字体描述符中。

(PDF 1.3) 以紧凑字体格式(CFF)表示的Type 0 CIDFont程序，如Adobe Technical Note #5176, The Compact Font Format Specification中所述。这个条目可以出现在CIDFontType0 CIDFont字典的字体描述符中。

(PDF 1.6)  OpenType字体程序，如OpenType Font Specification中(见参考文献)所述。OpenType是TrueType的扩展，允许包含使用紧凑字体格式(CFF)的字体程序。
该条目可以出现在以下字体字典类型的字体描述符中:
1.一个TrueType字体字典或CIDFontType2 CIDFont字典，如果嵌入式字体程序包含一个“glyf”表。
2.一个CIDFontType0 CIDFont字典，如果嵌入式字体程序包含一个“CFF”表，带有一个使用CIDFont操作符的Top DICT(这相当于上面的子类型CIDFontType0C)。
3.一个Type1字体字典或CIDFontType0 CIDFont字典，如果嵌入式字体程序包含没有CIDFont操作符的“CFF”表。


字体文件的流字典包含流的正常条目，如Length和Filter(在62页的表3.4中列出)，再加上表5.24中列出的额外条目。
TABLE 5.24 Additional entries in an embedded font stream dictionary
KEY	TYPE	VALUE
Length1	integer	(Type 1和TrueType字体必需) Type 1字体程序(见下文)或整个TrueType字体程序在使用由流的Filter条目指定的过滤器(如果有的话)解码后的明文部分的字节长度。
Length2	integer	(Type 1字体必需) Type 1字体程序(见下文)在使用由流的Filter条目指定的过滤器进行解码后的加密部分的字节长度。
Length3	integer	(Type 1字体必需) Type 1字体程序在使用由流的Filter条目指定的过滤器解码后的固定内容部分(见下文)的字节长度。如果Length3是0，它表明512个0和cleartomark没有包含在FontFile字体程序中，并且必须添加。
Subtype	name	(如果从FontFile3中引用则必须; PDF1.2) 指定嵌入式字体程序格式的名称。对于Type1紧凑字体，名称必须为Type1C，对于Type0紧凑CIDFonts为CIDFontType0C，对于OpenType字体为OpenType。当额外的字体格式添加到PDF时，将为Subtype定义更多的值。
Metadata	stream	(可选;PDF1.4) 包含嵌入式字体程序元数据的元数据流(见10.2.2节“Metadata Streams”)。

Adobe Type 1 Font Format规范中描述的标准Type 1字体程序，由三个部分组成:明文部分(使用PostScript语法编写)、加密部分和固定内容部分。固定内容部分包含512个ASCII零，后跟一个cleartomark操作符，可能还后跟其他数据。虽然标准Type 1字体的加密部分可以是二进制或ASCII十六进制格式，但PDF只支持二进制格式。但是，整个字体程序可以使用任何过滤器进行编码。
例5.14显示了嵌入式标准Type 1字体的结构。
Example 5.14
12 0 obj
<< /Filter /ASCII85Decode
/Length 41116
/Length1 2526
/Length2 32393
/Length3 570
>>
stream
,p>`rDKJj'E+LaU0eP.@+AH9dBOu$hFD55nC
… Omitted data …
JJQ&Nt')<=^p&mGf(%:%h1%9c//K(/*o=.C>UXkbVGTrr~>
endstream
Endobj
如表5.23所示，一个相当于Type 1字体程序或Type 0 CIDFont程序可以用压缩字体格式 (CFF)表示。在这种情况下，不需要Length1、Length2和Length3条目。虽然CFF允许多个字体程序或CIDFont程序捆绑在一起在单一的文件中，嵌入式CFF字体文件在PDF中必须包含一个字体或CIDFont(符合关联的字体字典)。
注意:根据Adobe Type 1 Font Format规范，Type 1字体程序可能包含一个PaintType条目，指定字符的轮廓是填充还是描边。对于嵌入PDF文件中的字体，该条目将被忽略;是否填充或描边字形轮廓完全由PDF文本渲染模式参数决定(见章节5.2.5“Text Rendering Mode”)。这也适用于Type 1紧凑字体和Type 0紧凑CIDFonts。
TrueType字体程序可以作为字体或CIDFont的一部分使用。尽管这两种情况下的基本字体文件格式是相同的，但是对于字体程序中必须呈现的信息有不同的要求。通常需要下列TrueType表是必须的:head、hhea、loca、maxp、cvt、prep、glyf、hmtx和fpgm。如果与一个简单的字体字典一起使用，字体程序必须另外包含一个定义一种或多种编码的cmap表，如第429页的“Encodings for TrueType Fonts”中所讨论的。如果与CIDFont字典一起使用，则不需要cmap表，因为从字符编码到字形描述的映射是单独提供的。
注意:指定垂直度量的“vhea”和“vmtx”表从来不会被PDF用户应用程序使用。在PDF中指定垂直度量的唯一方法是通过CIDFont字典中的DW2和W2条目。
从PDF 1.6开始，字体程序可以使用OpenType格式嵌入，OpenType格式是TrueType格式的扩展，允许包含使用紧凑字体格式(CFF)的字体程序。它还允许包含数据来描述字形替换、字距调整和基线调整。除了呈现字形外，应用程序还可以使用OpenType字体中的数据来进行高级的行布局、自动替换连接符、向用户提供备选字形的选择以及处理复杂的书写脚本。
与TrueType一样，OpenType字体程序包含许多表，如OpenType字体规范(参见参考文献)中定义的那样。对于基于TrueType的OpenType字体，“glyf”表包含字形描述。对于基于CFF的OpenType字体，“CFF”表是一个完整的字体程序，包含字形描述。这些表，以及“cmap”表，在嵌入字体时需要出现。此外，对于基于TrueType的OpenType字体，需要“head”、“hhea”、“loca”、“maxp”、“cvt”、“prep”、“hmtx”和“fpgm”表。
注意:其他表，如用于高级行布局的表，不需要出现; 但是，它们的缺失可能会妨碍包含该字体的文本的编辑。
在OpenType字体中查找字形描述的过程如下:
1.对于使用“CFF”表的Type 1字体，过程如第428页的“Encodings for Type 1 Fonts”中所述。
2.对于使用“glyf”表的TrueType字体，过程如第429页“Encodings for TrueType Fonts”中所述。由于这个过程有时会产生不明确的结果，强烈建议PDF创建者使用带有Identity-H编码的Type 0字体，并使用字形索引作为字符代码，如第442页表5.15所述。
3.对于使用“CFF”表的CIDFontType0字体，过程如第437页“Glyph Selection in CIDFonts”中关于嵌入Type 0 CIDFonts的讨论中所述。
4.对于使用“glyf”表的CIDFontType2字体，过程如第437页“Glyph Selection in CIDFonts”中关于嵌入Type 2 CIDFonts的讨论中所述。
如第5.5.3节“Font Subsets”所述，嵌入式字体程序可能只包含PDF文档中使用的字形子集。这可以通过引用字体文件的字体描述符中出现的CharSet或CIDSet条目来表示，尽管子集字体并不总是这样标识的。
5.9 Extraction of Text Content提取文本内容
前面的部分描述了显示文本和在页面上绘制字形的所有工具。除了显示文本之外，用户应用程序有时需要确定文本的信息内容――即根据一些标准字符标识(而不是其呈现的外观)确定其含义。这种需要出现在搜索、索引和将文本导出到其他应用程序等操作期间。
Unicode标准定义了一种系统，用于对大量语言中使用的所有通用字符进行编号。它适合表示文本的信息内容，而不是其外观，因为Unicode值标识的是字符，而不是字形。有关Unicode的信息，请参阅Unicode联盟的Unicode Standard(见参考书目)。
在提取字符内容时，如果根据应用程序已知的标准字符集识别字体的字符，用户应用程序可以轻松地将文本转换为Unicode值。如果字体使用标准命名编码，或者字体中的字符由标准字符名称或知名集合中的CIDs标识，就会发生这种字符标识。章节5.9.1“Mapping Character Codes to Unicode Values”详细描述了将字符编码映射到Unicode值的整体算法。
如果一个字体没有以这些方式之一定义，字形仍然可以显示，但字符不能在没有附加信息的情况下转换为Unicode值:
1.这个信息可以在字体字典中作为一个可选的ToUnicode条目提供(PDF 1.2;查看章节 5.9.2, “ToUnicode CMaps”)。它的值是一个流对象，其中包含一种特殊的CMap文件，它将字符代码映射到Unicode值。
2.用于结构元素或标记内容序列的ActualText条目(见第10.8.3节，“Replacement Text”)可以被用来直接指定文本内容。

5.9.1 Mapping Character Codes to Unicode Values映射字符码到Unicode值
用户应用程序可以按照给定的优先级使用以下方法将字符代码映射到Unicode值。特别是带标签的PDF文档，必须至少提供其中一种方法(参见第892页的“Unicode Mapping in Tagged PDF”):
1.如果字体字典包含一个ToUnicode CMap(见章节5.9.2，“ToUnicode CMaps”)，使用该CMap将字符编码转换为Unicode。
2.如果字体是一个简单的字体,使MacRomanEncoding, MacExpertEncoding,或WinAnsiEncoding中的一个预定义的编码或者有一个编码的Differences数组只包含来自Adobe标准拉丁字符集和Symbol字体命名字符集的字符名字(见附录D):
2.1根据第996页的表D.1和字体的Differences数组将字符编码映射到字符名称。
2.2在Adobe Glyph List(请参阅参考书目)中查找字符名称以获得相应的Unicode值。
3.如果字体是一个合成字体，它使用了第442页表5.15(Identity-H和Identity-V除外)中列出的预定义CMaps之一，或者它的后代CIDFont使用了Adobe-GB1, Adobe-CNS1, Adobe-Japan1，或Adobe-Korea1字符集合:
3.1根据字体的CMap将字符代码映射到字符标识符(CID)。
3.2从它的CIDSystemInfo字典中获取字体的”cmap”使用的字符集的registry和ordering(例如，Adobe和Japan1)。
3.3通过以registry-ordering-UCS2格式连接第2步中获得的registry和ordering，构造第二个CMap名称(例如，Adobe-Japan1-UCS2)，即16位通用字符集，CIDToUnicodeMap。
3.4获得具有步骤3中构建的名称的CMap(可从ASN网站获得;查看参考书目)。
3.5根据步骤4得到的CMap映射步骤1得到的CID，得到一个Unicode值。
注意:Type 0字体的后代CIDFonts使用Adobe-GB1, Adobe-CNS1, Adobe-Japan1，或Adobe-Korea1字符集(如在CIDSystemInfo字典中指定)必须有一个补充号对应应用程序支持的PDF版本。请参见第446页的表5.16，以获得字符集合列表对应的给定PDF版本。(也可以使用这些字符集合的其他补充，但是如果补充的编号高于支持的PDF版本对应的编号，则只有后一个补充中的CIDs被认为是标准的CIDs。)
如果这些方法不能生成Unicode值，则无法确定字符代码表示什么。
5.9.2 ToUnicode CMaps
在字体字典的ToUnicode条目中定义的CMap必须遵循第5.6.4节“CMaps”中介绍的CMap语法，并完整记录在Adobe Technical Note #5014, Adobe CMap and CIDFont Files Specification中。Adobe Technical Note #5411, ToUnicode Mapping File Tutorial提供了关于本条目中定义的CMap的附加指导。这个CMap与普通的CMap在以下方面有所不同:
1.CMap流字典中唯一相关的条目(参见448页的表5.17)是UseCMap，如果CMap是基于另一个ToUnicode CMap，则可以使用UseCMap。
2.CMap文件必须包含与字体使用的编码一致的begincodespacerange和 endcodespacerange操作符。特别是，对于一个简单的字体，编码空间必须是1字节长。
3.它必须使用beginbfchar、endbfchar、beginbfrange和endbfrange操作符来定义从字符编码到以UTF-16BE编码表示的Unicode字符序列的映射。
例5.15演示了一种Type 0字体，它使用Identity?H CMap将字符编码映射到CIDs，它的后代CIDFont使用Identity将CIDs映射到TrueType字形索引。使用此字体显示的文本字符串为每个字形简单地使用一个2字节的字形索引。在没有ToUnicode条目的情况下，将无法获得有关字形含义的信息。
Example 5.15
14 0 obj
<< /Type /Font
/Subtype /Type0
/BaseFont /Ryumin?Light
/Encoding /Identity?H
/DescendantFonts [ 15 0 R ]
/ToUnicode 16 0 R
>>
endobj
15 0 obj
<< /Type /Font
/Subtype /CIDFontType2
/BaseFont /Ryumin?Light
/CIDSystemInfo 17 0 R
/FontDescriptor 18 0 R
/CIDToGIDMap /Identity
>>
Endobj
ToUnicode条目的值是一个包含CMap定义的流对象，如例5.16所示。
Example 5.16
16 0 obj
<< /Length 433 >>
stream
/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo
<< /Registry ( Adobe )
/Ordering ( UCS )
/Supplement 0
>> def
/CMapName /Adobe?Identity?UCS def
/CMapType 2 def
1 begincodespacerange
< 0000 >< FFFF >
endcodespacerange
2 beginbfrange
< 0000 >< 005E >< 0020 >
< 005F >< 0061 >[ < 00660066 > < 00660069 > < 00660066006C > ]
endbfrange
1 beginbfchar
<3A51><D840DC3E>
endbfchar
endcmap
CMapName currentdict /CMap defineresource pop
end
end
endstream
Endobj
示例5.16中的begincodespacerange和endcodespacerange操作符将源字符编码范围定义为从< 00 00 >到< FF FF >的2字节字符代码。其中显示了几个字符编码的特定映射。例如，< 00 00 >到< 00 5E >被映射到Unicode值U+0020到U+007E (Unicode值通常写成U+后跟4到6个十六进制数字)。后面是一个映射的定义，其中每个字符编码代表多个Unicode值:
< 005F > < 0061 > [ < 00660066 > < 00660069 > < 00660066006C > ]
在本例中，原始字符编码是连字ff、fi和ffl的字形索引。条目定义从字符编码< 00 5 F >, < 00 60 >,和<00 61 >映射到 Unicode值的字符串，连字的每个字符具有一个Unicode标量值:U+0066 U+0066是字符序列ff的Unicode值, U+0066 U+0069是fi的Unicode值,U+0066 U+0066 U+006c是ffl的Unicode值。
最后，字符编码< 3A 51>被映射到Unicode值U+2003E，该值由UTF-16BE编码的字节序列<D840DC3E>表示。
例5.16演示了定义目标值方式的几个扩展。为了支持从源编码映射到目标编码的字符串，下面的扩展作为范围定义在beginbfchar操作符后:
n beginbfchar
srcCode dstString
endbfchar
其中dstString最多可以是512字节的字符串。同样，beginbfrange操作符之后的映射可以定义为
n beginbfrange
srcCode1 srcCode2 dstString
endbfrange
在这种情况下，对于源编码范围中的每个连续编码，字符串的最后一个字节将递增。在定义这种类型的范围时，必须注意确保字符串中最后一个字节的值小于或等于255- (srcCode2 - srcCode1)。这确保了字符串的最后一个字节不会增加到255; 否则，映射的结果是未定义的，并且会发生错误。
为了支持从一个源字符编码范围映射到一个不连续的目标编码范围的更紧凑的表示，用于ToUnicode条目的CMaps可以使用以下语法，映射跟在beginbfrange定义之后:
n beginbfrange
srcCode1 srcCode2 [ dstString1 dstString2 … dstStringm ]
endbfrange
以srcCode1开始、以srcCode2结束的连续代码映射到数组中以dstString1开始、以dstStringm结束的目标字符串。dstString最多支持512字节的字符串。m表示源字符码范围内连续字符码的个数:
m = srcCode2 - srcCode1 + 1

CHAPTER 6 Rendering渲染
Adobe成像模型将图形(graphics，形状和颜色的规范)与呈现(rendering，控制光栅输出设备)分开。第238和239页的图4.12和4.13说明了这种划分。第4章描述了以与设备无关的方式指定页面外观的工具。本章描述控制图形和颜色如何在光栅输出设备上呈现的工具。这里讨论的所有工具都取决于输出设备的特定特性。与设备无关的PDF文档应该局限于第4章中描述的通用图形工具。
几乎所有 PDF文件控制的渲染功能都属于颜色的重现。颜色是通过如下所示的多步骤过程渲染。(根据当前的颜色空间和设备的特性，并不总是需要执行每一步。)
● 如果颜色在CIE-based颜色空间中指定(见4.5.4, “CIE-Based Color Spaces”),则首先应将其转换为光栅输出设备的原生颜色空间(又称为印刷原色模型，process color model); 
● 如果颜色在设备颜色空间中指定，但与输出设备不匹配(例如,将 RGB颜色用于 CMYK或灰度设备),则应调用颜色转换函数（color conversion function）; 
● 这时设备颜色值应通过变换函数（transfer functions）进行映射,每个颜色分量一个变换函数。变换函数针对输出设备的独特之处进行补偿,比如非线性灰度响应。本步骤有时被称为伽玛校正（gamma correction）。
● 如果设备无法重现连续色调,而只能重现某些离散颜色,如黑色像素和白色像素,则应调用半色调函数（halftone function）,通过像素底纹近似所需颜色; 
● 最后,应执行扫描转换（scan conversion）,用请求的颜色来标记光栅输出设备上合适的像素。
页面上的所有图形对象都执行完这些操作后,应使用产生的光栅数据来标记物理输出介质, 如显示器上的像素或打印页上的油墨。对于将在其上生成输出的物理介质,PDF文件可指定的属性非常少;可从以下来源获取该信息: 
● 页面字典中的媒体框和几个其他条目(见10.10.1, “Page Boundaries”); 
● 当用户请求查看或打印时引导的交互对话框; 
● 工作单（job ticket,）,无论是嵌入 PDF文件中的或是单独提供的,可指定将 PDF页面应用到介质及控制输出设备特定功能的详细指令。工作单的格式存在各种标准,其中的两个是JDF(Job Definition Format，工作定义格式) 和PJTF(Portable Job Ticket Format，可移植工作定义格式),分别在 CIP4文档JDF Specification和 Adobe技术说明#5620，Portable Job Ticket Format(见参考文献)。
本章中描述的一些渲染工具是由依赖于设备的图形状态参数控制的，列在212页的表4.3中。这些参数可以通过调用带有参数字典的gs操作符来更改，参数字典中的条目如220页表4.8所示。
6.1 CIE-Based Color to Device Color
要在输出设备上渲染CIE-based颜色,消费者应用程序应把指定的CIE-based颜色空间转换(convert)到设备的原生颜色空间(通常为DeviceGray、DeviceRGB或 DeviceCMYK),同时考虑已知的设备属性。正如 Section 4.5.4“CIE-Based Color Spaces”中所讨论, CIE-based颜色是基于人眼颜色感知模型。CIE-based颜色渲染的目标是在设备的原生颜色空间中生成的输出精确重现请求的人眼感知的CIE-based颜色值。 CIE-based颜色规范和渲染是 PDF1.1(CalGray、CalRGB和 Lab)和 PDF1.3(ICCBased)的功能。

从 CIE-based颜色到设备颜色的转换是个复杂的过程，作为转换基础的理论已经超出了本部分的范围；更多信息请参阅参考书目。算法具有很多参数,包括一个可选的全三维颜色查找表。输出的颜色保真度取决于对这些参数的正确设置,所用方法通常包括某种形式的校准。设备能生成的颜色由设备配置文件（device profile）来描述,而设备配置文件通常由与设备关联的ICC配置文件( ICC profile）指定，与在ICCBased颜色空间中指定的配置文件完全分离。
注意：PDF不具有PostScript颜色渲染字典的对等项。将设备配置文件与消费者应用程序的输出设备相关联的方法与具体实现相关,而 不 在 PDF 文 件 中 指 定。一 般 情 况 下，此 操 作 通 过 操 作 系 统 提 供 的 颜 色 管 理 系 统 (color management system，CMS)来完成。从 PDF1.4开始,PDF文件还可指定一种或多种输出意图,提供可用于处理文件的可能的配置文件(见 Section 10.10.4“Output Intents”)。
从 CIE-based颜色值到设备颜色值的转换需要两个主要操作: 
● 根据 CIE-based色域映射函数(gamut mapping function)调整CIE-based颜色值。色域(gamut)是某些颜色空间中所有可能颜色的子集。页面描述具有由它所使用的所有颜色组成的源色域。输出设备具有由它可重现的所有颜色组成的设备色域。本步骤从源色域到设备色域转换颜色,同时尝试保留颜色外观、视觉对比度或某些明确指定的渲染意图(见260页的“Rendering Intents”)。
 ● 根据CIE-based颜色映射函数生成相应的设备颜色值。对于给定的CIE-based颜色值,此函数应在设备的原生颜色空间中计算颜色值。 
仅应将CIE-based色域和颜色映射函数应用于CIE-based颜色空间中出现的颜色值。设备颜色空间中的颜色值直接控制设备颜色分量（尽管 DefaultGray、DefaultRGB和 DefaultCMYK颜色空间资源可能改变这一点，见257页的“Default Color Spaces”)。 
选择CIE-based颜色空间时,源色域应由页面描述指定。该规范与设备无关。输出设备的相应属性应由与设备关联的设备配置文件给出。色域映射和颜色映射函数是用户应用程序实现的一部分。
6.2 Conversions among Device Color Spaces设备颜色空间之间的转换
每个光栅输出设备都具有一个原生颜色空间(a native color space),通常是标准的设备颜色空间之一(DeviceGray, DviceRGB或DeviceCMYK)。也就是说,大多数设备根据灰度(单色)、RGB(红-绿-蓝)或CMYK(cyan-magenta-yellow-black,青-品红-黄-黑)模型重现颜色。如果设备支持连续色调输出,则应直接进行重现。否则应通过半色调调来完成。 
设备的原生颜色空间也被称为印刷颜色模型( process color model)。印刷原色是由一种或多种标准的印刷原色着色剂组合而生成的。在任何设备或 CIE-based颜色空间中指定的颜色都应呈现为印刷原色。设备可能还支持附加的专色着色剂,这些专色着色剂只应通过 Separation或 DeviceN 颜色空间来绘制。它们不应参与在设备或CIE-based颜色空间中的呈现,也不应受下面“注”中介绍的转换的影响。
 注:某些设备提供上述三种之外的原生颜色空间，由其他着色剂组合而成。在这种情况下, 以设备相关方式从标准设备颜色空间到设备的原生颜色空间转换。
了解了设备的原生颜色空间及其他输出功能后,用户应用程序应自动将在文件中指定的颜色值转换为适合于设备的原生颜色空间的值。例如，如果文档在DeviceRGB颜色空间中指定颜色，但设备只支持灰度(如单色显示)或CMYK(如彩色打印机)，用户应用程序执行必要的转换。如果文件直接在设备的原生颜色空间中指定颜色,则不应执行任何转换。
用于在设备颜色空间之间进行转换的算法非常简单。正如人眼所感知的那样,这些转换仅生成原颜色的粗略近似值。借助于CIE-based颜色规范和呈现,可对颜色转换实现更加精细的控制。此外,还可将设备颜色空间重新映射到CIE-based颜色空间(见257页的“Default Color Spaces”)。
6.2.1 Conversion between DeviceGray and DeviceRGB
黑色、白色和中间的灰度级可视为 RGB颜色的特例。灰度值应通过单个数值进行描述:0.0对应于黑色,1.0对应于白色,中间值对应于不同的灰度级别。
一个灰度级应等同于一个具有三个相同颜色分量的 RGB 值。也就是说, 特定灰度值的 RGB颜色值应为: 
red=gray 
green=gray 
blue=gray 
给定RGB值的灰度值应根据 NTSC视频标准进行计算,该标准确定如何在黑白电视机上呈现彩色电视信号:
 gray=0.3×red+0.59×green+0.11×blue
6.2.2 DeviceGray和 DeviceCMYK 之间的转换
在名义上,灰度是CMYK的黑色分量的补色。因此等同于特定灰度值的 CMYK 颜色值应为: 
cyan=0.0 
magenta=0.0 
yellow=0.0 
black=1.0-gray
要得到与给定CMYK值等价的灰度值,应考虑所有分量: 
gray=1.0 - min(1.0, 0.3×cyan + 0.59×magenta + 0.11×blue + black)
黑色分量与其他三个分量之间的相互作用将在6.2.3中详细阐述。
6.2.3 从 DeviceRGB到 DeviceCMYK 的转换
从 RGB到 CMYK 转换颜色值的过程包括两个步骤。第一步应将红-绿-蓝值转换为等价的青色、品红色和黄色分量,第二步应生成黑色分量并修改其他分量,以生成较为接近原颜色的近似值。
减色法原色青色、品红色和黄色是加色法原色红色、绿色和蓝色的补色。例如青色油墨减去白光的红色分量。理论上该转换非常简单:
 cyan=1.0-red 
magenta=1.0-green 
yellow=1.0-blue 
例如：由红色0.2、绿色0.7和蓝色0.4组成的颜色还可表示为1.0-0.2=0.8青色、1.0-0.7=0.3品红色和1.0-0.4= 0.6黄色。
逻辑上仅需要青色、品红色和黄色即可生成打印颜色,同等的青色、品红色和黄色应当生成同等的黑色。但实际上,彩色打印油墨不能充分混合;这样的组合往往形成深褐色阴影而不是真正的黑色。要在打印机上获取比较真实的颜色呈现效果,往往要使用真正的黑色油墨取代颜色按比例混合的黑色部分。大多数彩色打印机支持黑色分量(CMYK的K分量)。计算此分量需要一些额外步骤:
 ● 黑色生成(Black generation)计算要使用的黑色量，当尝试重现特定颜色时;
● 底色去除(Undercolor removal)减少青色、品红色和黄色的量,以补偿由黑色生成增加的黑色量。
从 RGB到 CMYK 的完整转换应遵从如下公式,其中 BG(k)和 UCR(k)分别是对黑色生成(black-generation)和底层颜色去除(undercolor-removal)函数的调用: 
c=1.0-red 
m=1.0-green 
y=1.0-blue 
k=min(c,m,y)
cyan = min(1.0, max(0.0, c - UCR(k)))
magenta = min(1.0, max(0.0, m - UCR(k)))
yellow = min(1.0, max(0.0, y - UCR(k)))
black = min(1.0, max(0.0, BG(k)))
黑色生成和底色去除函数被定义为PDF函数字典(见 3.9节“Functions”),它们是图形状态中的参数。应将其指定为图形状态参数字典中的BG 和UCR(或BG2和UCR2)条目的值(见页220，表4.8)。每个函数都应使用单个数值操作数来调用并应返回单个数值结果。
 黑色生成和底色去除这两个函数的输入都应是k,即用1.0减去最初的红色、绿色和蓝色分量而得到的中间值c、m 和y 的最小值。 在名义上,k是从青色、品红色和黄色中去除并替换为单独的黑色分量的黑色量。
黑色生成函数应作为名义k 值的函数计算黑色分量。它可简单地返回未改变的k 操作数,或者可返回表示较多黑色的较大值、表示较少黑色的较小值或表示没有黑色的0.0。 
底色去除函数应计算要从每个中间值c、m 和y 中减去的量,以生成最终的青色、品红色和黄色分量。它可简单地返回未改变的k操作数,或者可能返回0.0(表示不去除颜色),黑色量的一部分,或者甚至返回一个负数从而增加着色剂的总量。 
应用黑色生成和底色去除后得到的最终分量值介于0.0与1.0之间。如果某个值落在此范围之外,则应自动将其替换为最接近的有效值而不提示错误。前面公式中的 min和 max操作明确指示了这种替换。 
对黑色生成和底色去除函数的正确选择取决于输出设备的特性(如油墨如何混合)。每种设备应使用适合该设备的默认值进行配置。
有关透明成像模型中的黑色生成和底色去除函数作用的进一步讨论,见7.6.4节“Rendering Parameters and Transparency”，尤其是574页的“Rendering Intent and Color Conversions”。
6.2.4 从 DeviceCMYK 到 DeviceRGB的转换
从 CMYK 到 RGB的颜色值转换是一种简单操作,它不涉及黑色生成和底色去除: 			 	red = 1.0 - min(1.0, cyan + black)
Green = 1.0 - min(1.0, magenta + black)
Blue = 1.0 - min(1.0, yellow + black)
应将黑色分量加到其他分量中,然后应使用1.0减去它们,将其转换为它们的补色。
6.3 Transfer Functions变换函数
在PDF 1.2中，变换函数调整颜色分量的值，以补偿输出设备和人眼的非线性响应。设备颜色空间的每个分量(例如，DeviceRGB空间的红色组件)旨在按照分量数字值的比例表示感知到的颜色分量的亮度或强度。 然而，许多设备实际上并不是这样运行的;变换函数的目的是补偿设备的实际行为。这种操作有时被称为伽马校正(gamma correction，不要与 CIE-based色域映射函数混淆，这是CIE-based颜色渲染的一部分)。
在处理颜色的一系列步骤中,用户应用程序应在执行任何需要的颜色空间之间的转换之后、 在应用半色调函数(需要时)之前,应用变换函数。每个颜色分量应具有自己单独的变换函数;在分量之间不应存在相互作用。
变换函数应始终在输出设备的原生颜色空间中操作,而不管颜色最初指定的颜色空间。(例如,对CMYK设备,变换函数将应用于设备的青色、品红色、黄色和黑色分量,即使这些颜色最初在DeviceRGB或CalRGB颜色空间中指定。)变换函数应使用范围在0.0到1.0之间的数值操作数进行调用，并应在该范围内返回一个数值。输入应为设备原生颜色空间中的颜色分量值,要么直接指定,要么转换自某个其他颜色空间。输出应是要传送到设备(需要时进行半色调处理后)的经过转换的分量值。
转换函数的输入和输出都始终应被理解为相应颜色分量是加色的(红色、绿色、蓝色或灰色):数值越大,颜色越亮。如果颜色分量是减色的(青色、品红色、黄色、黑色或专色),则应在将其传到转换函数之前,通过从1.0减去该分量将其转换为加色的形式。函数的输出应始终为加色的形式并以该形式传递到半色调调函数。
从 PDF1.2开始,应将转换函数定义为 PDF 函数对象(见3.9节“Functions”)。有两种方式可指定转换函数:
● 图形状态中的当前转换函数（current transfer function）参数应包括单个转换函数,或四个独立转换函数的数组,其中每个函数分别对应于红色、绿色、蓝色和灰色,或者他们的补色青色、品红色、黄色和黑色。如果仅指定单个函数,则应运用于所有颜色分量。RGB设备应使用前三个转换函数,单色设备仅应使用灰色转换函数,CMYK 设备应使用全部四个转换函数。可将当前转换函数指定为图形状态参数字典中的TR或TR2条目的值;见220页的表 4.8。 
● 图形状态中的当前半色调（current halftone）参数可将转换函数指定为半色调字典中的可选条目(见 6.4.4节“Halftone Dictionaries”)。这是为非原色分量或设备原生颜色空间使用非前面所列颜色分量 设置转换函数的惟一方式。在半色调字典中指定的转换函数应覆盖由图形状态中的当前转换函数参数指定的相应转换函数。
在预期的伽马校正之外,转换函数还可用于生成多种与设备相关的特殊效果。例如，在单色设备上，PostScript计算函数
{1 exch sub}
反转输出颜色，生成页面的负再现。一般来说，这种方法不适用于彩色设备;反转可能比仅仅反转每个分量要复杂得多。因为转换函数生成与设备相关的效果,所以与设备无关的页面描述不应改变它们。
注意：在当前颜色空间为DeviceGray且输出设备的原生颜色空间为DeviceCMYK 时,用户程序仅应使用灰色转换函数。从DeviceGray到 DeviceCMYK 的正常转换生成的青色、品红色和黄色分量均为0.0。这些分量应不通过其各自的转换函数而直接呈现,产生的输出不包含彩色油墨。这种特例存在的目的,是为了与在单色设备上使用转换函数以获得特殊效果的现有应用程序相兼容,并且这种特例仅应使用于在DeviceGray颜色空间中指定的颜色。
有关透明成像模型中转换函数作用的进一步讨论,见 7.6.4节“Rendering Parameters and Transparency,”尤其是573页“Halftone and Transfer Function”。
6.4 Halftones
半色调是一种在仅可实现有限离散颜色的输出设备上模拟连续调颜色的过程。设备不能直接生成的颜色可通过使用可用颜色的像素底纹来模拟。最常见的示例可能就是利用黑白像素呈现的灰度色调,如报纸上的照片。
有些输出设备可直接重现连续调颜色。这些设备不需要半色调;由转换函数进行伽马校正后,应直接将颜色分量传送到设备。在需要半色调的设备上,该操作应在所有颜色分量由可用转换函数转换后进行。半色调函数的输入应由设备原生颜色空间中伽马校正后的连续调颜色分量组成,其输出应由设备可重现颜色的像素组成。
PDF对半色调处理的细节进行高度控制。例如，在彩色打印时,可对每种着色剂指定独立的半色调屏。在分辨率较低的显示器上呈现时,需要对半色调底纹进行精细控制,才能实现对灰度级或颜色的最佳模拟并使视觉差异最小。 
注意：根据定义半色调的一切都与设备相关。一般来说,当PDF文件提供它自己的半色调规范时,它牺牲了可移植性。与每个输出设备相关联的是一个默认的半色调定义,适用于绝大多数目的。只有相对精细的文档才需要定义它们自己的半色调,以获得特殊的效果。	
所有半色调在设备空间中定义，不受当前转换矩阵的影响。为得到正确的结果,定义新半色调的PDF文件必须假定设备空间分辨率和方向。半色调参数的最佳选择往往取决于输出设备特定物理属性,如像素形状、像素之间的重叠情况,以及电子或机械噪声的影响。
6.4.1 Halftone Screens
一般情况下,网目调方法以网屏的概念为基础,网屏将设备像素阵列划分为可通过修改以生成所需 网目调效果的单元。在概念上屏幕是通过将一致的矩形网格放置到设备像素阵列上而定义的。每个像 素属于一个网格单元;一个单元通常包含很多像素。屏幕网格整体上应在设备空间中定义且不应受对 当前转换矩阵修改的影响。

6.4.2 Spot Functions
6.4.3 Threshold Arrays
6.4.4 Halftone Dictionaries

6.5 Scan Conversion Details
渲染的最后步骤是扫描转换(scan conversion)。如2.1.4节“Scan Conversion”所述,应用程序执行扫描转换算法，在输出设备的光栅存储器中绘制图形、文本和图像。
扫描转换算法的细节不作为PDF的一部分进行定义。不同的实现方法可能以不同的方式执行扫描转换; 适合一种设备的技术可能不适合另一种设备。尽管如此,对扫描转换如何进行有一个大概的了解总是有用的,尤其是在创建用于在显示器上查看的PDF文件时。在典型的低分辨率显示器上,甚至改变一个像素的宽度都可能在所绘制形状的外观上产生显著的效果。
下面几节描述Acrobat产品的典型扫描转换算法。(这些细节也适用于PostScript产品，当应用程序在PostScript打印机上打印文档时，会产生一致的结果。)大多数扫描转换细节不在程序控制之下,但有一些例外;下面介绍控制扫描转换的参数。
6.5.1 Flatness Tolerance平坦度差
平坦度差(flatness tolerance)控制数学上正确的路径与用直线线段构造的近似值之间允许的最大距离，以设备像素为单位，如图6.6所示。平度可用操作符i的操作数(见219页的表4.7),或者图形状态参数字典中FL 条目的值 (见220表4.8)来指定。它应为正数；1:值越小,则精度越高,但计算量也大。 
注:尽管为清楚起见该图夸大了弯曲路径与平滑路径之间的差别,平坦度差的目的还是控制曲线呈现的精度,而不是绘制内接多边形。如果参数值大得足以出现可见的直线线段,则会产生不可预知的结果。

6.5.2 Smoothness Tolerance
平滑度容差(PDF1.3)用于控制平滑渐变的质量(类型2底纹和sh操作符),因而间接控制呈现性能。平滑度是用分段以线性插值近似的渐变和(可能是非线性的)渐变函数的真实值之间允许的颜色误差。应针对每个颜色分量测量该误差,并应使用最大误差值。允许的误差(或容差)应表示为颜色分量范围的小数(从0.0到1.0)。这样,平滑度容差0.1表示每个颜色分量中10%的容差。平滑度可用图形状态参数字典中SM 条目的值(见220页的表4.8)来指定。
每个输出设备在可达到的最大和最小容差上可能具有它自己的内部限制。例如，将平滑度设置为1.0在高质量的彩色设备上可能产生0.5的内部平滑度,而在同一设备上将其设置为0.0可能产生0.01的内部平滑度,如果该幅度的误差在该设备上感觉不到。
平滑度容差可能还与颜色转换的准确性相互影响。在颜色转换由采样函数定义的情况下,转换函数是未知的。因此在误差采样的频率过低时,平滑度容差定义的准确性就无法保证。但是在大多数情况下,转换函数是平滑和连续的,准确性应该在指定的容差范围内。 
平滑度容差的效果与平坦度容差的效果类似。不过,平坦度以与设备相关的像素宽度单位进行度量,而平滑度以作为颜色分量范围的小数进行度量。
6.5.3 Scan Conversion Rules扫描转换规则
以下规则确定绘制操作影响的设备像素。所有对坐标和像素的引用都在设备空间中。形状（shape）是要用当前颜色或图像进行绘制的路径(path)。将其坐标映射到设备空间,但并不四舍五入到设备像素边界。在此级别,将曲线压平为一系列直线段,并执行所有“内部”计算。
像素边界总是落在设备空间的整数坐标上。像素是一个正方形区域,由具有最小水平和垂直坐标的角所在的位置进行标识。该区域是半开(half-open)的,这意味着它仅包括其下边界而不包括其上边界。更准确地说,对于其实数坐标是(x,y)的任何点,i=floor(x),j=floor(y),包含此点的像素标识为(i,j)。属于该像素的区域被定义为点(x',y')的集合,其中i≤x'<i+1,j≤y'<j+1。与像素类似,由填充和描边操作绘制的形状也被视为半开区域,这些区域仅包括沿其“floor”侧的边界,而不包括其沿“ceil”侧的边界。
形状的扫描转换应绘制其正方形区域与该形状相交的任何像素,无论相交部分有多小。这确保了任何形状都不会因为相对于设备像素网格的不利位置而消失，而这种情况在使用其他扫描转换规则时可能会发生。由绘制像素覆盖的区域应始终至少与原始形状的区域一样大。该规则适用于填充操作和非零宽度的描边操作。零宽度描边以一种依赖于设备的方式来完成,它可能包含比规则所暗示的更少像素。
注意:一般来说,两个区域的相交被定义为其内部的相交。但是,为了扫描转换,填充区域被视为与其边界穿过的每个像素相交,即使填充区域内部为空。例如，零宽度或零高度的矩形将被绘制为1个像素宽的线条。
由采样图像绘制的设备空间区域的确定与填充形状的区域相似,但不完全相同。应用程序转换图像的源矩形到设备空间并定义一个半开区域,就和填充操作一样。但只绘制其中心位于该区域内的像素。这类像素的中心位置(也就是说其坐标值具有二分之一小数部分的点) 应被映射回源空间,从而确定如何给像素着色。对整个像素区域的着色不应取平均值。 如果源图像的分辨率高于设备空间的分辨率,可能不使用某些源采样点。
对于裁剪,裁剪区域由填充操作将包括的像素集合组成。后续绘制操作影响由剪切区域定义的像素集合与要绘制区域的像素集合形成的交集区域。
字符字形的扫描转换用与前面不同的算法进行。该字体呈现算法使用字形描述中的提示信息和专门用于字形光栅化的技术。
6.5.4 Automatic Stroke Adjustment自动描边调整
沿某个路径描边时,扫描转换算法因光栅化效果而可能生成宽度不一致的线条。一般而言,已转换到设备空间的线条宽度和端点坐标都是没有量化为设备像素的任意实数。给定宽度的线条可与不同数目的设备像素相交,这由它的位置来决定。图6.7说明了这种效果。


FIGURE 6.7 Rasterization without stroke adjustment
为了取得最佳效果,补偿光栅化效果以生成一致宽度的描边至关重要。这一点对于在低分辨率显示器上的应用尤其重要。为了满足这一需求,PDF1.2提供了一种可选的自动描边调整功能。启用描边调整时,描边的线条宽度和坐标都应根据需要自动进行调整,以生成一致宽度的线条。宽度应尽可能地接近所请求的线条宽度―――相差不超过半个像素。
在启用描边调整时,如果所请求的线条宽度(已转换到设备空间)小于半个像素,则描边应呈现为一个像素宽的线条。 注:此为可被设备分辨率呈现的最细的线条。其效果与将线条宽度设置为0时完全相同(见6.5.3 “Scan Conversion Rules”)。
由于自动描边调整能对线条外观产生显著效果,PDF提供控制是否应执行调整的方法。图形状态中的描边调整参数可指定此功能,它通过图形状态参数字典中的SA 条目进行设置(见4.3.4, “Graphics State Parameter Dictionaries”)。见附录H中的实现说明71。
CHAPTER7 Transparency透明度
PDF 1.4扩展了Adobe成像模型，包括透明度的概念。透明对象不不要遵守严格的不透明绘制模型,但可能会以有意思的方式与其他重叠对象混合(合成)在一起。本章描述了一般的透明模型,但并未涉及具体实现。在很多地方使用类似于具体实现的描述方式来介绍其工作原理,目的是为了解释模型的行为。实际的实现方式几乎肯定与这些描述暗指的方式有所不同。
本章的结构如下: 
● 7.1节“透明度概述”介绍透明模型的基本概念及其相关术语; 
● 7.2节“基本合成计算”描述将单个对象与其背景进行合成时涉及的数学运算; 
● 7.3节“透明组”介绍透明组的概念,并描述其属性和行为; 
● 7.4节“软蒙板”涵盖创建和使用蒙板来指定与位置相关的形状和不透明度; 
● 7.5节“在 PDF中指定透明度”描述在 PDF文档中如何表示透明度属性;
● 7.6节“颜色空间与呈现问题”处理透明度和颜色规范与呈现的其他方面之间一些具体的相互作用。
7.1 Overview of Transparency
原始的Adobe成像模型将对象(填充、笔画、文本和图像)以不透明的方式绘制到页面上，这些对象可能由路径剪裁。页面上任意点的颜色是最顶层包围对象的颜色,不考虑它可能重叠的任何之前的对象。此效果可(且通常)通过按指定对象的顺序将对象直接呈现在页面上来简单实现,每个对象完全覆盖与之重叠的任何其他对象。
在透明成像模型下,页面上的所有对象都可能对结果有影响。给定点的对象可被视为形成了一个透明栈(或简称栈)。这些对象应按指定的顺序从下到上排列。应根据透明模型定义的合成(compositing)规则，将堆栈中所有包围对象的颜色组合在一起，从而确定页面每个点的颜色。
注意:指定对象的顺序决定了栈的顺序,但不一定是实际在页面上绘制这些对象的顺序。具体地讲,透明模型不要求应用程序在将整个栈呈现到页面之前，立即光栅化对象或在任何时候提交光栅表示。这是很重要的，因为光栅化通常会导致信息和精度的显著损失，在透明度计算的中间阶段最好避免。
一个给定对象应与背景(backdrop)合成。通常,背景由之前指定的所有对象的栈组成。合成的结果应被视为下一个对象的背景。但在某些种类的透明组(见7.4“透明组”)中,会选择不同的背景。 
在将对象与背景合成时,每个点的颜色均应使用指定的混合模式( blend mode)进行计算,它是对象颜色和背景颜色的函数。混合模式决定了颜色如何相互作用;不同混合模式可用来实现多种有用的效果。单个混合模式对合成所有给定对象有效,但不同混合模式可应用于不同对象。
对象与背景的合成被称为形状(shape)和不透明度(opacity)的两个标量调节。在概念上,对于每个对象,这些量在平面上的每个点上定义，就像它们是额外的颜色分量一样。(实际上,它们往往从辅助源中获取,而不是对象内部的。)
形状和不透明度的值范围都是0.0(无贡献)到1.0(最大贡献)。无论在任何点,只要对象的形状或不透明度等于0.0,其颜色就应是未定义的。在形状等于0.0的点,不透明度也是未定义的。形状和不透明度应遵守合成规则;因此,栈作为一个整体,也应在每个点都拥有形状和不透明度值。
对象的不透明度与背景的不透明度结合在一起，决定了背景色、对象颜色和混合色对合成色的相对贡献。对象的形状然后决定合成颜色代替背景色的度。形状值0.0和1.0标识位于常规锐边( sharp-edged)对象的外部和内部的点;而中间的值在定义软边缘( soft-edged)的对象时有用。
形状和不透明度在概念上非常相似。实际上,通常可将它们合为( combined)一个值,被称为alpha,该值控制颜色合成计算和对象与其背景之间的淡出。然而，在一些情况下，它们必须分开处理;见7.3.5节,“Knockout Groups”。 此外，基于光栅的实现必须维护一个单独的形状参数来适当地进行反锯齿;因此将形状作为模型的显式组成部分就很方便。
栈中的一个或多个连续对象可合起来形成透明组(transparency group，通常以下简称为组)。作为整体的组可有各种属性,用来修改组内对象的合成行为和他们与背景的相互作用。附加的混合模式、形状和不透明度还可与组关联作为一个整体,并在将其与背景合成时使用。组可嵌套在其他组内,形成一个树形层次结构。
注意:透明组的概念独立于adobe illustrator?等应用程序中现有的组(group)或层(layer)的概念．这些分组反映了对象之间的逻辑关系，这些关系在编辑对象时是有意义的，但它们不是成像模型的一部分。
Plate 16展示了透明组的效果。在上面两个图中,三个彩色圆被作为独立对象进行绘制,没有分组。在左上图中,三个对象以不透明方式绘制(不透明度=1.0);每个对象将其背景(包括之前绘制的对象)完全替换成了自己的颜色。在右上图中,绘制了三个同样的独立对象,不透明度为0.5,它们彼此之间合成在一起,并与灰色和白色背景合成。在下面的两个图中,三个对象组合成一个透明组。在左下图中,独立对象在组内的不透明度为1.0,但作为整体的组以 Normal混合模式绘制,不透明度为0.5。因此对象在组内彼此完全覆盖,但生成的组则以透明方式与灰色和白色背景合成。在右下图中,对象在组内的不透明度为0.5,而且彼此合成。作为整体的组在背景上绘制,不透明度为1.0,但混合模式不同 (HardLight),生成了不同的视觉效果。
合成一个组的颜色结果可能会转换为单分量的亮度(luminosity)值,并且被视为软遮罩(soft mask)。然后可能会将此遮罩用作后续合成操作的形状或不透明度的附加源。在将该遮罩用作形状时,此技术就是已知的软裁剪(soft clipping);它是不透明成像模型中当前裁剪路径的泛化(见 4.4.3, “Clipping Path Operators”)。
当前页面(current page)的概念泛化为指透明组,它由放置在页面上的整个对象栈组成，与一个纯白色和完全不透明的背景合成。逻辑上,应对整个栈进行光栅化,以确定传给输出设备的实际像素值。
注意:在将 PDF页面视为放置在某个其他页面上(如一个插画家画板或者一个封装PostScript文件(EPS))的一个艺术品的上下文中，不是将其视为页面而是视为组,而组背景可能与页面背景有不同的定义。
7.2 Basic Compositing Computations基本合成计算
本节介绍将单个对象与它的背景合成的基本计算。这些计算将在7.4“透明组”中进行扩展,以涵盖由多个对象组成的组。
7.2.1 Basic Notation(标记) for Compositing Computations
一般来说,本章中由小写字母组成的变量名称表示标量(scalar quantity),比如不透明度。大写字母表示具有多个标量的分量值,比如颜色。在基本颜色合成计算的描述中,颜色值通常用字母C表示,带一个助记下标, 指示引用了几个颜色值中的哪一个;例如,Cs代表“source color”。形状和不透明度值分别用字母f(代表“form factor”)和q (代表“opaqueness”)表示,也带助记下标,比如qs代表“source opacity”。符号α(alpha)代表形状值与不透明度值的乘积。
在某些计算中,一个或多个变量可能有未定义的值;例如,当不透明度等于0时,相应的颜色是未定义的。如果一个量是除以0得到的，那么它也可以是未定义的。在使用此类未定义量的任何公式中,该量不会影响最终结果,因为它随后会乘以0,或被抵消。重要的一点是，虽然可以为这样一个未定义的量选择任意值，计算不应由于溢出或除0引起的异常而导致错误。也宜采纳0÷0=0的约定。
7.2.2 Basic Compositing Formula
为了适应透明度，成像模型的主要变化是如何绘制颜色。在透明模型中,绘制结果(结果颜色)是要绘制的颜色(源颜色)和在其上绘制的颜色(背景色)的函数。这两种颜色都可能按页面位置的函数变化; 但是,本节重点考虑页面上的一些固定点,并假定背景色和源颜色也是固定的。
此计算还使用另外两个参数:alpha(控制背景色和源颜色的相对贡献)和混合函数(blend function，指定在绘制操作中这两种颜色如何合成)。生成的基本颜色合成公式(或简称为基本合成公式)应确定绘制操作产生的结果色:

式中变量的含义如表 7.1所示。
TABLE 7.1 Variables used in the basic compositing formula
VARIABLE	MEANING
Cb	Backdrop color
Cs	Source color
Cr	Result color
αb	Backdrop alpha
αs	Source alpha
αr	Result alpha
B(Cb , Cs)	Blend function
此公式表示合成公式的简化形式,其中形状值和不透明度值结合在一起,表示为一个alpha值;后面会提供更通用的形式。此函数基于在文章“Compositing Digital Images”(作者为 Porter和 Duff,见参考文献)中定义的over操作,并进行了扩展以便在重叠区域内包含混合模式。下面几节详细阐述这个公式的意义和含义。
7.2.3 Blending Color Space
11.3.3“基本合成公式”所示的合成公式是一个矢量函数:它操作的颜色以n 元矢量的形式表示,其 中n 表示在合成过程中使用的颜色空间所需的分量数。结果色Cr的第i个分量应通过将该合成公式 应用于构成颜色Cb、Cs和B(Cb,Cs)的第i个分量来获得。因而计算结果就取决于表示颜色的颜色空 间。因此,用于合成的颜色空间(被称为混色空间)明确地成为透明成像模型的一部分。必要时,应在进 行合成计算之前将背景色和源颜色转换到混色空间。
在8.6介绍的 PDF颜色空间中,应支持以下几个作为混色空间:
● DeviceGray; 
● DeviceRGB; 
● DeviceCMYK;
 ● CalGray; 
● CalRGB; 
● 等同于上述空间的ICCBased颜色空间(包括校准的 CMYK)。
分别表示亮度和色度的 Lab空间与ICCBased空间(如L*a*b* 、L*u*v* 和 HSV)不应作为混色 空间,因为在这些空间中的合成计算分别应用于每个分量时得出的结果毫无意义。此外,用作混色空间 的ICCBased空间应是双向的;也就是说,ICC配置文件应包含 AToB和 BToA 两种转换。
只应为印刷原色考虑混色空间。尽管可在Separation或 DeviceN 颜色空间中指定的单个专色上完成混合,但此类颜色不应被转换到混色空间 (先恢 复到其 备 用 颜 色 空 间 的 情 况 除 外,如 8.6.6.4 “Separation颜色空间”和8.6.6.5“DeviceN 颜色空间”所述)。相反,指定的颜色分量应与背景的相应分 量单独混合。
各种混合模式的混合函数的定义要求每个颜色分量的范围应介于0.0和1.0之间,并且颜色空间应 是加色的。在减色的颜色空间(DeviceCMYK、Separation和 DeviceN)中执行混合操作时,颜色分量值 应在应用混合函数之前进行补色处理(从1.0中减去该值),该函数的结果应在使用前再补色回去。
注:此调整使多种混合模式的效果在数值上与所有颜色空间保持一致。但给定混合模式产生的实际视觉效果仍取 决于颜色空间。在设备颜色空间中混合生成的结果与设备相关,而在基于 CIE的空间混合生成的结果在所有设 备上都是一致的。有关与颜色空间的更多信息,见11.7“颜色空间与呈现问题”。
7.2.4 Blend Mode混合模式
原则上,混合函数B(Cb,Cs)，用于自定义混合操作的合成公式。可以是任何一个将背景色和源颜色生成了另一种结果颜色Cr的函数。PDF定义了一组标准的命名混合函数(或混合模式),列在表7.2和表7.3中。图 L.18和图 L.19分别展示了对 RGB和 CMYK 颜色产生的视觉效果。
如果结果色的每个分量完全由构成背景色和源颜色的相应分量确定,即可将混合模式函数B单独应用于每组相应分量,则将该混合模式称为可分的:
cr =B(cb,cs)
式中小写字母变量cr、cb和cs表示颜色Cr、Cb和Cs的相应分量,以加式表示。（理论上，混合模式每个颜色分量应当有一个不同的函数，仍然可分离的; 但是，标准的PDF混合模式都没有这个属性）。一个可分混合模式可用于任何颜色空间,因为它独立应用于任何数量的分量。可分混合模式只用于混合点色。
TABLE 7.2 Standard separable blend modes
NAME	RESULT
Normal	选择源颜色，忽略背景:B(cb,cs)=cs
Multiply	背景颜色值与源颜色值相乘，B(cb ,cs)=cb×cs
结果色至少与两种构成颜色之一一样暗。任何颜色与黑色相乘均生成黑色;任何颜色与白色相乘均保持原始颜色不变。用黑色或白色之外的颜色绘制连续的重叠对象均生成更深的颜色。
Screen	背景颜色值的补色与源颜色值的补色相乘,再为结果进行补色处理。
B(cb,cs)=1-[(1-cb)×(1-cs)] =cb+cs-(cb×cs)
结果色始终至少与两种构成颜色之一一样亮。用白色屏蔽任何颜色均生成白色;用黑色屏蔽均保持原始颜色不变。效果类似于同时将多个摄影幻灯片投射在单个屏幕上。
Overlay	将各种颜色相乘或屏蔽,具体取决于背景颜色值。源颜色叠加在背景上,同时保留强光部分和阴影。不替换背景色,但背景色与源颜色混合在一起反映出背景的明暗。
B(cb ,cs)=HardLight(cs,cb)
Darken	选择背景色和源颜色中的较暗者。
B(cb ,cs)=min(cb ,cs)
在源颜色较暗的情况下,用源颜色替换背景色;否则,背景色保持不变
Lighten	选择背景色和源颜色中的较亮者。
B(cb ,cs)=max(cb ,cs)
在源颜色较亮的情况下,用源颜色替换背景色;否则,背景色保持不变
ColorDodge	使亮背景色变亮以反映源颜色。用黑色绘制不产生任何变化

ColorBurn	使背景色变暗以反映源颜色。用白色绘制不产生任何变化

HardLight	将颜色相乘或屏蔽,具体取决于源颜色值。效果类似于在背景上照射刺眼的聚光灯

SoftLight	使颜色变暗或变亮,具体取决于源颜色值。效果类似于在背景上照射漫射的聚光灯

Difference	在两种构成颜色中,从较亮的颜色减去较暗的颜色。

用白色绘制时,背景色反色;用黑色绘制不产生任何变化
Exclusion	产生的效果类似于 Difference模式,但对比度较低。用白色绘制时,背景色反色;用黑色 绘制不产生任何变化


表 7.3列出了标准的不可分混合模式。由于不可分混合模式将所有颜色分量综合起来考虑,其计算取决于解释分量的混色空间。它们可应用于所有能作为混色空间的多分量颜色空间(见7.2.3，“Blending Color Space”)。
从概念上讲,所有这些混合模式都需要执行下列步骤: 
● 将混色空间中的背景色和源颜色转换为中间 HSL(色度-饱和度-亮度)表示形式; 
● 从背景色和源颜色中选出色度、饱和度和亮度分量,根据它们的某种组合创建一种新颜色; ● 将结果转换回原始(混合)颜色空间。
但是,下面给出的公式实际上不执行这些转换。相反,它们从为结果提供色度的那种颜色(背景或源)开始;然后调整此颜色以获得适当的饱和度和亮度。 
不可分混合模式公式使用几个辅助函数。这些函数将操作假定具有红色、绿色和蓝色分量的颜色。 混合CMYK颜色空间需要特殊处理,如本条所述。

(在下一个函数中的)下标 min、mid和 max指该函数输入颜色的最小、中间和最大的颜色分量。

TABLE 7.3 Standard nonseparable blend modes
NAME	RESULT
Hue	用源颜色的色度及背景色的饱和度和亮度创建颜色

Saturation	
Color	
Luminosity	




7.2.5 Interpretation of Alpha
颜色合成公式:

生成的结果色是背景色、源颜色和混合项B(Cb,Cs)的加权平均,其中的权重由背景alphaαb和源alphaαs决定。对于最简单混合模式Normal，定义为：

该合成公式退化为背景色和源颜色的简单加权平均,受背景alpha值和源alpha值控制。对于更有意思的混合函数,背景alpha和源alpha将控制是完全实现混合模式的效果,还是通过将结果与背景色和源颜色混合而弱化混合模式的效果。
结果alphaαr,实际上代表一个计算结果,将在7.2.6“Shape and Opacity Computations”中描述。结果色按结果alpha进行规范化,确保以后在其他合成运算中将此颜色和alpha一起使用时,正确表示此颜色的贡献度。如果αr为零,则结果色未定义。 
前面的公式是以下公式的简化形式,该公式用一种更为直接的方式表示背景色、源颜色和混合色的相对贡献度:

(该简化公式要求置换基于alpha的合成公式,这将在下一节介绍)因此,从数学上讲,背景alpha和源alpha分别控制背景色和源颜色的影响,而其乘积控制混合函数的影响。设置αs=0.0或αb=0.0将导致混合模式不起作用;设置 αs=1.0和αb=1.0将使混合模式发挥最大作用。
7.2.6 Shape and Opacity Computations
如上所述,控制合成过程的alpha值应被定义为形状和不透明度的乘积:

本节将单独检查各种形状值和不透明度值。再次强调,从概念上讲这些值是针对页面上的每个点计算的。
Source Shape and Opacity
形状值与不透明度值可能有几个来源。透明模型为这两个值各提供了三个独立的来源。但是, PDF表示方法对独立指定所有这些来源的能力强加了一些限制(见7.5.3, “Specifying Shape and Opacity”)。 
● 对象形状(Object shape)。描边、填充和文本等基本对象拥有内部的形状,对象内部点的形状值应为1.0,外部点的形状值为0.0。同样,拥有显式遮罩的图像(见4.8.5“Explicit Masking”)的形状值在无遮罩的部分应为1.0,在有遮罩的部分应为0.0。组对象的形状应是该组所包含对象的形状的合并。
注意:从数学上讲,基本对象有“硬”边缘,每个点的形状值为0.0或1.0。但是,在将这些对象光栅化为设备像素时, 沿着边界的形状值可以抗锯齿化，取代表示这些像素部分覆盖的小数值。当进行这种抗锯齿处理时，重要的是将部分覆盖视为形状而不是不透明。
● 遮罩形状(Mask shape)。合成对象的形状值可从独立于该对象本身的附加来源(或软蒙板)中得到(如7.4“Soft Masks”,用于讨论如何生成这样的遮罩)。使用软蒙板修改对象或组的形状(被称为软裁剪)，在对象和其背景之间可生成类似于渐变的效果,如在小插图中。
● 固定形状(Constant shape)。可在每个点按标量形状常量(shape constant)修改源形状。 这只是为了方便起见,因为使用每处的值都一样的形状蒙板可实现相同的效果。 
● 对象不透明度(Object opacity)。基本对象的不透明度处处为1.0。组对象的不透明度应是对其包含的所有对象进行不透明度计算的结果。
● 遮罩不透明度(Mask opacity)。不透明度值与形状值一样,可由独立于正在合成的对象的软遮罩提供。
● 固定不透明度(Constant opacity)。可在每个点按标量不透明度常量(opacity constant)修改源不透明度。将此值视为“当前不透明度”很有用,类似于绘制基本对象时使用的当前颜色。
所有形状和不透明度输入值的范围都应在0.0到1.0(包含)之间,默认值为1.0。这样做的目的是，任何输入都使绘制操作更加透明,就像它趋向于0.0。如果不止一个输入趋向于0.0，那么效果是复合的。这是通过简单地将每种类型的三个输入相乘来实现的，产生称为源形状(source shape)和源不透明度(source shape)的中间值
fs = fj × fm × fk
qs = qj × qm × qk
其中变量的含义如表7.4所示。
TABLE 7.4 Variables used in the source shape and opacity formulas
VARIABLE	MEANING
fs	Source shape
fj	Object shape
fm	Mask shape
fk	Constant shape
qs	Source opacity
qj	Object opacity
qm	Mask opacity
qk	Constant opacity
注意：使用平铺底纹绘制对象时,此对象内部各点的对象形状和对象不透明度均由该底纹中相应点的形状和不透明度决定,而不是各处都为1.0(见7.5.6“Patterns and Transparency”)。
Result Shape and Opacity
除结果色外,绘制操作还应计算相关联的结果形状(result shape)和结果不透明度(result opacity)。这些计算应基于合并函数(union function):
Union(b, s) = 1- [(1-b) × (1-s)]
=b + s - (b×s)
式中: b ―――合成的背景值; s ―――合成的源值。
这是对不透明形状合并的常规概念的泛化,而且它可被视为“反向乘法”―――输入和输出都求补的乘法运算。结果趋向于1.0:如果任一输入为1.0,则结果为1.0。
结果形状和不透明度均应由以下公式给出:

式中变量的含义如表7.5所示。
TABLE 7.5 Variables used in the result shape and opacity formulas
VARIABLE	MEANING
fr	Result shape
fb	Backdrop shape
fs	Source shape
qr	Result opacity
qb	Backdrop opacity
qs	Source opacity
这些公式应按以下方式解释: 
● 结果形状应是背景形状和源形状的合并;
● 结果不透明度应是背景不透明度和源不透明度的合并,由其各自的形状加权。然后结果应除以结果形状进行规范化，确保当这个形状和不透明度随后在另一个合成操作中一起使用时，不透明度的贡献被正确表示。
由于alpha只是形状和不透明度的乘积,因此可很容易地得到:
αr = Union(αb ,αs)
此公式可在不需要独立的形状和不透明度时使用。
7.2.7 Summary of Basic Compositing Computations
下面是本节中给出的所有计算的总结。它们按顺序给出,确保没有变量在计算出来之前被用到; 此外,为了简化, 已对一些公式进行了重新排列。见上面的表7.1、表7.4和表7.5,以了解这些公式中使用的变量的含义。

7.3 Transparency Groups
透明组(transparency group)是透明栈中连续对象的序列,这些对象被收集在一起并组合,以在每个点生成单一的颜色、形状和不透明度。然后将结果当作单个对象,用在后续的合成操作中。这有助于创建独立的艺术块，每个艺术块由多个对象组成，然后组合它们，在组合过程中可能应用额外的透明效果。组可嵌套在其他组内,形成树形组层次结构。
组内包含的对象被视为单独的透明栈,称作组栈(group stack)。堆栈中的对象根据一些初始的背景合成(稍后讨论),生成整个组的合成颜色、形状和不透明度。结果是一个对象,其形状是构成对象的形状合并,而其颜色和不透明度是合成操作的结果。然后应以常规方式将此对象与组的背景合成。 
除了计算出的颜色、形状和不透明度外,作为整体的组还可包含更多属性: 
● 在将组与其背景合成时,还可应用影响单个对象合成计算的所有输入变量。这些变量包括遮罩形状和常量形状、遮罩不透明度和常量不透明度,以及混合模式。 
● 组可以是孤立(isolated)的,也可以是非孤立的(non-isolated),这决定在其上合成栈的初始背景。
● 组可以是抠图(knockout)的,也可以是非抠图(non-knockout)的,这决定其栈内的对象是相互合成还是只与组的背景合成。
● 孤立组可指定自己的混色空间,独立于组背景的颜色空间。 
● 组的结果可以用作创建软遮罩(soft mask，见 7.4“Soft Masks”)的形状或不透明度值的来源，而不是合成到当前页面上。
下节介绍处理组合成的标记法。后续几节描述非孤立、非抠图组使用的组合成公式,以及孤立组和抠图组的特殊属性。
7.3.1 Notation for Group Compositing Computations
由于现在一次处理多个对象,用一些标记来区分它们是很有用的。因此,相应地，前面引入的变量被修改为包含一个二级下标，标记一个对象在透明栈中的位置。例如，Csi代表栈中第i个对象的源颜色。下标0表示初始背景;下标1到n 表示在有n个元素的栈中从最底部对象到最顶部对象。另外,把下标b 和r 从变量Cb、fb、qb、αb、Cr、fr、qr和αr中去掉;其他变量保持其助记下标。只去掉了背景和结果的标记，如源s等的标记保持不变。
这些约定允许把合成公式重新解释为栈元素之间的递推关系。例如,把对象i的颜色合成计算的结果表示为Ci(之前为Cr)。这个计算将直接的背景颜色作为其输入之一，该背景色是对象i-1的颜色合成计算的结果; 这表示为Ci-1(之前为Cb)。
对简单的n元素栈(不包括任何组),修订后的公式(i=1,…… ,n)应是:

式中变量的含义如表7.6所示。注意比较这些公式与7.2.7节“Summary of Basic Compositing Computations”中所示的公式。
TABLE 7.6 Revised variables for the basic compositing formulas
VARIABLE	MEANING
fsi	Source shape for object i
fji	Object shape for object i
fmi	Mask shape for object i
fki	Constant shape for object i
fi	Result shape after compositing object i
qsi	Source opacity for object i
qji	Object opacity for object i
qmi	Mask opacity for object i
qki	Constant opacity for object i
qi	Result opacity after compositing object i
α si	Source alpha for object i
α i	Result alpha after compositing object i
Csi	Source color for object i
Ci	Result color after compositing object i
Bi (Ci-1, Csi)	Blend function for object i
7.3.2 Group Structure and Nomenclature组结构和命名法
如前所述,组的元素应被视为单独的透明栈,被称为组栈。这些对象在选定的初始背景上(将会进行描述)进行合成,然后应将结果色、形状和不透明度视为属于单个对象。生成的对象以通常的方式依次与组的背景合成。
此计算需要将栈解释为树。对于栈中从位置i开始的n元素组,会将接下来的n个对象视为n元素子栈,其元素从1到n独立编号。然后将这些对象从父(包含)栈中的对象编号中删除,并用组对象替换,编号为 i,后面接着的是要在组顶部绘制的其余对象,从i+1开始重新编号。此操作以递归方式应用于任何嵌套的子组。因此，术语元素(element，表示为Ei)指组的成员; 它可以是单个对象,也可以是包含的子组。
从嵌套组内特定元素的角度来看,有三个感兴趣的不同背景:
● 组背景(group backdrop)是组中第一个元素之前(不包括)所有元素合成的结果(如果父组是抠图组,则此定义将被改变; 见7.3.5“Knockout Groups”)。
● 初始背景(initial backdrop)是对组的第一个元素进行合成时选择的背景。它或者与组背景相同(适用于非孤立组),或者是完全透明的背景(适用于孤立组)。
● 直接背景(immediate backdrop)是组中当前元素之前所有元素合成的结果。 
当组中所有元素都被合成后,应将组的合成结果视为单个对象,然后应将此对象与组背景合成。该操作都应发生，无论选择用于合成组元素的初始背景是组背景还是透明背景。有一个特殊的修正，以确保背景对于整体结果的贡献只应用一次。
7.3.3 Group Compositing Computations
组的颜色和不透明度应由组合成函数( group compositing function)定义:
<C,f,α> = Composite(C0 ,α0, G)
式中变量的含义如表7.7所示。
TABLE 7.7 Arguments and results of the group compositing function
VARIABLE	MEANING
G	透明组:由组中的所有元素E1，…，En组成的复合对象―――n 个构成对象的颜色、形状、不透明度和混合模式
C0	组的背景色
C	计算得到的组颜色,在将组视为一个对象时应作为源颜色使用
f	计算得到的组形状,在将组视为一个对象时应作为对象形状使用
α 0	组的背景alpha
α	计算得到的组alpha,在将组视为一个对象时应作为对象alpha使用
注意：不透明度没有显式指定为此函数的参数或结果。几乎所有计算都使用形状和不透明度的积(alpha),而不单独使用不透明度;因此,通常可方便地直接使用形状和alpha而不是形状和不透明度。如果需要,可通过把alpha除以相关联的形状而计算出不透明度。
应用组合成函数得到的结果随后视为单个对象,此对象然后根据本节定义的公式与该组的背景合成。在这些公式中,用组合成函数计算出的颜色、形状和alpha(C、f 和α)分别用作源颜色Cs、对象形状fj和对象alphaαj。 
适用于非孤立、非抠图组的合成公式定义如下: 
● 初始化: fg0 =αg0 =0.0
● 对于每个组元素Ei∈G(i=1,…,n): 


● 结果: 


式中变量的含义如表7.8所示(表7.7所列除外)。
TABLE 7.8 Variables used in the group compositing formulas
VARIABLE	MEANING
Ei	组的元素i:一个复合变量,代表该元素的颜色、形状、不透明度和混合模式
fsi	元素Ei的Source shape
fji	元素Ei的Object shape
fmi	元素Ei的Mask shape
fki	元素Ei的Constant shape
fgi	组形状:组E1到Ei的累积源形状，不包括初始背景。
qmi	元素Ei的Mask opacity
qki	元素Ei的Constant opacity
αsi	元素Ei的Source alpha
αji	元素Ei的对象alpha:其对象形状和对象不透明度的积
αgi	组alpha:组元素E1到Ei的累积源alpha，不包括初始背景。Union(αgi-1 ,αsi)
αi	合成元素Ei后的累积alpha，包括初始背景。Union(α0 ,αgi)
Csi	元素Ei的Source color
Ci	合成元素Ei后的累积颜色，包括初始背景
Bi(CiC1, Csi)	元素Ei的Blend function
如果元素Ei是基本对象,其颜色、形状和alpha值(Csi、fji和αji)是对象内在的属性。如果元素是组,组合成函数应递归应用于子组,生成的C、f 和α值应在父组计算中用作Csi、fji和αji。
注意：组的元素被合成到包括组初始背景的背景上。完成此操作可实现混合模式的正确效果,其中大多数混合模式依赖于正在混合的背景色和源颜色。这个特性将非孤立组与孤立组区分开来，将在下一节中讨论。
需要特别注意最后的组合成函数计算最终结果C、f 和α的公式。本质上,这些公式将从计算的结果中消除组背景的贡献。这确保接下来将组与背景(可能有附加的形状或不透明度输入或不同的混合模式)合成时,该背景的贡献只有一次。
对于颜色,背景去除是通过显式计算完成的,其效果本质上是用Normal混合模式进行合成的相反操作。所用公式是以下公式的简化形式,它能更直观地展示此操作:

式中φb是背景分数(backdrop fraction),即背景色对总体颜色的相对贡献。
对于形状和alpha,背景去除是通过维护两组保持累积值的变量来完成的。组形状和组alpha(fgi和αgi)应只累积组元素的形状和alpha,不包括组背景。其最终值成为组合成函数返回的组结果。完整的alpha(αi)还包括背景贡献;其值用于颜色合成计算。永不需要计算相应的包括背景贡献的完整形状fi。
这些修正的结果是,如果满足以下条件，则将对象合成为组的效果与单独合成它们(不分组)的效果一样:
● 组是非隔离的,且与其父组具有相同的抠图属性(见7.3.4, “Isolated Groups,” and 7.3.5, “Knockout Groups”);
● 将组的结果与组背景合成时使用Normal混合模式,且形状和不透明度输入始终为1.0。
7.3.4 Isolated Groups
孤立组(isolated group)是其元素合成在完全透明的初始背景而不是组背景上。因此,该组生成的源颜色、对象形状和对象alpha与组背景无关。与组背景的惟一交互应发生在组的计算颜色、形状和alpha与组背景合成时。
具体地讲,组内对象的混合模式生成的特殊效果只考虑这些对象的固有颜色和不透明度;它们不受组背景的影响。例如，对组中的一个对象应用Multiply混合模式将对组栈中底层的其他对象(而不是组的背景)生成更暗效果。
图L17,P1147,展示了在浅灰色(C=M=Y=0.0;K=0.15)下由四个重叠圆形构成的组的效果。圆在组内绘制，不透明度为1.0，采用Multiply混合模式；组本身采用Normal混合模式在背景上进行绘制。在上面一行,组是隔离的,因此不与彩虹背景交互。在下面一行,组是非隔离的,并与背景合成。此图还说明了抠图组和非抠图组之间的差异(见7.3.5, “Knockout Groups”)。
孤立组的效果可由直接指定每个点的颜色、形状和不透明度的单个对象表示。这种孤立组的扁平化有时对于在应用程序中导入和导出完全合成的插图(artwork)很有用。此外,指定了显式混色空间的组必须是孤立组。
对于孤立组,组合成公式应修正一下,在初始化时添加一个语句:
α0 =0.0	如果组是孤立的
 也就是说,组元素合成的初始背景应是透明的,而不是从组背景继承。此替代还使C0未定义,但正常的合成公式将可以解决这个问题。此外,C的结果计算将自动简化为C=Cn, 因为没有可以被排除的背景贡献。
7.3.5 Knockout Groups
在击倒组中,每一个元素都与组的初始背景合成而不是与组中前面元素的栈合成。当对象拥有二值形状(内部为1.0,外部为0.0)时,每个对象覆盖(knocks out，击倒)同一组内它重叠的任何之前元素的效果。在任何给定点,只有包含该点的最上面的对象贡献整个组的结果色和不透明度。
在上节7.3.4“Isolated Groups中讨论的图L.17，展示了击倒组与非击倒组之间的差异。在左列中,四个重叠圆形被定义为击倒组,因此在该组内不会彼此合成。在右列中,圆形成了一个非击倒组,因此彼此合成。在每列中,上图和下图分别描绘了孤立组和非孤立组。
这个模型类似于不透明成像模型，除了“最上面的对象获胜”的规则适用于颜色和不透明度。在从一组重叠对象中合成一个艺术品(artwork)时,击倒组很有用，因为在任何重叠中，最上面的对象完全掩盖了下面的对象。同时,最顶层对象以常规方式与组的初始背景进行交互,并适当应用其不透明度和混合模式。
击倒的概念已泛化为适应分数形状值。在这种情况下，直接的背景只是被部分击倒，并用对象与初始背景合成结果的分数部分替换。
重新描述的组合成公式通过引入了新的变量b来处理击倒组,该变量是一个下标,指定在合成计算中用作背景的之前结果:在击倒组中是0,在非击倒组中是i-1。当b=i-1时,公式简化为7.3.3,“Group Compositing Computations”。
一般情况下,计算应分两个阶段进行:
● 将源对象与组的初始背景合成,忽略对象的形状并在所有位置均使用源形状值1.0。这将生成未归一化的临时alpha和颜色结果αt和Ct。对于颜色，此计算本质上与 7.2.5“Interpretation of Alpha”中给出的未简化颜色合成公式相同,但使用的源形状为1.0。

● 使用源形状作为权重因子,计算此结果与对象的直接背景的加权平均值。然后使用结果alpha 归一化结果色: 

应对颜色和alpha都执行此平均计算。 上面的公式直接展示了此平均计算。7.3.7“Summary of Group Compositing Computations”中的公式被稍微改动为使用源形状和alpha,而不是使用源形状与不透明度,避免显式地计算源不透明度值。注意:组合成计算中的Ct与上面的Ct略有不同:它预乘了fsi。
源形状的极值产生了直接的击倒效果。也就是说，形状值为1.0(内部)将产生对象与初始背景合成后的颜色和不透明度。形状值为0.0(外部)保持之前的组结果不变。击倒功能存在的主要原因是为了保持一个单独的形状值而不是只有一个结合形状和不透明度的alpha值。必须在随后用作击倒组元素的任何组中计算单独的形状值。
击倒组可以是孤立的,也可以是非孤立的;也就是说,孤立(isolated)和击倒(isolated)是独立的属性。非孤立的击倒组将其最顶层的元素与组的背景合成。孤立击倒组将最顶层的元素与透明背景合成。
注意:当非孤立组嵌套在击倒组内部时,内部组的初始背景与外部组的初始背景相同;它不是内部组的直接背景。尽管这不是预期的行为,但它毕竟是b=0时组合成公式的结果。
7.3.6 Page Group
直接绘制到页面上的所有元素(包括顶级组和不属于任何组的顶级对象)均应被视为包含在一个透明组P中,该组再和上下文相关(context-dependent)的背景合成。这样的组被称为页面组(page group)。
页面组可以采用以下两种截然不同的方法之一进行处理: 
● 通常,页面应被直接加在输出介质上,比如纸张或显示屏。页面组被视为孤立组,其结果应与适合于介质的背景色合成。该背景名义上是白色的,但会根据介质的实际属性发生变化。但是,某些应用程序可能会选择提供不同的背景，如检测板或网格,以帮助视觉化艺术品中的透明效果。
● PDF文件的“页面”可以视为一个图形对象,用作其他文档页面的元素。例如,将包含由绘画程序(Illustrator)生成的艺术品的PDF文档放入由排版程序生成的页面布局时,会出现这种情况。在此情况下,PDF“页面”不与介质颜色合成; 相反,它将被视为一个普通透明组,该组可以是孤立的,也可以是非孤立的,以常规方式与其背景合成。
本节的其余部分只适用于页面组的第一种用法, 即页面组直接加到介质上。
给定点的页面颜色C应由简化的组合成公式定义:

式中变量的含义如表7.9所示。第一个公式计算给定透明背景的组的颜色和alpha―――实际上将P视为孤立组。第二个公式将结果与环境相关的背景合成(使用Normal混合模式的等效方法)。
TABLE 7.9 Variables used in the page group compositing formulas
VARIABLE	MEANING
P	页面组,由页面顶级栈中的所有元素E1、…、En组成
Cg	计算的页面组颜色
fg	计算的页面组形状
αg	计算的页面组alpha
C	计算的页面颜色
W	页面的初始颜色(通常为白色,但可能根据介质的属性或应用程序的需要而变化)
U	未定义颜色(未使用,因为 Composite的α0参数为0)
如果没有另外说明,页面组的颜色空间应继承输出设备的本地颜色空间,即设备颜色空间,比如DeviceRGB或 DeviceCMYK。通常最好指定显式的颜色空间，特别是CIE-based空间，以确保在页面组的合成计算中得到可预测的结果。在此情况下,所有页面级合成均应在指定的颜色空间中完成, 整个结果会转换到输出设备的本地颜色空间，在与上下文相关的背景进行合成之前。当页面实际上没有被呈现，而是在不透明的成像模型(如PostScript)中转换为扁平化表示时，也会出现这种情况。
7.3.7 Summary of Group Compositing Computations
下面对组合成公式的重述也考虑了隔离组和击倒组。变量的含义请参见第534和536页的表7.7和表7.8。
<C,f,α> = Composite(C0 ,α0,G) 
初始化: 
fg0 =αg0 =0.0 
α0 =0.0 			如果组是隔离的
对于每个组元素Ei∈G(i=1,…,n):

结果: 

注意:再次强调,这些公式是其最一般的形式。当形状和不透明度的某些来源不存在或形状和不透明度不必单独维护时,这些公式可大大简化。而且,在每个特定的组类型中(隔离的或非隔离的,抠图的或非抠图的),这些公式的某些项将取消或去掉。高效的实现宜使用简化的推导公式。
7.4 Soft Masks
如前面几节所述,合成对象时使用的形状和不透明度可包括被称为遮罩形状(fm)和遮罩不透明度(qm)的分量,它来自一个独立于对象的源。这种独立的源称为软遮罩(soft mask)，它定义的值可以随页面上的不同点而变化。soft这个词强调的是，在给定的点上的遮罩值不限于0.0或1.0，也可以采用中间的小数值。这种遮罩通常是提供与位置相关的不透明度值的唯一方法，因为基本对象本身没有内部的不透明度。
用作形状值来源的遮罩也被称为软裁剪(soft clip),类似于不透明成像模型中的“硬(hard)”裁剪路径(见4.4.3,“Clipping Path Operators”)。软裁剪是硬剪裁的泛化:硬裁剪能表示为软剪切,其裁剪路径内的形状值为1.0,裁剪路径外的形状值为0.0。在硬裁剪路径内部的任何位置,源对象的颜色替换背景;在外部的任何位置,背景显示出来不变。相比之下,使用软剪裁，能在对象及其背景之间创建渐变,就像渐变色。
蒙板可通过创建透明组并向其中绘制对象进行定义,因此可按常规方式定义颜色、形状和不透明度。然后，可以使用生成的组以两种方式中的一种来派生遮罩，如下面的部分所述。
7.4.1 Deriving a Soft Mask from Group Alpha
在定义软蒙板的第一种方法中,首先应根据通常的公式计算透明组G的颜色、形状和不透明度:
<C,f,α> = Composite(C0 ,α0,G)
式中C0和α0表示其值不影响最终结果的任意背景。C、f 和α结果应分别是去除背景后组的颜色、形状和alpha。
然后从组的alpha中派生每个点的蒙板值。在此情况下未使用组的颜色,因此不必计算它。alpha值应传给单独指定的转换函数,允许自定义蒙板效果。
7.4.2 Deriving a Soft Mask from Group Luminosity
从透明组派生软蒙板的第二种方法,首先用一些选定颜色的完全不透明的背景合成组。然后把给定点的蒙板值定义为生成颜色的亮度。这允许从采用普通绘制操作符绘制的任意艺术品的形状和颜色中派生蒙板。
用于从组G创建蒙板的颜色C被定义为
<Cg ,fg ,αg> = Composite(C0,1,G) 
C = (1-αg)×C0 +αg ×Cg
式中C0是选择的背景色。
G 可以是任何一种组(独立的或非独立的,抠图的或非抠图的),每种情况都对C结果生成各种效果。然后应按以下一种方式将颜色C转换为亮度,具体取决于组的颜色空间:
● 对于 CIE-based空间,转换到CIE 1931 XYZ空间并将Y分量用作亮度。这样可生成色度正确的亮度。 如果是PDF CalRGB空间,则公式为:

使用颜色空间字典的Gamma和 Matrix条目的分量(见“CalRGB Color Spaces”中的表4.14)。类似的计算适用于其他CIE-based的颜色空间。
● 对于设备颜色空间,用设备相关的方法把颜色转换到DeviceGray,生成的灰度值用作亮度,不做gamma补偿或其他颜色校准。 此方法并不声称色度正确;它只提供数值上简单的方法来生成连续调的蒙板值。下面分别是从DeviceRGB和 DeviceCMYK 转换的公式:
Y =0.30×R +0.59×G +0.11×B
Y =0.30× (1-C)× (1-K) + 0.59× (1-M)× (1-K) + 0.11× (1-Y)× (1-K)
转换后,结果应传给单独指定的转换函数,允许自定义蒙板效果。 
最可能有用的背景色是黑色,它使得在生成的蒙板中组形状外部任何区域的亮度值都为零。如果把组的内容视为正蒙板,就会生成关于形状外部点的预期结果。
7.5 Specifying Transparency in PDF
前面章节已经在抽象的层次上介绍了透明成像模型，很少提到它在PDF中的表示。本节介绍在PDF中指定透明度的可用工具。
7.5.1 Specifying Source and Backdrop Colors
出于透明合成的目的,单个图形对象(如 4.1“Graphics Objects”中的定义)应被视为基本对象(文本对象需要特别处理,如5.2.7“Text Knockout”所述)。也就是说,所有给定对象都应被视为透明栈中的一个元素。对象的各个部分不会相互合成，即使它们的描述方式似乎会导致重叠(如自相交路径、路径的组合填充和描边,或包含重叠或折叠的渐变底纹)。在颜色合成公式中使用的对象的源颜色Cs，应采取和不透明成像模型中相同的方式指定：即通过图形状态的当前颜色或图像中的源采样。背景色Cb应是之前绘制操作的结果。
7.5.2 Specifying Blending Color Space and Blend Mode
混色空间应是在其中绘制对象的透明组的属性;其规范如7.5.5“Transparency Group XObjects”所述。页面作为一个整体也被视为一个组,即页面组( page group，见7.3.6, “Page Group”),具有自己的颜色空间属性。如果没有另外指定, 则页面组的颜色空间应从输出设备的原生颜色空间继承。
混合模式B(Cb,Cs)应由图形状态(见 4.3“Graphics State”))中的当前混合模式( current blend mode)参数确定,该参数由图形状态参数字典(见4.3.4“Graphics State Parameter Dictionaries”)中的BM 条目指定。其值应是一个名称对象(标识在520 and 524页的表7.2 and 7.3 中列出的标准混合模式之一),或此类名称的数组。对于后者,应用程序应使用数组中它识别的第一个混合模式(或Normal,如果一个也识别不出来)。 将来可能会引入新的混合模式,不能识别它们的应用程序具有合理的回退行为(见附录H的实现说明72.)。
当前混合模式应始终应用于处理颜色分量;但有时候只可应用于专色着色剂,见566页的“Blend Modes and Overprinting”了解更多信息。
7.5.3 Specifying Shape and Opacity
如7.3.7“Source Shape and Opacity”所述,在合成计算中使用的形状值(f)和不透明度(q)值可以来自不同的源:
● 正在合成的对象的内部形状(fj)和不透明度(qj); 
● 独立于对象本身的单独的形状(fm )或不透明度(qm )蒙板; 
● 在每个点添加的标量形状(fk)或不透明度(qk)常数。 
下面章节描述如何在PDF中指定这些形状和不透明度源。
Object Shape and Opacity
采用PDF绘制操作符绘制的对象的形状值fj应按以下方式定义: 
● 对于由路径或字形定义并使用路径绘制或文本显示操作符以统一颜色绘制的对象(见4.4.2“Path-Painting Operators”和5.3.2“Text-Showing Operators”),形状值在路径内部应始终为1.0,路径外部应为 0.0。 
● 对于图像(见4.8“Images”),形状值在图像矩形内部应为1.0,外部应为0.0。这可通过显式遮罩或颜色键遮罩进一步修改(见4.8.5“Explicit Masking”和4.8.5“Color Key Masking”)。
● 对于图像遮罩(见4.8.5“Stencil Masking”),形状值在绘制区域应为1.0,在遮掩区域应为0.0。 
● 对于采用平铺底纹(见4.6.2“Tiling Patterns”)或渐变底纹(见4.6.3“Shading Patterns”)绘制的对象,形状应进一步受到定义该底纹的对象的约束(见7.5.6“Patterns and Transparenc”)。
● 对于采用sh操作符(见4.6.3“Shading Operator”)绘制的对象,形状值在渐变的绘制几何边界内部应为1.0,外部应为0.0,不考虑渐变字典中的Background条目(见4.6.3“Shading Dictionaries)。
所有基本对象在任何位置都有一个内部的不透明度qj为1.0。任何想要的不透明度小于1.0的都必须通过不透明度遮罩或常数来应用，如下面的章节所述。
Mask Shape and Opacity
任何PDF合成操作只能提供最多一个遮罩输入―称为软遮罩或alpha遮罩。遮罩可作为形状值 (fm)或不透明度值(qm )的源,具体取决于图形状态(见 4.3“Graphics State”)中alpha源参数的设置。这是一个布尔标志,使用图形状态参数字典(见4.3.4, “Graphics State Parameter Dictionaries”)中的AIS(“alpha is shape”)条目进行设置:如果软遮罩包含形状值,则为true,如果包含不透明度则为false，默认为false。
软遮罩应采用以下方式之一指定: 
● 图形状态中的当前软遮罩参数(current soft mask），使用图形状态参数字典中的SMask条目进行设置，包含定义遮罩内容的软遮罩字典(见7.5.4“Soft-Mask Dictionaries”)。可指定名称 None代替软遮罩字典,表示不存在软遮罩。在此情况下,任何位置的遮罩形状和不透明度应是隐含的1.0。 
● 图像XObject可包含其自己的软遮罩图像(soft-mask image),通过在图像字典(见4.8.4“Image Dictionaries”)的SMask条目中以附属图像XObject的形式。此遮罩(如果存在)应覆盖由图像字典的Mask条目指定的任何显式遮罩或颜色键遮罩。图像字典中的任一遮罩形式均应覆盖图形状态中的当前遮罩。
● 把JPXDecode过滤器作为其数据源的图像XObject，可指定一个SMaskInData条目,表示软遮罩嵌入在数据流中(见 3.3.8“JPXDecode Filter”)。 
注:图形状态中的当前软遮罩是用于每次只裁剪一个对象的(基本对象或透明组)。如果在绘制两个或多个重叠对象时应用软遮罩,则遮罩的效果将在重叠的区域中(在抠图组中除外)自身相乘,可能生成非预期的结果形状或不透明度。要把一个软遮罩应用于多个对象,通常最好把对象定义为透明组并在整个组应用遮罩。这些注意事项也适用于当前alpha常量。
Constant Shape and Opacity
图形状态(见4.3“Graphics State”)中的当前alpha常量(current alpha constant)指定两个标量值,一个用于描边,一个用于所有其他绘制操作,在颜色合成公式中被用作固定形状(fk)或固定不透明度(qk)分量。通过alpha source条目确定被用作形状或不透明度。此参数类似于在绘制基本对象时使用的当前颜色。然而，请注意，在将透明组结果绘制到其背景上时,也应使用非描边alpha常量；也见附录H的实现说明72。
描边和非描边alpha常量分别由图形状态参数字典(见4.3.4“Graphics State Parameter Dictionaries”)中的CA和ca条目进行设置。如前面的软遮罩所述,图形状态中的alpha source标志决定将alpha常量解释为形状值 (true)还是不透明度值(false)。
注意:在上节“Mask Shape and Opacity”末尾的备注适用于当前alpha常量参数和当前软遮罩。
7.5.4 Specifying Soft Masks
如7.5.3“Mask Shape and Opacity”所指出的,在合成计算中使用的软遮罩可按以下方式之一指定:
● 作为图形状态的当前软遮罩参数中的软遮罩字典;有关更多信息,见下面的“Soft-Mask Dictionaries”。 
● 作为与采样图像相关联的软遮罩图像;有关更多信息,见下面的“Soft-Mask Images”。 
● (PDF1.5)作为嵌入在JPEG2000编码数据中的遮罩通道;有关更多信息,见3.3.8, “JPXDecode Filter”和表4.39的SMaskInData条目。
11.6.5.2 软遮罩字典
定义软遮罩的最常见方法是,使用在图形状态(见4.3“Graphics State”)中指定为当前软遮罩的软遮罩字典(soft-mask dictionary)。表7.10展示了此类字典的内容。见附录H.实施说明72.
TABLE 7.10 Entries in a soft-mask dictionary
KEY	TYPE	VALUE
Type	name	(可选)此字典描述的PDF对象类型。如果存在,对于软遮罩字典,应为 Mask
S	name	(必备)指定从G条目指定的透明组派生掩码值时使用的方法的子类型:
 ● Alpha:应使用组的已计算的alpha,不考虑其颜色(见7.4.1“Deriving a Soft Mask from Group Alpha”).
● Luminosity:转换组的已计算颜色为单分量的亮度值(见7.4.2, “Deriving a Soft Mask from Group Luminosity”).
G	stream	(必备)一个透明组XObject(参见7.5.5“Transparency Group XObjects”)用作生成遮罩的alpha或颜色值的源。如果子类型S为Luminosity,组属性字典应包含CS条目,定义执行合成计算的颜色空间。
BC	array	(可选)分量值的数组,指定用于合成透明组XObject G的背景色。只应在子类型S为Luminosity时才考虑此条目。该数组应包括n个数值,其中n是由组属性 字典(见7.5.5“Transparency Group XObjects”)的CS条目指定的颜色空间的分量数。默认值:颜色空间的初始值,代表黑色。
TR	function or name	(可选)一个函数对象(见3.9“Functions”),指定用于派生遮罩值的转换函数(transfer function)。该函数应接 受一个输入,即计算的组alpha或亮度(具体取决于子类型S的值),而且应返回一个输 出,即生成的蒙板值。输入应介于0.0到1.0之间。计算的输出应介于0.0到1.0之间; 如果位于此范围之外,则应强制为最接近的有效值。可指定名称Identity来代替函数 对象,标识等同函数。默认值:Identity

应使用7.4.1“Deriving a Soft Mask from Group Alpha”和 7.4.2“Deriving a Soft Mask from Group Luminosity”中描述的两种方法之一从透明组的值中派生遮罩值。组由软遮罩字典中的G条目指定的透明组XObject(见7.5.5, “Transparency Group XObjects”)定义。S(subtype)条目指定使用两个派生方法中的哪一个: 
● 如果子类型是alpha,透明组XObject G只计算一个组alpha。应忽略构成对象的颜色,且不应执行颜色合成计算。然后将转换函数TR应用于已计算的组alpha以生成遮罩值。 在透明组的边界框之外，遮罩值是对输入值0.0应用转换函数的结果。
● 如果子类型是 Luminosity,则应将透明组XObject G与完全不透明的背景合成，任何位置的背景色由软遮罩字典的BC条目定义。然后应将计算的结果色转换为单分量的亮度值,并将转换函数TR应用于此亮度以生成遮罩值。在透明组边界框外部的点,遮罩值应通过将 BC颜色转换为亮度并将转换函数应用于此结果来获得。
遮罩的坐标系定义为将透明组的复合字典(见8.10.2“复合字典”)中的Matrix条目指定的转换矩阵 连接使用gs操作符在图形状态中建立软遮罩时的当前转换矩阵。
注意：在定义软遮罩的透明组XObject中,专色分量永不可用,即使它们在使用软遮罩的组中或页面上可用。如果组XObject的内容流指定使用专色分量的Separation或DeviceN 颜色空间,则应用备用颜色空间替代(见4.5.5“Separation Color Spaces”和4.5.5“DeviceN Color Spaces”)。
Soft-Mask Images
定义软遮罩的第二个方法是把软遮罩图像(soft-mask image)和图像XObject相关联。这是在父XObject的图像字典(见4.8.4“Image Dictionaries”,也见附录H的实现说明73)的SMask条目中指定的附属图像 XObject。用作软遮罩图像的附属图像字典中条目的格式和含义与普通图像XObject(如4.8.4“Image Dictionaries”中的表4.39所示)中条目相同,但受表7.11中列出的限制。此类型的图像字典可包含一个附加条目Matte，如下所述。
 TABLE 7.11 Restrictions on the entries in a soft-mask image dictionary
KEY	RESTRICTION
Type	如果存在,应是XObject
Subtype	应是Image
Width	如果存在Matte条目(见下表7.12),应与父图像的Width值相同;否则独立于父图像。两个图像都应映射到用户空间中的单位正方形,不管各自的采样是否一致
Height	与 Width具有相同的注意事项
ColorSpace	必须;应是DeviceGray
BitsPerComponen	必须
Intent	忽略
ImageMask	应是false或不存在
Mask	应不存在
SMask	应不存在
Decode	默认值:[0 1]
Interpolate	可选
Alternates	忽略
Name	忽略
StructParent	忽略
ID	忽略
OPI	忽略
TABLE 7.12 Additional entry in a soft-mask image dictionary
KEY	TYPE	VALUE
Matte	array	(可选;PDF1.4)指定哑光颜色分量值的数组,父图像中的图像数据应与此颜色进行预混合。该数组包含n个数值,其中n是父图像的图像字典的ColorSpace条目指定的颜色空间的分量数;这些数值应是该颜色空间中有效的颜色分量。如果此条目不存在,则不应对图像数据进行预混合。
当一个图像伴随着一个软遮罩图像时,将图像数据与一些背景色(称为哑光色，matte color)进行预混合(preblended)有时是有利的。每个图像样本代表原始源颜色和哑光色的加权平均,使用相应的遮罩采样作为权重因子(这是对通常称为预乘(premultiplied)alpha技术的泛化)。
 如果对图像进行预混合,则哑光颜色应由软遮罩图像字典(见表7.12)中的Matte条目指定。针对每个分量独立执行的预混合计算是:

式中: 
c'―――要在图像源数据中提供的值;
c ―――原始图像分量值;
m ―――哑光颜色分量值;
α ―――相应的遮罩样本。
注意：此计算使用实际颜色分量值,并已执行了Filter和 Decode变换。无论颜色空间是加色的还是减色的,计算都应相同。
当预混合的图像数据用于透明度混合计算和合成计算时,结果应和使用原始的、未混合的图像数据且未指定哑光颜色时一样。具体地讲,混合函数的输入应是原始颜色值。为了从c'中获得c,应用程序有时需要对上面显示的公式进行反向操作。如果结果c值在图像颜色空间的颜色分量值范围之外，结果是不可预测的。
预混合计算在父图像的ColorSpace条目指定的颜色空间中完成。这独立于可能在其中绘制图像的 组颜色空间。如果需要进行颜色转换,则应在进行颜色转换之前执行反向预混合。如果图像颜色空间是Indexed空间(见4.5.5“Indexed Color Spaces”),则应预混合颜色表中的颜色值(而不是索引值本身)。
7.5.5 Transparency Group XObjects透明组XObjects
在 PDF中把透明组表示为特殊类型的组XObject(见4.9.2“Group XObjects”),称为透明组XObject( transparency group XObject)。组XObject又是一种form XObject类型,由其form字典(见 4.9.1“Form Dictionaries”)中是否存在Group条目加以区分。此条目的值是定义组属性的附属组属性字典(group attributes dictionary)。字典内容的格式和含义应由其组子类型确定,由字典的S条目指定。透明组(子类型Transparency)的条目如表7.13所示。
页面对象(见144页的“Page Objects”)也可有Group条目,它的值是一个指定页面组属性(参见第7.3.6节“page Group”)的组属性字典。一些字典条目对于页面组和透明组XObject的解释略有不同;详细信息请参见表格中的描述。
TABLE 7.13 Additional entries specific to a transparency group attributes dictionary
KEY	TYPE	VALUE
S	name	(必备)组子类型,标识此字典描述其属性的组类型;对于透明组必须是 Transparency
CS	name or array	(有时为必备)组颜色空间(color space),用于下列目的:
● 作为向组中绘制时应转换到的颜色空间; 
● 作为在组内合成对象的混色空间(见7.2.3“Blending Color Space”);
● 作为整个组的颜色空间，当把组作为一个对象绘制到它的背景上。
组颜色空间可能是任何设备或CIE-based的颜色空间,将其分量视为在0.0到1.0范围内独立的加色值或减色值,受7.2.3“Blending Color Space”中描述的限制。这些限制不包括Lab和亮度-色度ICCBased颜色空间以及特殊颜色空间Pattern、Indexed、Separation和DeviceN。设备颜色空间应根据当前资源字典的ColorSpace子字典中的DefaultGray、DefaultRGB和 DefaultCMYK条目进行重新映射(见4.5.4“Default Color Spaces”)。
通常，CS条目只允许用于孤立的透明组(I为true的那些组),即使它是可选的。然而，对于任何没有父组或页面可从其继承的透明组XObject，这个条目在组属性字典中都是必需的――特别地，它(transparency group XObject)是子类型Luminosity软遮罩字典中G条目的值(参见“Soft-Mask Dictionaries”)。
此外,与页面对象相关联的组属性字典中指定CS条目总是允许的,即使I不存在或为false。在通常情况下，将页面直接强加到输出介质上，页面组被有效地隔离，而不考虑I值，因此遵从指定的CS值。但如果把该页面用作某个其他页面的元素,而且如果组是非隔离的,则忽略CS,颜色空间继承自合成页面的实际背景(见7.3.6“Page Group”)。
默认值:在其中绘制此透明组的父组或页面的颜色空间(父颜色空间可显式指定也可继承)。
注意：对于用作注释外观(见8.4.4“Appearance Streams”)的透明组 XObject, 默认颜色空间应从出现注释的页面继承。
I	boolean	(可选)一个标志，指定透明组是否隔离(见7.3.4“Isolated Groups”)。如果此标志为true,组内对象合成在完全透明的初始背景上;如果为false,它们合成在组的背景上。默认值:false。
在页面的组属性字典中,此条目的解释略有不同。通常情况下，将页面直接加到输出介质上,页面组会被有效地隔离，应忽略指定的I值。但如果该页面反过来用作其他页面的元素，则应把它视为一个透明组XObject;应按常规方式解释I值,以确定页面组是否被隔离。
K	boolean	(可选)一个标志，指定透明组是否为抠图组(见7.3.5“Knockout Groups”)。如果此标志为false,则组内后面的对象应与之前的重叠对象合成; 如果为true,则应将对象与组的初始背景合成, 而且应覆盖(“knock out”)任何之前的重叠对象。默认值:false
透明组XObject的内容流定义属于该组的图形对象。在XObject上调用Do操作符执行它的内容流，并合成结果组的颜色、形状和不透明度到组的父组或页面中，就像它们来自一个基本图形对象一样。Do除了执行form XObject(如4.9“Form XObjects”所述)的常规动作外,还执行以下动作:
● 如果透明组是非隔离的(其组属性字典中I条目的值为false),则其初始背景(在 XObject的BBox条目指定的边界框)定义为父组或页面的累积颜色或alpha,也就是说,之前已在父对象中绘制的所有内容的结果。但是,如果父对象是击倒组,则初始背景应与父对象的背景相同。如果组是隔离的(I为true),则其初始背景定义为透明的。
● 在执行透明组XObject的内容流之前,应把图形状态中的当前混合模式初始化为 Normal,把当前描边和非描边alpha常量初始化为1.0,把当前的软遮罩初始化为None。
注意:在开始执行时初始化这些图形状态参数的目的是确保它们不会被应用两次:一次是将成员对象绘制到组中时,另一次是将组绘制到父组或页面中时。
● 由透明组 XObject内容流中的操作符绘制的对象,应根据7.2.2节“Basic Compositing Formula”中所述的规则被合成在组中。在此计算过程中应遵从组属性字典中的击倒标志(K)和图形状态中与透明度相关的参数。
● 如果在组属性字典中指定了组颜色空间(CS),则在合成对象到组之前，所有绘制操作符应转换源颜色到该颜色空间,而且在该颜色空间中解释每个点生成的颜色。如果未指定组 颜色空间,则应从父组或页面动态继承存在的颜色空间。(除非另有说明,页面组的颜色空间应 从输出设备的原生颜色空间继承)。
● 在执行了透明组XObject的内容流后,应将图形状态恢复到调用Do操作符之前的状态(与任何格式XObject一样)。组的形状(绘制到组中的所有对象的集合，由组XObject的边界框剪切)然后在父组或页面中绘制，在每个点使用组的累积颜色和不透明度。 
注意：如果对给定的透明组XObject多次调用Do操作符,则应将每次调用视为一个单独的透明组。也就是说,结果就像在每次调用中将组与背景独立合成。对呈现的格式XObjects进行缓存的应用程序必须考虑到这一需求。
上述动作仅应适用于透明组XObject,即一个格式XObject,其Group条目指定一个组子类型(S)为Transparency的组属性子字典。没有Group条目的普通格式XObject,不应因透明目的而遵循任何组行为。也就是说,它包含的图形对象应单独合成,就像将它们直接绘制在父组或页面中一样。
7.5.6 Patterns and Transparency底纹与透明度
在透明成像模型中,构成平铺底纹(见4.6.2“Tiling Patterns”)的底纹单元的图形对象可包括透明对象和透明组。绘制底纹时,透明合成可发生在该底纹单元内以及该单元与背景之间。同样地,渐变底纹(见4.6.3“Shading Patterns”)与其背景合成,就像使用sh操作符应用 渐变字典一样。
在这两种情况下,底纹定义应被视为把底纹隐式地包围在非隔离的透明组中:非击倒组用于平铺底纹,击倒组用于渐变底纹。在对其进行求值时，该定义不应继承图形状态参数的当前值;只有在以后将生成的底纹用于绘制对象时,那些参数才应有效。相反,图形状态参数应按以下方式进行初始化:
● 对于透明组来说,那些与透明度相关的参数(混合模式、软遮罩和alpha常量)始终应被初始化为其标准默认值。
● 所有其他参数均应被初始化为其在内容流(比如页面或格式XObject)开始时的值,底纹在该内容流中定义为资源。这是所有底纹的常规行为,在不透明和透明成像模型中都一样。
● 对于渐变底纹,参数值可以通过底纹字典中的ExtGState条目的内容进行扩充(参见章节4.6.3“Shading Patterns”)。只使用那些影响sh操作符(如当前转换矩阵和渲染意图)的参数。不应使用影响路径绘制操作符的参数,因为执行sh不需要绘制路径。
● 如果渐变字典具有Backgound条目,在调用sh操作符之前，应使用指定的背景色填充底纹的隐含透明组。
以后使用该底纹绘制图形对象时,通过对底纹定义求值得到的颜色、形状和不透明度值,应被用作透明合成公式中的对象源颜色(Cs)、对象形状(fj)和对象不透明度(qj)。这个绘制操作取决于当时生效的图形状态参数的值，类似于采用固定颜色绘制对象。
与不透明成像模型不同,在该模型中可对平铺底纹的底纹单元进行一次性求值,然后无限次地进行复制以填充绘制的区域,在正常透明情形下的效果类似于独立对每次平铺重新执行底纹定义,同时考虑每个点的背景色。但是通常情况下,底纹完全由采用Normal混合模式绘制的对象组成,此行为能通过将底纹单元视为一个隔离组进行优化。由于在此情况下的结果只依赖于底纹单元的颜色、形状和不透明度,与背景的这些属性无关,因此可对底纹单元进行一次性求值,然后进行复制,完全类似于不透明绘制。
注意:在基于光栅的平铺实现中，将所有的平铺合起来视为一个单一的透明组很重要。这可避免由于沿相邻平铺之间的边界多次标记像素而生成的假像。
前面的讨论同时适用于彩色(PaintType1)和非彩色(PaintType2)平铺底纹。在后一种情况下，非彩色底纹的定义不能指定颜色的限制也扩展到该定义可能包含的任何透明组。但是,在图形状态中指定与透明度相关的参数，没有相应的限制。
7.6 Color Space and Rendering Issues
本节描述Adobe成像模型中颜色规范和渲染的透明度和其他方面之间的相互作用。
7.6.1 Color Spaces for Transparency Groups
如7.5.5“Transparency Group XObjects”所述,透明组应有其自己显式声明的颜色空间,或继承其父组的颜色空间。在任何一种情况下,组内源对象的颜色应被转换到该组的颜色空间，如有必要,而且所有混合计算和合成计算均应在该颜色空间中完成(见7.2.3“Blending Color Space”)。当将组与其背景合成时,应在该颜色空间中解释生成的颜色。

在此约定下,可以想像出来,一个给定艺术品块的全部或大部分将在单一颜色空间中创建,最有可能的情况是, 在生成它的应用程序的工作颜色空间中创建。将独立生成的艺术品组合在一个页面上时,通常会出现使用多个颜色空间的情形。在把所有艺术品(artwork)放置在一个页面上后,从组的颜色空间到该页面的设备颜色空间的转换将在最后一步完成,无需任何进一步的透明合成。但是,透明成像模型却不要求执行此转换;采用此做法的理由是,避免不必要的颜色空间转换而丢失颜色信息或引入错误。
只有隔离的组可能有一个显式声明的自己的颜色空间。非隔离组应从父组继承颜色空间(页面组需要进行特殊处理,如7.3.6“Page Group”)。这是因为在非隔离组中使用显式颜色空间，需要将来自背景颜色空间的颜色转换到组的颜色空间,以执行合成计算。此转换也许是不可能的(因为有些颜色转换只能在一个方向进行),而且即使有可能,也需要进行大量颜色转换。
组颜色空间的选择对产生的结果有显著的影响:
● 如7.2.3“Blending Color Space”所述,在设备颜色空间中合成的结果与设备有关。为了使合成计算与设备无关,组的颜色空间必须是基于CIE的。
● 选择CIE-based组颜色空间的结果是,只能使用CIE-based空间指定组中对象的颜色。这是因为从设备到CIE-based颜色转换通常是不可能的;定义的转换只在相反的方向起作用。见后续进一步讨论。
● 合成计算和混合函数通常在假设颜色分量值本身是线性的基础上，计算颜色分量值的线性组合。因此,通常最好选择具有线性gamma函数的组颜色空间。如果选择非线性颜色空间，结果仍然是定义良好的，但外观可能不符合用户的期望。注意，CIE-based的sRGB颜色空间(见4.5.4“基于 CIE的颜色空间”)是非线性的,因此可能不适合用作组颜色空间。 
注意:在合成计算期间和在累积的组结果中,透明成像模型的实现建议使用尽可能高的精度来表示颜色。为最小化舍入误差的累积，并避免使用线性组颜色空间所产生的额外误差,中间结果需要比通常用于表示原始源数据或最终光栅化结果的精度更高。
如果组的颜色空间(无论是显式指定还是从父组继承)是CIE-based,任何使用设备颜色空间绘制对象应进行特殊处理。设备颜色不能直接绘制到这样的组中,因为没有常规定义的方法可将他们转换到CIE-based颜色空间。此问题会在下列情况下出现:
● DeviceGray、DeviceRGB和 DeviceCMYK 颜色空间,除非重新映射到默认的CIE-based颜色空间(见4.5.4“Default Color Spaces”);
● 操作符(如rg)隐式指定设备颜色空间，除非重新映射该空间; 
● 特殊的颜色空间，其基本或底层空间是设备颜色空间,除非重新映射该空间。
当定义一个透明组的颜色空间是CIE-based时，建议始终使用默认的颜色空间重映射机制。如果指定了设备颜色且未进行映射，则会以依赖于实现的方式将其转换为CIE-based颜色空间，从而产生不可预知的结果。
注意:如果组的颜色空间被隐式地转换到DeviceCMYK,则上述限制不适用,如4.5.4“Implicit Conversion of CIE-Based Color Spaces”。
7.6.2 Spot Colors and Transparency
前面关于颜色空间的讨论涉及到印刷颜色( process colors)――那些由输出设备的印刷着色剂组合产生的颜色。印刷颜色可在设备的原生颜色空间(如DeviceCMYK)中直接指定,也可从某个其他颜色空间转换生成,比如CIE-based(CalRGB或ICCBased)空间。无论使用什么方法来指定它们,印刷颜色都可以在组的颜色空间之间进行转换。
专色是一个额外的颜色分量,独立于那些用于生成印刷颜色的颜色分量。它可表示要生成的附加分色,也可表示要应用于合成页面的附加着色剂(见4.5.5“Separation Color Space”和“DeviceN Color Space”)。专色的颜色分量值或色调(tint)指定相应专色着色剂的浓度。色调通常被表示为减色值而不是加色值。
专色本来与设备相关且不是始终可用。在不透明成像模型中,每次使用Separation或 DeviceN颜色空间中的专色分量伴随着一个备用颜色空间(alternate color space)和将色调值映射到该空间的色调转换函数( tint transformation function)。当相应专色着色剂在设备上不可用时,颜色可以近似于印刷着色剂。
专色可以直接适应透明成像模型(与套印相关的问题除外,如7.6.3“Overprinting and Transparency”)。 当使用输出设备中可用的专色分量透明地绘制对象时,该颜色应与背景的相应专色分量合成,与执行的印刷原色合成无关。专色保留自己的特性;它不受包括在内的透明组或页面颜色空间的转换影响。如果对象是一个透明组的元素,则可能会发生以下两种情况之一:
● 组应为每个专色分量维护单独的颜色值,独立于组的颜色空间。实际上,专色通过组层次结构直接传递到设备,而不执行颜色转换。但是,它仍应和使用相同专色的其他对象混合或合成。
● 专色被转换到其备用颜色空间。生成的颜色然后遵从通常的印刷颜色合成规则。具体地讲, 专色在用于定义软遮罩的透明组XObject中不可用;在这种情况下，总使用备用颜色空间代替。
在计算的组结果中,只应为每个点维护一个形状值和不透明度值;它们同时适用于印刷原色分量和专色分量。实际上,每个对象都被认为是在绘制每个现有的颜色分量,包括印刷颜色分量和专色分量。如果给定对象中的给定分量没有显式指定值，则假设加色值为1.0(或减色值为0.0)。例如, 当使用DeviceCMYK或ICCBased颜色空间指定的颜色绘制对象时,印刷原色分量采用指定的颜色进行绘制,而专色分量采用加色值1.0进行绘制。同样,当使用在Separation颜色空间中指定的颜色绘制对象时,命名专色采用指定的颜色进行绘制,而所有其他分量(包括印刷原色和其他专色)应采用加色值1.0进行绘制。此操作的结果将在7.6.3“Overprinting and Transparency”中讨论。
不透明成像模型还允许单独处理印刷颜色分量，就像它们是专色一样。例如，可以指定一个命名为Cyan的Separation颜色空间，它在一个CMYK输出设备上只绘制青色分量。但是,这种能力扩展到透明组非常难。通常，组中的颜色分量并不是印刷着色剂本身，而是在对组(可能也包括它的一些父组)的所有颜色合成计算完成之后,才转换为印刷着色剂。例如，如果组的颜色空间是ICCBased，则组没有要绘制的Cyan分量。因此，只允许在继承输出设备的原生颜色空间的组中，将印刷颜色分量视为专色。
7.6.3 Overprinting and Transparency套印和透明度
在不透明成像模型中,套印由图形状态的两个参数控制:套印参数和套印模式(见4.5.6“Overprint Control”)。绘制对象会导致标记一些特定的设备着色剂集合,这由图形状态中的当前颜色空间和当前颜色决定。其余着色剂被擦除或保持不变,具体取决于套印参数是false还是true。当前颜色空间为DeviceCMYK时,根据分量值是零还是非零,套印模式参数还能够使选择的着色剂标记应用于各个颜色分量。
由于套印模型直接处理设备着色剂的绘制,独立于指定源颜色的颜色空间,它高度依赖于设备，主要满足生产需求，而不是设计意图。套印通常用于不透明着色剂或很深的颜色,比如黑色。当实际的设备着色剂集已经确定时，它也会在后期生产操作中被调用，比如凹印((参见10.10.5“Trapping Support”)。
因此,最好认为透明度发生在外观空间,而设备着色剂的套印发生在设备空间。这就意味着,在输出时做着色剂套印决定，基于任何透明合成操作产生的实际结果着色剂。另一方面,利用混合模式,也能以设备无关的方式实现类似于套印的效果,如下条所述。
Blend Modes and Overprinting
如 7.6.2“Spot Colors and Transparency”所述,绘制的每个图形对象影响所有现存的颜色分量:透明组颜色空间的所有印刷着色剂以及任何可用的专色着色剂。对于尚未指定值的颜色分量,假定源颜色值为1.0;当对象完全不透明且使用Normal混合模式时,这应具有擦除那些分量的效果。这种处理与把套印参数设置为false的不透明成像模型的行为一致。
透明成像模型定义一些混合模式，比如Darken，能用于实现类似于套印效果的。Darken的混合函数是: 
B(cb ,cs)=min(cb ,cs)
在此混合模式下,当源颜色为1.0时,合成的结果始终与背景色相同,对于所有未指定的颜色分量也一样。当背景是完全不透明时,这应使结果色不随背景色变化。这与把套印参数设置为true的不透明成像模型的行为一致。
如果对象或背景不完全不透明,上述行为会相应地改变。也就是说,擦除效果减弱,并且套印颜色值为1.0的对象可影响结果色。无论这些结果是否有用,它们都超出了不透明成像模型中定义的套印与擦除行为的范围。
当套印或擦除(因为正在绘制专色)印刷原色时,上述混合计算应对组颜色空间中的每个分量独立完成。如果该空间与输出设备的原生颜色空间不同,则其分量不是该设备的实际印刷原色着色剂;仅在将组的结果转换到设备颜色空间后，混合计算才影响印刷着色剂。因此,其效果与直接套印或擦除设备的印刷着色剂的效果不同。另一方面,这是一个完全通用的操作，无论对象的类型或产生源颜色的计算是什么，它都是一致工作的。
到目前为止,讨论的重点一直是那些未指定值而且将被擦除或保持不变的颜色分量。但是,用于这些目的的Normal或Darken混合模式可能不适合在指定颜色值的分量上使用。具体地讲,对此类分量使用Darken混合模式会妨碍用较浅的颜色套印深色。而且,这些分量可能特别需要其他混合模式。
PDF图形状态只指定一个当前混合模式参数,该参数始终应用于印刷原色着色剂,有时也用于专色着色剂。特别地,只有可分的、保留白色的混合模式可用于专色。如果其混合函数B具有属性B(1.0,1.0)=1.0,则该混合模式是保留白色( white-preserving)。在7.2.4“blend mode”的表7.2列出的标准可分混合模式中,除 Difference和Exclusion外都是保留白色的。如果指定的混合模式不是可分和保留白色的,则它只应用于印刷原色分量,对于专色,则应替换为Normal混合模式。这确保当对象在隔离透明组中累积时,只要仅使用保留白色的混合模式,未指定分量的累积值仍是1.0。然后可以使用Darken(或其他有用的模式)套印组的结果,同时避免与组内从未指定值的分量之间意外的相互影响。
Compatibility with Opaque Overprinting
因为使用混合模式实现类似于套印的效果，而不直接使用图形状态中的套印控制参数,所以此类方法只对透明感知的应用程序有用。为了与在不透明成像模型中使用的套印控制方法兼容,现提供了一种特殊混合模式CompatibleOverprint,它考虑与套印相关的图形状态参数来计算其结果。此模式只适用于绘制基本图形对象(填充、描边、图像和渐变)。它永远不会被显式调用,也不会被任何PDF名称对象标识;相反,当绘制基本图形对象并启用套印时(即图形状态的套印参数为true),它应被隐含地调用。
注意:透明成像模型的早期设计包括名为Compatible的额外混合模式,它显式调用这里介绍的CompatibleOverprint混合模式。因为现在CompatibleOverprint只在适当时被隐式调用,所以没有必要指定Compatible混合模式用于合成。出于兼容性的考虑，它仍然被认为是一个有效的混合模式，但被简单地视为等同于Normal。
CompatibleOverprint模式中混合函数B(cb,cs)的值应是cb或cs,具体取决于套印模式参数的设置、当前颜色空间和组颜色空间,以及源颜色值cs:
● 如果套印模式为1(非零套印模式),并且当前颜色空间和组颜色空间都是DeviceCMYK,则具有非零值的印刷原色分量取代背景的相应分量值;值为零的分量保持现有的背景值不变。也就是说,混合函数B(cb,cs) 的值是源分量cs，对于其(减色)颜色值为非零的任何印刷原色(DeviceCMYK)分量;否则应是背景分量cb。对于专色分量,值应始终是cb。
● 在所有其他情况下,对在当前颜色空间中指定的所有颜色分量,B(cb,cs)的值为cs,否则 为cb。例如，如果当前颜色空间为DeviceCMYK或CalRGB,则对于印刷原色分量混合函数的值为cs;对于专色分量则为cb。另一方面,如果当前颜色空间是表示专色分量的Separation空间,则对于该专色分量其值为cs,对于所有印刷原色分量和所有其他专色分量则为cb。
注意:在上述描述中,术语当前颜色空间指用于绘制操作的颜色空间。这可由图形状态中的当前颜色空间参数指定(见4.5.1“Color Values”),或由rg等颜色操作符(4.5.7“Color Operators”)隐式地指定,或由图像XObject(4.8.4“Image Dictionaries”)的ColorSpace条目指定。对于Indexed空间,它是指基本颜色空间(见4.5.5“Indexed Color Spaces”);对于 恢复到其备用颜色空间的Separation和 DeviceN空间,情况相同,如4.5.5节“Separation Color Spaces”和“DeviceN Color Spaces”所述。
当调用CompatibleOverprint时,如果当前混合模式为Normal之外的任何模式,则被绘制的对象将隐式地视为它定义在一个非隔离、非knockout透明组中，并使用 CompatibleOverprint混合模式绘制。然后应使用图形状态中的当前混合模式绘制组的结果。
注意:如果当前混合模式为Normal,则没有必要创建此类隐式透明组;在绘制对象时简单替代CompatibleOverprint 混合模式会生成等效的结果。还有一些其他情况能优化掉隐式透明组。
图 L.20展示了混合和套印的全部四种可能的组合,使用的是DeviceCMYK 颜色空间中的Screen混合模式。标签“overprint enabled”意思是图形状态中的套印参数为true且套印模式为1。在图的上半部分,绘制了一个不透明的浅绿色椭圆形(不透明度=1.0),背景是从纯黄到纯品红色的渐变(shading)。在图的下半部分,采用透明方式(不透明度=0.5)绘制了相同的对象。
Special Path-Painting Considerations
上面讨论的套印考虑事项也会影响那些将填充和描边结合在一个操作中的路径绘制操作。这包括B、B* 、b和b* 操作符(见4.4.2“Path-Painting Operators”)和采用文本呈现模式2或6(见5.2.5“Text Rendering Mode”)绘制字形。出于透明合成目的,应将组合的填充和描边视为单个图形对象,类似于它们被包含在一个透明组中。此隐式组的建立和使用方式如下:
● 如果启用套印(图形状态中的套印参数为true)且当前的描边和非描边alpha常量相等,则应建立一个非隔离、非击倒的透明组。在该组内,使用值为1.0的alpha进行填充和描边,但采用CompatibleOverprint混合模式。然后应使用最初指定的alpha和混合模式，将组结果与背景合成。 
● 在所有其他情况下,应建立非隔离击倒组。在组内，填充和描边是根据它们各自的主要(prevailing，存在)alpha常数和主要混合模式来执行。然后使用值为1.0 的alpha和 Normal混合模式，将组结果与背景合成。
在采用组合的填充和描边文本呈现模式显示文本的情况下,此行为与图形状态中的文本击倒参数无关(见5.2.7“Text Knockout”)。
这些规则的目的是为了避免将非不透明描边与重叠区域的填充结果合成,这会生成通常不想要的双边效果。 在套印参数为true时,应用的特殊情况是为向后兼容不透明成像模型的套印行为。如果组合填充和描边操作符或文本渲染模式不能达到预期的效果，可以通过使用单独的路径对象和一个显式透明组指定填充和描边来实现。
注意:在填充上描边的套印在上述第二种情况下不起作用(尽管填充或描边仍能套印背景)。此外,如果套印图形状态参数为true,则结果在描边和非描边alpha常量相等与不相等之间过渡时是不连续的。因此,如果描边和非描边alpha常量是独立变化的,最好不对组合的填充和描边操作使用套印。
Summary of Overprinting Behavior套印行为小结
表7.14和表7.15分别对不透明和透明成像模型中的套印和擦除行为进行了总结。表7.14展示了在不透明模型中使用的套印规则,如4.5.6“Overprint Control”所述。表7.15展示了在透明模型中采用CompatibleOverprint混合模式实现的等效规则。表中的名称OP和OPM指图形状态的套印(overprint)参数和套印模式( overprint mode)参数。
TABLE 7.14 Overprinting behavior in the opaque imaging model

TABLE 7.15 Overprinting behavior in the transparent imaging model

颜色分量值在这些表中被表示为减色的色调值,因为套印通常应用于减色的着色剂(比如油墨)而不是加色的着色剂，比如显示屏上的荧光。因此,CompatibleOverprint混合模式被描述为接收减色的参数并返回减色的结果。但实际上,CompatibleOverprint(与所有混合模式一样)将颜色分量视为加色的值;减色的分量必须在应用混合函数之前及之后进行补色。
请注意这两个表之间的一个重要区别。在表7.14中,讨论的印刷原色分量是实际的设备着色剂―――输出设备的原生颜色空间(DeviceGray、DeviceRGB或DeviceCMYK)的颜色分量。在表7.15中,印刷原色分量是组颜色空间的分量,此颜色空间不一定与输出设备的颜色空间相同(甚至类似于 CalRGB或ICCBased)。因此,组颜色空间的印刷原色分量不能被视为Separation或 DeviceN 颜色空间的专色(见7.6.2, “Spot Colors and Transparency”)。不透明和透明套印与擦除规则之间的区别仅出现在透明组中(包括页面组,如果其颜色空间不同于输出设备的原生颜色空间)。对专色分量的处理没有差异。
表7.15的底部多了一行。它适用于绘制一个透明组而不是基本对象(填充、描边、文本、图像或渐变)的对象。 如7.6.2“Spot Colors and Transparency”所述，组被视为绘制所有颜色分量,包括印刷原色分量和专色分量。没有被组中任何对象显式绘制的颜色分量的加色值为1.0(减色调为0.0)。由于未保留组内实际绘制了哪些分量的信息，因此在此情况下不可能有兼容套印;CompatibleOverprint混合模式恢复为Normal,无需考虑套印参数和套印模式参数。透明感知的应用程序可以选择更合适的混合模式，如Darken，以产生类似于套印的效果。
7.6.4 Rendering Parameters and Transparency
不透明成像模型有几个处理颜色呈现的图形状态参数:当前半色调(见6.4.4“Halftone Dictionaries”)、变换函数(见6.3“Transfer Functions”)、呈现意图(见4.5.4“Rendering Intents”),以及黑底生成和底色去除函数(见6.2.3“Conversion from DeviceRGB to DeviceCMYK”)。所有这些呈现参数都可为每个对象分别指定;它们控制一个特定对象如何呈现。当所有对象都不透明时,很容易定义其含义。但当它们透明时,多个对象可对给定点的颜色有贡献;目前不清楚哪些呈现参数应用于透明对象重叠的区域。同时,当只绘制不透明 对象时,透明成像模型应当与不透明模型一致(consistent)。
此外，一些渲染参数，特别是半色调和变换函数，只能在已知给定点的最终颜色时使用。在透明的情况下，处理这些参数必须与渲染意图、黑色生成和底色去除参数有所不同，渲染意图、黑色生成和底色去除参数用于将颜色从一个颜色空间转换到另一个颜色空间。当对象是透明的，对象的渲染不会在指定对象时发生，而是在稍后的时间渲染。因此，对于前一类中的呈现参数，实现必须在每个点上跟踪呈现参数，从指定它们时到实际发生呈现时。这意味着这些呈现参数必须与页面的区域相关联，而不是与单个对象相关联。
Halftone and Transfer Function半色调和转换函数
在页面上任何给定点上使用的半色调函数和转换函数，是在绘制最后一个(最上面的)包含该点的基本图形对象时生效的函数，但只有在该对象是完全不透明的情况下才有效。(只有基本对象是相关的;与组对象关联的呈现参数将被忽略。) 任何一点的最顶层对象被定义为整个页面堆栈中在该点(即该点位于对象内部)具有非零对象形状值(fj)的最顶层基本对象。在绘制对象时，如果满足以下所有条件，则该对象被认为是完全不透明的:
● 图形状态(描边或非描边,取决于绘制操作)的当前alpha常量为1.0; 
● 图形状态的当前混合模式为Normal(或Compatible,被视为与Normal等效); 
● 图形状态的当前软遮罩为None。如果对象是图像XObject,则在它的图像字典中不存在SMask条目; 
● 在为包含对象的组以及任何直接祖先组调用Do操作符时,前面三个条件也为真; 
● 如果当前颜色是平铺底纹,其底纹单元定义的所有对象也满足前面的条件。
这些条件一起确保只有对象本身在给定点上贡献颜色,完全遮盖了背景。对于最顶层对象不是完全不透明或根本未绘制的页面部分,则应使用页面的默认半色调和转换函数。
注意：如果图形对象是在启用套印的情况下绘制的,即图形状态中适用的(描边或非描边)套印参数为ture,则在给定的点上使用的半色调和转换函数必须为每个颜色分量独立确定。套印隐含地调用CompatibleOverprint混合模式(见7.6.3“Compatibility with Opaque Overprinting”)。仅当CompatibleOverprint生成给定分量的源颜色(不是背景色)时,对象才应被视为不透明。
Rendering Intent and Color Conversions
渲染意图、黑色生成和底色去除参数需要以不同的方式处理。渲染意图影响从CIE-based颜色空间到目标颜色空间的转换，同时考虑目标空间的色域(它可以重现的颜色范围)。然而，在不透明成像模型中，目标空间总是输出设备的原生颜色空间，而在透明模型中，它可能是在其中绘制对象的透明组的组颜色空间。
在必须执行这种转换的时刻，渲染意图是必需的――也就是说，当绘制一个在CIE-based颜色空间中指定的基本对象或组对象到具有不同颜色空间的父组时。这与当前的半色调和转换函数不同，后者的值仅在所有的颜色合成完成并执行光栅化时才使用。
在所有情况下,用来转换对象颜色(无论是基本对象的颜色还是透明组的颜色)的呈现意图是由与对象相关的呈现意图参数决定的。具体地讲:
● 当使用CIE-based颜色将一个基本对象绘制到具有不同颜色空间的透明组中时，所使用的呈现意图是在执行绘制操作时在图形状态中有效的当前呈现意图。
● 当绘制颜色空间是CIE-based的透明组到具有不同颜色空间的父组中时，所使用的呈现意图是在对组应用Do操作符时有效的当前呈现意图。
● 当页面组的颜色空间为CIE-based时,用于转换颜色到输出设备的原生颜色空间的呈现意图是该页面的默认呈现意图。
注意:由于可能有一个或多个具有不同的CIE-based颜色空间的嵌套透明组,因此基本源对象的颜色可以在多个阶段转换为设备颜色空间,由每个阶段有效的呈现意图控制。每个阶段呈现意图的正确选择取决于源颜色空间和目标颜色空间的相对色域。它是由文档生成器显式指定的，而不是由PDF规范指定的，因为没有一种管理呈现意图的策略适用于所有情况。
类似的做法同样适用于黑色生成函数和底色去除函数,它们只在转换DeviceRGB到DeviceCMYK颜色空间的过程中应用:
● 当使用DeviceRGB颜色直接绘制一个基本对象到颜色空间为DeviceCMYK 的透明组时,所使用的函数是在执行绘制操作时 图形状态中有效的当前黑色生成函数和底色去除函数; 
● 当绘制颜色空间为DeviceRGB的透明组到颜色空间为DeviceCMYK的父组时,所用函数是在对组应用Do操作符时有效的函数; 
● 当页面组的颜色空间为DeviceRGB，并且输出设备的原生颜色空间为DeviceCMYK时,用于转换颜色到设备颜色空间的函数 是该页面的默认函数。
7.6.5 PostScript Compatibility
因为PostScript语言不支持透明成像模型，PDF 1.4用户应用程序必须有一些方法转换使用透明的文档外观为纯粹不透明的描述，以便在PostScript输出设备上打印。还可以使用类似的技术转换此类文档为PDF 1.3和更早的用户可以正确查看的形式。
将页面内容从透明形式转换为不透明形式需要结合一些形状分解和预渲染，来压平页面上透明对象的堆栈，执行所有需要的透明计算，并只使用不透明对象描述最终外观。页面是否包含需要压平的透明内容，可以通过直接分析页面资源来确定;不需要分析内容流本身。转换成不透明形式是不可逆的，因为所有关于透明效果如何产生的信息都丢失了。
为了正确地执行透明度计算，应用程序需要知道输出设备的原生颜色空间。当应用程序直接控制输出设备时，这是没有问题的。然而，当生成PostScript输出时，应用程序无法知道PostScript输出设备的原生颜色空间。错误的假设将破坏页面上出现的任何CIE-based颜色的校准。这个问题可以用两种方法来解决：
● 如果整个页面由CIE-based颜色组成，则将这些颜色压平为单个CIE-based颜色空间，而不是设备颜色空间。如果页面有一个组属性字典(页面对象中的Group条目)指定了一个CIE-based颜色空间(参见7.5.5“Transparency Group XObjects”)，那么用于此目的的首选颜色空间可以很容易地确定。 
● 否则，用预定的校准将颜色压平到某些假定的设备颜色空间。在生成的PostScript输出中，在CIE-based颜色空间中绘制具有该校准的已压平的颜色。
因为在使用专色剂和将它们转换为备用颜色空间之间的选择影响印刷原色的平坦效果，所以在PostScript转换期间还必须决定可用的专色剂的设置。(这与严格的不透明绘制不同，后者可以推迟到执行生成的PostScript代码。)
CHAPTER 8 Interactive Features交互功能
本章描述了允许用户使用鼠标和键盘在屏幕上与文档交互的PDF特性(多媒体特性除外，在第9章“Multimedia Features”中描述):
1.Preference settings（首选项设置）控制文档在屏幕上显示的方式(第8.1节“Viewer Preferences”)
2.Navigation facilities（导航工具）以各种方式移动文档(第8.2节“Document-Level Navigation”和第8.3节“Page-Level Navigation”)
3.Annotations（注释）用于向文档添加文本备注、声音、电影和其他辅助信息(第8.4节，“Annotations”)
4.Actions（动作）可由指定的事件触发(第8.5节“Actions”)
5.Interactive forms（交互式表单）用于从用户收集信息(Section 8.6, “Interactive Forms”)
6.Digital signatures（数字签名）验证用户身份和文档内容有效性(Section 8.7, “Digital Signatures”)
7.Measurement properties（测量属性），使在页面上显示真实世界单位对应的对象(8.8节，“Measurement Properties”)
8.1 Viewer Preferences 视图首选项
文档目录(见3.6.1节，“Document Catalog”)中的ViewerPreferences条目指定了一个视图首选项字典（viewer preferences dictionary，PDF 1.2），控制文档在屏幕上显示或打印的方式。如果没有指定这样的字典，查看和打印应用程序应该按照它们自己当前的用户首选项设置进行操作。表8.1显示了视图首选项字典的内容。
TABLE 8.1 Entries in a viewer preferences dictionary
KEY	TYPE	VALUE
HideToolbar 	boolean	(可选) 一个标志，指定当文档处于活动状态时是否隐藏查看器应用程序的工具栏。默认值:false。
HideMenubar 	boolean	(可选) 一个标志，指定当文档处于活动状态时是否隐藏查看器应用程序的菜单栏。默认值:false。
HideWindowUI 	boolean	(可选) 一个标志，指定是否隐藏文档窗口中的用户界面元素(如滚动条和导航控件)，只显示文档内容。默认值:false。
FitWindow 	boolean	(可选) 一个标志，指定是否调整文档窗口的大小以适应第一个显示页面的大小。默认值:false。
CenterWindow 	boolean	(可选) 一个标志，指定文档窗口是否位于屏幕中心。默认值:false。
DisplayDocTitle 	boolean	(可选;PDF1.4) 一个标志，指定窗口的标题栏是否应该显示从文档信息字典的title条目中获取的文档标题(参见章节10.2.1， “Document Information Dictionary”)。如果为false，标题栏应该显示包含该文档的PDF文件的名称。默认值:false。
NonFullScreenPageMode 	name	(可选) 文档的页面模式(page mode)，指定在退出全屏模式时如何显示文档: 
UseNone      文档大纲和缩略图都不可见
UseOutlines    文档大纲可见
UseThumbs    缩略图可见
UseOC        可选的内容组面板可见 
只有当目录字典(参见3.6.1节“Document Catalog”)中的PageMode条目的值是FullScreen时，这个条目才有意义; 否则将被忽略。默认值:UseNone。
Direction 	name	(可选;PDF 1.3)文本的主要阅读顺序:
L2R Left to right，从左向右
R2L Right to left，从右向左(包括垂直书写系统，如中文、日文和韩文)
该条目对文档的内容或页码没有直接影响，但可以用来确定并排显示或打印时页面的相对位置。默认值:L2R。
ViewArea 	name	(可选;PDF1.4) 页面边界的名称，表示在屏幕上查看文档时要显示的页面区域。该值是在页面对象中指定相对于页面边界的键(参见第144页的 “Page Objects”和第10.10.1节 “Page Boundaries”)。如果指定的页面边界没有在页面对象中定义，则使用其默认值，如第145页的表3.27所示。默认值:CropBox。
注:该条目主要用于印前应用程序解释或操作页面边界，如10.10.1 “Page Boundaries” 所述。大多数PDF用户应用程序不使用它。
ViewClip 	name	(可选;PDF1.4) 当在屏幕上查看文档时，页面内容要裁剪到的页面边界的名称。该值是在页面对象中指定相关页面边界的键(参见第144页的 “Page Objects”和第10.10.1节 “Page Boundaries”)。如果指定的页面边界没有在页面对象中定义，则使用其默认值，如第145页的表3.27所示。默认值:CropBox。
PrintArea 	name	(可选;PDF1.4) 页面边界的名称，表示打印文档时要呈现的页面区域。该值是在页面对象中指定相关页面边界的键(参见第144页的 “Page Objects”和第10.10.1节 “Page Boundaries”)。如果指定的页面边界没有在页面对象中定义，则使用其默认值，如第145页的表3.27所示。默认值:CropBox。
注:该条目主要用于印前应用程序解释或操作页面边界，如10.10.1 “Page Boundaries” 所述。大多数PDF用户应用程序不使用它。
PrintClip 	name	(可选;PDF1.4) 在打印文档时，页面内容要裁剪到的页面边界的名称。该值是在页面对象中指定相关页面边界的键(参见第144页的 “Page Objects”和第10.10.1节 “Page Boundaries”)。如果指定的页面边界没有在页面对象中定义，则使用其默认值，如第145页的表3.27所示。默认值:CropBox。
注:该条目主要用于印前应用程序解释或操作页面边界，如10.10.1 “Page Boundaries” 所述。大多数PDF用户应用程序不使用它。
PrintScaling 	name	(可选;PDF1.6) 当打印对话框显示此文档时，要选择的页面缩放选项。有效值为None，表示打印对话框不应反映页面缩放;有效值为AppDefault，表示应用程序应使用当前打印缩放。如果此条目具有无法识别的值，应用程序应使用当前打印缩放。默认值:AppDefault。
注意:如果打印对话框被抑制，它的参数是由应用程序直接提供的，这个条目的值应该仍然使用。
Duplex 	name	(可选;PDF1.7) 从打印对话框打印文件时使用的纸张处理选项。有效的值如下:
Simplex - 单面打印 
DuplexFlipShortEdge - 双面并在纸的短边翻转 DuplexFlipLongEdge - 双面并在纸的长边翻转
默认值：none
PickTrayByPDFSize 	boolean	(可选;PDF 1.7) 一个标志，指定是否使用PDF页面大小来选择输入的纸盒。此设置仅影响用于填充PDF查看器应用程序显示的打印对话框的预设值。如果PickTrayByPDFSize为true，打印对话框中与输入纸盒相关联的复选框被选中。
注意:此设置对Mac OS系统没有影响，它不提供按大小选择输入纸盒的能力。
默认值:由PDF查看器应用程序定义
AcPrintPageRange 	array	(可选;PDF1.7) 打印文件时初始化打印对话框的页码。PDF文件的第一页用1表示。每对都由子范围中的第一页和最后一页组成。奇数个整数会导致忽略此条目。负数会导致忽略整个数组。
默认值:由PDF查看器应用程序定义。
NumCopies 	integer	(可选;PDF1.7) 当打印对话框打开该文件时，要打印的份数。取值范围为2 ~ 5的整数。超出此范围的值将被忽略。
默认值:由PDF查看器应用程序定义，但通常为1
8.2 Document-Level Navigation
本节描述的特性允许PDF查看器应用程序以两种形式之一向用户呈现文档的交互式全局概览:
1.作为一个层级大纲(outline)显示文档的内部结构
2.作为一个缩略图(thumbnail images)的集合，以缩微形式表示文档的页面
大纲中的每个项目或每个缩略图都可以与文档中的相应目标(destination)相关联，这样用户就可以通过单击鼠标直接跳转到目标。
8.2.1 Destinations目标
一个目标(Destinations）定义了一个文档的特定视图，由以下项组成:
1.要显示的文档页面。
2.页面上文档窗口的位置。
3.显示页面时使用的放大(缩放)系数。
Destinations可能与大纲项(见8.2.2节，“Document Outline”)、注释(622页的“Link Annotations”)或动作(654页的“Go-To actions”和655页的“Remote Go-To actions”)关联。在每种情况下，当打开大纲项或注释或执行动作，目标都指定了要显示的文档视图。此外，文档目录(3.6.1节，“Document Catalog”)中的可选条目OpenAction可以指定打开文档时要显示的目标。destination可以通过定义其属性的参数数组显式指定，也可以通过名称间接指定。
Explicit Destinations
表8.2显示了在PDF文件中显式指定目标的允许语法形式。在每种情况下，page都是对页对象的间接引用。所有的坐标值(left, right, top, and bottom)都是在默认用户空间坐标系中表示。页面的边框（bounding box）是包含所有内容的最小矩形。(如果边框的任何一边位于该页的裁剪框之外，则用裁剪框对应的边替代; 关于裁剪框的进一步讨论，请参阅第10.10.1节“Page Boundaries”。)
注意:不能为remote go-to action关联的目标指定page对象(参见第655页的“Remote Go-To Actions”)，因为目标页面在不同的PDF文档中。在这种情况下，page参数指定远程文档中的页编号（page number），而不是当前文档中的page对象。
TABLE 8.2 Destination syntax
SYNTAX	MEANING
[page /XYZ left top zoom]	显示page指定的页面，位于窗口左上角的坐标(left, top)和页面内容的缩放因子zoom。任何left、top或zoom参数的空值都指定该参数的当前值将保持不变。zoom值为0与空值具有相同的含义。
[page /Fit]	显示page指定的页面，将其内容放大到整个页面在水平和垂直方向上都适合窗口。如果所需的水平和垂直放大系数不同，则使用两者中较小的，使页面在另一个维度的窗口内居中。
[page /FitH top]	显示由page指定的页面，垂直坐标top位于窗口的顶部边缘，将页面的内容放大到整个页面的宽度适合窗口。top的空值指定该参数的当前值将保持不变。
[page /FitV left]	显示由page指定的页面，水平坐标left位于窗口的左边缘，将页面内容放大到整个页面的高度适合窗口。left的空值指定该参数的当前值保持不变。
[page /FitR left bottom right top]	 显示由page指定的页面，其内容在水平和垂直方向上都被放大到刚好适合窗口内由left, bottom, right, 和top指定的矩形。如果要求的水平放大倍数和垂直放大倍数不一致，则取两者中较小的一个，使矩形在另一个维度的窗口内居中。任何参数的空值都可能导致不可预测的行为。
[page /FitB]	(PDF 1.1)显示由page指定的页面，将其内容放大，使其边框在水平和垂直方向上完全适合窗口。如果要求的水平放大倍数和垂直放大倍数不一致，则取两者中较小的一个，使边界框在另一个维度的窗口内居中。
[page /FitBH top] 	(PDF 1.1)显示由page指定的页面，垂直坐标top位于窗口的顶部边缘，页面内容被放大到整个边框的宽度刚好适合窗口。top的空值指定该参数的当前值保持不变。
[page /FitBV left]	(PDF 1.1)显示由page指定的页面，水平坐标left位于窗口的左边缘，页面的内容放大到其边框的整个高度适合窗口。left的空值指定该参数的当前值保持不变。
Named Destinations
与表8.2中所示的显式语法直接定义不同，目标可以通过名称对象(PDF 1.1)或字节字符串(PDF 1.2)间接引用。当目标位于另一个PDF文档中时，此功能特别有用。例如，在另一个文档中指向第6章开头的链接可能通过名称引用目标，比如Chap6.begin,而不是通过另一个文档中的显式页码开始。然后，另一个文档中的章节位置可以更改，而不会使链接失效。如果一个注释、大纲项引用一个命名的目标具有一个关联的动作，如remote go-to action(见“Remote Go-To Actions”655页)或一个线程动作(661页“Thread Actions”）,目标在文件中通过动作的F条目指定，如果有的话；如果没有F条目，则目标在当前文件中。
在PDF 1.1中，名称对象和目标之间的对应关系由文档目录中的Dests条目定义(见3.6.1节，“Document Catalog”)。该条目的值是一个字典，其中每个键都是目标名称，对应的值是一个定义目标的数组(使用表8.2中的语法)，或者是一个包含D条目的字典，其值就是这样一个数组。后一种形式允许附加的属性与目标相关联，并允许使用go-to动作(参见第654页的“go-to Actions”)作为named destination的目标。
在PDF 1.2中，字符串和目标之间的对应关系由文档的名称字典(见3.6.3节“Name Dictionary”)中的Dests条目定义。这个条目的值是一个名称树(第3.8.5节，“Name Trees”)，它将名称字符串映射到目标。(出于显示的目的，名称树中的键可以被视为文本字符串。)与名称树中的键相关联的目标值可以是数组，也可以是字典，如上段所述。
注意:使用字符串作为destination names是PDF 1.2的一个特性。如果需要与早期版本的PDF兼容，则只能使用名称对象来引用名称目标。支持PDF 1.2的文档可以包含这两种类型。但是，如果不考虑向后兼容性，应用程序应该在Dests名称树中使用字符串形式的表示。
8.2.2 Document Outline
PDF文档可以可选地在屏幕上显示文档大纲（document outline），允许用户以交互方式从文档的一个部分导航到另一个部分。大纲由大纲项(outline items，有时称为书签)的树形层次结构组成，作为一个可视的内容表向用户显示文档的结构。用户可以通过鼠标点击他们来交互式地打开和关闭单个项。当一个项打开时，在层次结构中它的直接子元素在屏幕上可见；每个子节点可以依次打开或关闭，有选择地显示或隐藏层次结构的更深部分。单击任何可见项的文本将激活该项，使查看器应用程序跳转到目标或触发与该项关联的操作。
文档大纲层次结构的根是一个由文档目录(catalog)的Outlines条目指定的大纲字典（outline dictionary）(见3.6.1，“Document Catalog”)。表8.3显示了本字典的内容。层次结构中的每个单独的大纲项都由大纲项字典定义(outline item dictionary,表8.4)。层次结构中每一层的项都构成一个链接列表，通过它们的Prev条目和Next条目链接在一起，在父项(如果是顶级项，则在大纲字典中)中通过First条目和Last条目访问。当在屏幕上显示时，给定级别的项将按照它们在链表中出现的顺序显示。(另见附录h的实现说明74)
TABLE 8.3 Entries in the outline dictionary
KEY	TYPE	VALUE
Type	name	(可选) 本字典描述的PDF对象类型；如果有，必须为大纲字典的Outlines关键字。
First	dictionary	(如有任何打开或关闭大纲的条目则必须;必须是间接引用)一个大纲项字典表示大纲中的第一个顶级项。
Last	dictionary	(如有任何打开或关闭大纲的条目则需要;必须是间接引用)一个大纲项字典表示大纲中最后一个顶级项。
Count	integer	(如有任何打开或关闭提纲的条目则需要)大纲所有级别上打开项的总数。如果没有打开的大纲项目这个条目应当省略。

TABLE 8.4 Entries in an outline item dictionary
KEY	TYPE	VALUE
Title	text string	(必需) 该项在屏幕上显示的文本。
Parent	dictionary	(必需的;必须是间接引用) 此项在大纲层次结构中的父项。顶级项的父类是大纲字典本身。
Prev	dictionary	(在每一级别中除了第一项外所有项都是必需的;必须是间接引用) 在这个大纲级别上的前一项。
Next	dictionary	(在每一级别中除了最后一项外所有项都是必需的;必须是间接引用) 在这个大纲级别上的后一项。
First	dictionary	(如果项目有后代则需要;必须是间接引用) 在大纲层次结构中该项的第一个直接子项。
Last	dictionary	(如果项目有后代则需要;必须是间接引用) 在大纲层次结构中该项的最后一个直接子项。
Count	integer	(如果项目有任何后代则必需) 如果项目是打开的，则为大纲层次结构中所有较低级别上打开的后代的总数。如果项已关闭，则为一个负整数，其绝对值指定重新打开项时将出现多少个后代。
Dest	name,
byte string, or 
array	(可选；如果有A项则不允许) 当该项被激活时显示的目标(见8.2.1节，“Destinations”;也见附录H的实现说明75)
A	dictionary	(可选;PDF 1.1;如果Dest条目存在，则不允许) 激活此条目时要执行的动作(action)(参见8.5节“Actions”)。
SE	dictionary	(可选;PDF 1.3;必须是间接引用) item所引用的结构元素(structure element见10.6.1节，“Structure Hierarchy”)。注意:将大纲项与结构元素(例如一章的开头)相关联的能力是PDF 1.3的特性。为了向后兼容早期的PDF版本，这样的项还应该指定一个目标(Dest)，该目标对应于一个显示指定结构元素内容的页面区域。
C	array	(可选;PDF) 一个范围为0.0到1.0的三个数字数组，表示用于大纲条目文本的颜色(color)的deviceRGB颜色空间中的分量。默认值:[0.0 0.0 0.0]。
F	integer	(可选;PDF1.4) 一组指定样式特征的标志(Flags)，用于显示大纲项的文本(见表8.5)。默认值:0。
大纲项字典的条目F(PDF 1.4)的值是一个无符号32位整数，包含指定用于显示该项的样式特征的标志。标志字内的位从1(低阶)到32(高阶)进行编号。表8.5显示了标志的含义;所有未定义的标志位都被保留并且必须设置为0。
TABLE 8.5 Outline item flags
BIT POSITION	NAME	MEANING
1	Italic	 如果设置，则以斜体显示该项。
2	Bold	如果设置了，则以粗体显示该项。
例8.1展示了一个典型的大纲字典和大纲项字典。参见附录G获得一个完整的大纲层次结构示例。
Example 8.1
21 0 obj
<< /Count 6
/First 22 0 R
/Last 29 0 R
>>
endobj
22 0 obj
<< /Title (Chapter 1)
/Parent 21 0 R
/Next 26 0 R
/First 23 0 R
/Last 25 0 R
/Count 3
/Dest [3 0 R /XYZ 0 792 0]
>>
endobj
8.2.3 Thumbnail Images
PDF文档可以定义缩略图(thumbnail images)，以微型形式表示页面内容。查看器应用程序可以在屏幕上显示这些图像，允许用户通过单击缩略图导航到一个页面。
注意:缩略图不是必需的，可能一些页面具有，而不其他页面没有。
页面的缩略图是由页面对象中的Thumb条目指定的图像XObject(参见第144页的 “Page Objects”)。它有通常的图像字典的结构(第4.8.4节“Image Dictionaries”)，但只有Width, Height, ColorSpace, BitsPerComponent和Decode条目是重要的;在340页的表4.39中列出的所有其他条目如果存在将被忽略。(如果指定了Subtype条目，它的值必须是Image。) 图像的颜色空间必须是DeviceGray或DeviceRGB，或者是基于其中之一的Indexed空间。示例8.2展示了一个典型的缩略图定义。
Example 8.2
12 0 obj
<< /Width 76
/Height 99
/ColorSpace /DeviceRGB
/BitsPerComponent 8
/Length 13 0 R
/Filter [/ASCII85Decode /DCTDecode]
>>
stream
s4IA>!"M;*Ddm8XA,lT0!!3,S!/(=R!<E3%!<N<(!WrK*!WrN,
…Omitted data…
endstream
endobj
13 0 obj % Length of stream
…
endobj
8.2.4 Collections
从PDF 1.7开始，PDF文档可以指定查看器应用程序的用户界面如何显示文件附件集合，其中附件在结构或内容上是相关的。这样的表示称为可移植集合(portable collections)。可移植集合(portable collections)的目的是显示、分类和搜索相关文档集合，如电子邮件档案、照片集合和工程投标集。不要求集合中的文件具有隐式关系甚至相似性;但是，显示相关文档的区别性特征可能有助于文档导航。
集合字典(collection dictionary)指定可移植集合的查看和组织特征。如果该字典出现在PDF文档中，则用户界面将该文档显示为可移植集合。EmbeddedFiles名称树指定了文件附件(参见3.10.3节”Embedded File Streams”)。
当兼容PDF 1.7的查看器应用程序第一次打开包含集合的PDF文档时，它必须显示初始文档的内容，以及EmbeddedFiles名称树中显示的文档列表。文档列表必须包括集合schema指定的附加文档信息。初始文档可以是容器PDF或嵌入文档之一。
初始文档中的页面内容通常包含帮助查看者理解集合中包含什么内容的信息，例如标题和介绍性段落。
包含一个集合的文件附件位于EmbeddedFiles名称树中。该树中的所有附件都在集合中;不在该树中的任何附件都不是。
集合字典中的条目如表8.6所示。
TABLE 8.6 Entries in a collection dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，则必须为集合字典的Collection。
Schema	dictionary	(可选) 集合模式字典(参见表8.7)。如果没有，PDF查看器应用程序可能会选择文件说明字典中已知的有用默认值，比如文件名、文件大小和修改日期。
D	byte string	(可选) 一个字符串，它标识EmbeddedFiles名称树中的一个条目，控制最初在用户界面中显示的文档。如果D条目缺失或出错，初始文档就是包含集合字典的文档。
View	name	(可选) 初始视图。有效的值如下:
D    集合视图以详细模式呈现，Schema字典中的所有信息以多列格式呈现。这种模式可以向用户提供最多的信息。
T    集合视图以平铺模式呈现，集合中的每个文件由一个小图标和来自Schema字典的信息子集表示。此模式为用户提供关于文件附件的顶级信息。
H    集合视图最初是隐藏的，不会阻止用户通过显式操作获取文件列表。
默认值：D
Sort	dictionary	(可选) 一个集合排序字典，它指定集合中的项在用户界面中排序的顺序(参见592页的表8.9)。
一个集合模式字典(collection schema dictionary)由数量可变的单个集合字段字典组成。每个集合字段字典都有一个由生产者选择的键，该键用于将字段与文件说明中的数据关联起来。表8.7描述了集合模式字典中的条目。
TABLE 8.7 Entries in a collection schema dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，则必须为集合模式字典的CollectionSchema。
Other keys chosen by producer	dictionary	(可选)每个字典条目都是集合字段字典。
每个键名都由生产者自行选择。每个集合字段字典的键名用于在文件说明字典中标识相应的集合项字典。
集合字段字典(collection field dictionary)描述可移植集合中特定字段的属性，包括存储在字段中的数据类型和用于在文件说明字典中定位字段数据的查找键。表8.8描述了集合字段字典中的条目。
TABLE 8.8 Entries in a collection field dictionary
KEY	TYPE	VALUE
Type	name	(可选) 该字典描述的PDF对象的类型;如果存在，则必须为集合字段字典的CollectionField。
Subtype	name	(必选) 本字典描述的集合字段或文件关联字段的子类型。此条目标识存储在字段中的数据类型。
以下值标识了集合项或集合子项字典中的字段类型:
S  一个文本字段。字段数据存储为PDF文本字符串。
D  一个日期字段。字段数据存储为PDF日期字符串。
N  一个数字字段。字段数据存储为PDF数字。
下面的值标识了文件相关字段的类型:
F  字段数据是嵌入文件流的文件名，如果存在，则由文件说明的UF条目标识;否则由文件说明的F条目(见表3.41)。
Desc 字段数据是嵌入文件流的描述，由文件说明字典中的Desc条目标识(参见表3.41)。
ModDate 字段数据是内嵌文件流的修改日期，由内嵌文件参数字典中的ModDate条目标识(见表3.43)。
CreationDate 字段数据是嵌入文件流的创建日期，由嵌入文件参数字典中的CreationDate条目标识(见表3.43)。
Size  字段数据是嵌入文件的大小，由内嵌文件参数字典中的Size条目(参见表3.43)。
N	text string	(必选) PDF查看器应用程序显示给用户的文本字段名称。
O	integer	(可选) 用户界面中字段名的相对顺序。字段由PDF查看器应用程序按升序排序。
V	boolean	(可选) 用户界面中字段的初始可见性。默认值:true。
E	boolean	(可选) 一个标志，指示PDF查看器应用程序是否应该为编辑字段值提供支持。默认值:false。
一个集合排序字典(collection sort dictionary)标识用于集合中的项进行排序的字段。排序的类型取决于数据的类型:
?如果指定了升序，文本字符串在词法上按从小到大排序。
?如果指定了升序，数字将按照从小到大的数字顺序排列。
?如果指定了升序，日期将从最老到最新排序。
表8.9描述了集合排序字典中的条目。
TABLE 8.9 Entries in a collection sort dictionary
KEY	TYPE	VALUE
Type	name	(可选) 该字典描述的PDF对象的类型;如果存在，则必须为集合排序字典的CollectionSort。
S	name or 
array	(必选) 字段的名称或名称数组，PDF查看器应用程序用于对集合中的项进行排序。
如果值是一个名称，它将标识父集合字典中描述的字段。
如果值是数组，则数组的每个元素都是一个名称，标识父集合字典中描述的字段。数组形式用于允许附加字段参与排序，其中每个附加字段都用于打破关联。更具体地说，如果多个集合项字典对于数组中命名的第一个字段具有相同的值，则数组中命名的后续字段的值将用于排序，直到确定唯一的顺序或直到指定字段耗尽。
A	boolean or 
array	(可选) 指定集合中的项是否按升序排序。如果使用数组形式，数组的每个元素都是一个布尔值，用于指定S数组中相同索引的条目是否按升序排序。
默认值：true
示例8.3显示了一个表示电子邮件收件箱的集合字典，其中集合中的每一项都是一封电子邮件消息。实际的电子邮件消息包含在文件说明字典中。与每个电子邮件相关联的组织数据在集合模式字典中进行描述。大多数实际的组织数据(from, to, date, and subject)都在集合项字典中提供，但大小数据来自嵌入的文件参数字典。
Example 8.3
/Collection <<
/Type /Collection 
/Schema <<
/Type /CollectionSchema 
/from << /Subtype /S /N (From) /O 1 /V true /E false>> 
/to << /Subtype /S /N (To) /O 2 /V true /E false >> 
/date << /Subtype /D /N (Date received) /O 3 /V true /E false >> 
/subject << /Subtype /S /N (Subject) /O 4 /V true /E false >> 
/size << /Subtype /Size /N (Size) /O 5 /V true /E false >> 
>>
/D (Doc1) 
/View /D 
/Sort << /S /date /A false >> 
>>
 示例8.4显示了一个集合项字典和一个集合子项字典。这些字典包含与示例8.3中指定的模式条目相对应的条目。第3.10.5节“Collection Items”指定了集合项和集合子项字典。
Example 8.4
/CI << 
/Type /CollectionItem 
/from (Rob McAfee) 
/to (Patty McAfee) 
/subject << 
/Type /CollectionSubitem 
/P (Re:) 
/D (Let's have lunch on Friday!) 
>> 
/date (D:20050621094703-07’00’) 
>>
8.3 Page-Level Navigation
本节介绍PDF工具，使用户能够在文档中从一个页面导航到另一个页面:
?页面标签(Page labels)用于编号或以其他方式标识单个页面(参见第8.3.1节)。
?文章线程(Article threads)，将文档中逻辑相连而不是物理顺序的内容项链接在一起(参见8.3.2节)。
?演示文稿(Presentations)，以幻灯片形式显示文档，自动或在用户控制下从一页前进到下一页(参见8.3.3节)。
关于页面级导航的另一种重要形式，请参阅第622页的“Link Annotations”。
8.3.1 Page Labels
PDF文档中的每一页都由一个整数页索引(page index)标识，该索引表示页在文档中的相对位置。另外，文档可以选择定义页面标签(page labels,PDF 1.3)，以在屏幕上或打印中直观地标识每个页面。页面标签和页面索引不必重合:索引是固定的，从0表示第一页开始在文档中连续运行，但是可以以适合特定文档的任何方式指定标签。例如，如果文档前12页用罗马数字编号，其余部分用阿拉伯数字编号，那么第一页的页索引为0，页标签为i，第十二页的索引为11，页标签为xii，第十三页的索引为12，页标签为1。
页面标签的目的，可以将文档分为多个标记范围(labeling ranges)，每个标记范围是一系列连续页面,使用相同编号系统。范围内的页按升序顺序编号。页面标签由基于其标记范围内位置的数字部分组成，可选地在其前面加上一个表示标记范围本身的标签前缀(label prefix)，。例如，附录中的页面可以标记为以字符串A?为前缀的十进制数字部分；产生的页面标签将是 A?1、A?2等等。
文档的标签范围是由文档目录中的PageLabels条目定义(参见3.6.1节“Document Catalog”)。这个条目的值是一个数字树(第3.8.6节“Number Trees”)，它的每个键是标签范围内第一页的页面索引。对应的值是一个页面标签字典(page label dictionary)，定义该范围内页面的标记特征。树必须包含页面索引0的值。表8.10显示了页面标签字典的内容。(见附录h中的实施注76)
TABLE 8.10 Entries in a page label dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，则必须为页标签字典的PageLabel。
S	name	(可选) 每个页面标签的数字部分使用的编号样式(style):
D    十进制阿拉伯数字
R    大写罗马数字
r     小写罗马数字
A    大写字母(前26页为A到Z，后26页为AA到ZZ，以此类推)
a    小写字母(前26页为a到z，后26页为aa到zz，以此类推)
没有默认的编号样式；如果没有S条目，页面标签仅由一个没有数字部分的标签前缀组成。例如，如果P条目(下面)指定了标签前缀Contents，那么每个页面都被简单地标记为Contents，没有页编号。(如果P条目也缺失或为空，则页面标签为空字符串。)
P	text string	(可选) 此范围内页标签的标签前缀(prefix)。
St	integer	(可选) 范围内第一个页标签的数字部分的值。后续页从这个值开始按顺序编号，这个值必须大于或等于1。默认值:1。

示例8.5显示了一个带有页面标签的文档。
i, ii, iii, iv, 1, 2, 3, A?8, A?9, …
Example 8.5
1 0 obj
<< /Type /Catalog
/PageLabels << /Nums [  0 << /S /r >>  % A number tree containing
4 << /S /D >> % three page label dictionaries
7 << /S /D
/P (A?)
/St 8
 									>>
]
 						>>
…
>>
endobj
8.3.2 Articles
某些类型的文档可能包含逻辑上连接但物理上不相连的内容项序列。例如，一个新闻故事可能从时事简报的第一页开始，并延伸到一个或多个不连续的内页。为了表示这种物理上不连续但逻辑上相关的条目序列，PDF文档可以定义一个或多个文章(articles，PDF 1.1)。文章的顺序流由文章线程(article thread)定义；组成文章的各个内容项称为线上的珠子(beads)。PDF查看器应用程序可以提供导航工具，允许用户沿着线程从一个珠子到下一个珠子。
文档目录中可选的Threads条目(参见3.6.1节“Document Catalog”)保存了一个定义文档文章的线程字典(thread dictionaries)数组(表8.11)。在线程中的每一个珠子都用珠子字典(bead dictionary)表示(表8.12)。线程字典的F条目指向线程中的第一个珠子;这些珠子在双链表中按顺序链接在一起，通过它们的N(下一个)和V(上一个)条目。此外，对于出现文章珠子的每个页面，页面对象(参见第144页“Page Objects”)应该包含一个B条目，其值是对页面上珠子的间接引用的数组，按照绘制顺序。
TABLE 8.11 Entries in a thread dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，则必须为线程字典的Thread。
F	dictionary	(必须;必须是间接引用) 线程中的第一个珠子(first bead)。
I	dictionary	(可选) 一个线程信息字典,包含线程的信息，例如它的标题、作者和创建日期。本字典的内容与文档信息字典类似(参见第10.2.1节 “Document Information Dictionary”)。

TABLE 8.12 Entries in a bead dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，则必须为珠子字典的Bead。
T	dictionary	(线程的第一个珠子必须;其他均可选;必须为间接引用) 这珠子所属的线程(thread)。
注意:在PDF 1.1中，这个条目只允许用于一个线程的第一个珠子。在PDF 1.2和更高的版本中，任何珠子都可以使用，但第一个珠子必须。
N	dictionary	(必须;必须是间接引用) 线程中的下一个珠子(next bead)。在最后一个珠子中，这个条目指向第一个珠子。
V	dictionary	(必须;必须是间接引用) 线程中先前的珠子(previous bead)。在第一个珠子里，这个条目指向最后一个。
P	dictionary	(必须;必须是间接引用) 页面对象(page object)，表示在其上显示此珠子的页面。
R	rectangle	(必选) 一个矩形，指定该珠子在页面上的位置。

示例8.6显示了一个带有三个珠子的线程。
Example 8.6
22 0 obj
<< /F 23 0 R
/I << /Title (Man Bites Dog) >>
>>
endobj
23 0 obj
<< /T 22 0 R
/N 24 0 R
/V 25 0 R
/P 8 0 R
/R [158 247 318 905]
>>
endobj
24 0 obj
<< /T 22 0 R
/N 25 0 R
/V 23 0 R
/P 8 0 R
/R [322 246 486 904]
>>
endobj
25 0 obj
<< /T 22 0 R
/N 23 0 R
/V 24 0 R
/P 10 0 R
/R [157 254 319 903]
>>
endobj

8.3.3 Presentations
一些PDF查看器应用程序可能允许文档以演示文稿(presentation)或幻灯片放映的形式显示，自动地或在用户控制下从一个页面移到下一个页面。此外，PDF 1.5引入了在同一页面的不同状态之间推进的能力(请参阅第601页的“Sub-page Navigation”)。
注:PDF 1.4引入了一种不同的机制，称为替代演示，用于幻灯片显示，在第9.4节“Alternate Presentations”中描述。
一个页面对象(参见第144页的“Page Objects”)可以包含两个可选条目，
Dur和Trans (PDF 1.1)，以指定如何在演示模式下显示该页面。Trans条目包含一个转换字典(transition dictionary)，描述演示期间从另一个页面移动到给定页面时，要使用的视觉转换的样式和持续时间。表8.13显示了转换字典的内容。(如表中所示，一些条目仅用于某些转换样式。)
页面对象中的Dur条目指定了页面的显示持续时间(display duration，也称为它的移动定时)；在显示自动前进到下一个页面之前，页面显示的最大时间长度，以秒为单位。(用户可以在指定时间过期前手动前进页面。) 如果在页面对象中没有指定Dur条目，则页面不会自动前进。
TABLE 8.12 Entries in a bead dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，则必须为转换字典的Trans。
S	name	(可选) 演示期间从另一个页面移动到该页面时使用的转换样式(transition style)。默认值:R。
Split  两条线清扫屏幕，展现新页面。这些线可以是水平的，也可以是垂直的；可以从页面边缘向内移动，也可以从页面中心向外移动，分别由Dm和M项指定。
Blinds  在屏幕上均匀间隔的多条线，以相同的方向同步清扫，展示新页面。这些线可以是水平的，也可以是垂直的，正如Dm条目所指定的。水平线向下移动;垂直线向右移动。
Box  一个矩形框从页面边缘向内清扫或从中心向外清扫，由M项指定，展示新页面。
Wipe  一条直线沿着Di条目指定的方向从屏幕的一条边扫到另一条边，展示新页面。
Dissolve  旧的页面逐渐消失，露出新的页面。
Glitter  闪现，类似于溶解(Dissolve)，除了扫过页面在一个宽频带从屏幕的一边移动到另一边的效果，由Di条目指定的方向。
R  新页面简单地替换(replaces)旧页面，没有特殊的转换效果;D条目被忽略。
Fly  (PDF 1.5) 改变会飞出或飞进(由M指定)，按照Di指定的方向，到或从屏幕外的位置(除非没有Di)。
Push  (PDF 1.5) 当新页面滑入屏幕时，旧页面滑出，将旧页面按Di指定的方向推出(pushing)。
Cover  (PDF 1.5)新页面按Di指定的方向滑到屏幕上，覆盖旧页面。
Uncover  (PDF 1.5) 旧页面按Di指定的方向滑出屏幕，按Di指定的方向露出新页面。
Fade  (PDF 1.5)淡入，新页面通过旧页面逐渐变得可见。
D	number	(可选) 切换效果持续时间(duration)，单位为秒。默认值:1。
Dm	name	(可选;仅限Split and Blinds切换样式) 指定切换效果发生的维度(dimension):
H    Horizontal
V    Vertical
默认值：H.
M	name	(可选;仅限Split,Box和Fly切换效果) 对于指定的切换效果的运动(motion)方向:
I    从页边缘向内(Inward)
O    从页中心向外(Outward)
默认值： I
Di	number or 
name	(可选;只适用于Wipe，Glitter，Fly，Cover，Uncover和Push切换样式)指定的转换效果移动的方向(direction)，从左到右逆时针方向。(这与页面对象的Rotate条目不同，后者是从顶部顺时针测量的。)
以下数值是有效的:
0    左到右
90    从下到上(仅限Wipe)
180    右到左(仅限Wipe)
270    上到下
315    左上角到右下角(仅限Glitter)
惟一有效的名称值是None，当SS的值不是1.0时，它只与Fly转换相关。
默认值：0
SS	number	(可选;PDF 1.5;仅限Fly转换样式) 更改绘制的起始或结束比例(scale)。如果M指定一个向内的变换，在变换的过程中，绘制变化的规模从SS发展到1.0。如果M指定一个向外的变换，那么在变换的过程中，绘制变化的规模从1.0发展到SS
默认值：1.0
B	boolean	(可选;PDF 1.5;仅Fly转换样式) 如果为true，要飞行的区域是矩形和不透明的。默认值:false。

图8.1说明了变换持续时间(在转换字典中为D)和显示持续时间(在页面对象中为Dur)之间的关系。注意，为一个页面(图中的页面2)指定的转换持续时间控制从另一个页面到该页面的转换; 页面的转换由下一页的转换持续时间控制。

FIGURE 8.1 Presentation timing
示例8.7显示了将显示5秒的页面的表示参数。在页面显示之前，有一个3.5秒的过渡，其间两条垂直线从页面中心向外清扫到页面边缘。
Example 8.7
10 0 obj
<< /Type /Page
/Parent 4 0 R
/Contents 16 0 R
/Dur 5
/Trans << /Type /Trans
/D 3.5
/S /Split
/Dm /V
/M /O
 			>>
>>
endobj

Sub-page Navigation
子页面导航(PDF 1.5)不仅可以在页面之间导航，还可以在同一页面的不同状态之间导航。例如，PDF演示文稿中的单个页面可能有一系列可以单独打开和关闭的项目编号要点。在这样的例子中，项目编号将由可选内容(参见4.10节“Optional Content”)表示，页面的每个状态将表示为一个导航节点(navigation node)。
注意: 查看器应用程序应在用户进入显示模式时保存可选内容组的状态，并在显示模式结束时恢复。例如，这可以确保对项目编号的短暂更改不会影响文档的打印。
当用户发出导航请求（例如，通过按箭头键），导航节点字典(见表8.14)指定要执行的动作；页面上的导航节点通过其Next和Prev条目形成双链接列表。页面上的主节点由页字典中的可选条目PresSteps确定(见表3.27)。
注意:建议查看器应用程序仅在演示模式下才考虑导航节点(请参阅第8.3.3节“Presentations”)。
TABLE 8.14 Entries in a navigation node dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型;如果存在，导航节点字典必须为NavNode。
NA	dictionary	(可选) 当用户向前导航时要执行的动作序列。next actions
PA	dictionary	(可选) 当用户向后导航时要执行的动作序列。previous actions
Next	dictionary	(可选) 下一个导航节点(如果有)
Prev	dictionary	(可选) 上一个导航节点(如果有)
Dur	number	(可选) 查看器应用程序自动前进到下一个导航节点之前的最大秒数。如果未指定此条目，则不应发生自动前进。

查看器应用程序应该支持当前导航节点的概念。当用户导航到一个页面时，如果页面字典有一个PresSteps条目，则该条目指定的节点将成为当前节点。(否则不存在当前节点。)	如果有一个向前导航的请求(例如按下箭头键)，并且有一个当前导航节点，则会发生以下情况:
1.执行NA(如果存在)指定的动作序列。
注意:如果NA指定了一个导航到另一个页面的动作，下面描述的导航到另一个页面的动作将会发生，并且Next不应该出现。
2.Next指定的节点(如果存在)将成为新的当前导航节点。
类似地，如果有一个向后导航的请求，并且有一个当前导航节点，则会发生以下情况:
1.执行PA(如果存在)指定的操作序列。
注意:如果PA指定一个动作导航到另一个页面,下面描述的导航到另一个页面的动作将会发生,Prev不应该存在。
2.由Prev指定的节点(如果存在)成为新的当前导航节点。
当在节点之间导航时，可以指定过渡效果。这些效果类似于上一节中指定的页面过渡。然而，它们使用了不同的机制；请参阅670页的“Transition Actions”。
注意:“前进”和“后退”是由用户操作决定的，比如按下左/右方向键，而不是由动作的目标页面决定的。
如果有一个导航到另一个页面的请求(不管当前节点是否存在)，并且该页面的字典包含一个PresSteps条目，会发生以下情况:
1.由PresSteps表示的导航节点成为当前节点。
2.如果导航请求是向前的，或者如果导航请求是随机访问的(例如单击链接)，那么NA指定的动作将被执行，Next指定的节点将成为新的当前节点，如上所述。
如果导航请求是向后的，PA指定的动作将被执行，Prev指定的节点将成为新的当前节点，如上所述。
3.查看器应用程序使新页成为当前页并显示它。执行由页字典的Trans条目指定的任何页变换。
8.4 Annotations
注释(annotation)将备注、声音或电影等对象与PDF文档页面上的某个位置关联起来，或者提供一种通过鼠标和键盘与用户交互的方法。PDF包含了各种各样的标准注释类型，详细描述在第8.4.5节“Annotation Types”。
许多标准注释类型可能以打开(open)或关闭(closed)状态显示。当关闭时，它们将以某种独特的形式出现在页面上，例如图标、框或橡皮图章，这取决于特定的注释类型。当用户通过单击激活注释时，它将显示与之相关的对象，例如打开一个弹出窗口显示文本注释的(图8.2)或播放声音或电影。

FIGURE 8.2 Open annotation
查看器应用程序允许用户使用键盘(特别是tab键)浏览页面上的注释;见附录H的实现说明77。从PDF 1.5开始，PDF生产者通过页面对象中的可选项条目Tabs，可以显式地产生导航顺序(见表3.27)。以下是该条目可能的值:
1.R(行顺序):注释以行形式在页面上水平运行。一行中的方向 由查看器首选项字典中的Direction条目决定(参见8.1节“Viewer Preferences”)。访问的第一个注释是最顶层行的第一个注释。当遇到一行的末尾时，将访问下一行中的第一个注释。
2. C(列顺序):注释在页面上下垂直运行的列中进行访问。列按照查看器首选项字典中的Direction条目进行排序(参见8.1节“Viewer Preferences”)。访问的第一个注释是位于第一列顶部的注释。当遇到列的末尾时，将访问下一列中的第一个注释。
3. S(结构顺序):注释按照它们在结构树中出现的顺序进行访问(见10.6节“Logical Structure”)。未包含在结构树中的注释的顺序取决于应用程序。
注意:上面的描述假设页面是按照Rotate条目指定的方向查看的。
每个注释类型的行为都是由一个称为注释处理程序的软件模块实现的。标准注释类型的处理程序直接内置到PDF查看器应用程序中;附加类型的处理程序可以作为插件扩展提供。
8.4.1 Annotation Dictionaries
页面对象(参见第144页的“page Objects”)中的可选Annots条目保存了一个注释字典(annotation dictionaries)数组，每个注释字典表示与给定页面相关联的一个注释。表8.15显示了所有注释字典都通用的必需和可选条目。字典可能包含附加条目指定一个特定注释类型;有关详细信息，请参阅8.4.5节Annotation Types,”中对单个注释类型的描述。
注意:给定的注释字典只能从一个页面的Annots数组中引用。尝试在多个页面之间共享注释字典会产生不可预测的行为。这一要求仅适用于注释字典本身，而不适用于附属对象，这些附属对象可以在多个注释之间共享而不会造成任何困难。
TABLE 8.15 Entries common to all annotation dictionaries
KEY	TYPE	VALUE
Type	name	(可选) 本字典描述的PDF对象类型;如果存在，则必须为注释字典的Annot。
Subtype	name	(必须) 本字典描述的注释类型;具体值见第615页表8.20。
Rect	rectangle	(必须) 注释的矩形，定义默认用户空间单元上页面注释的位置。
Contents	Text string 	(可选) 为注释显示的文本，或者如果当前类型的注释不显示文本，则以人类可读的形式对注释内容的另一种描述。在任何一种情况下，当提取文档内容以支持残疾用户的易访问性或为其他目的时，该文本都是有用的(见第10.8.2节，“Alternate Descriptions”)。请参阅8.4.5节“Annotation Types”，了解当前条目对于每种注释类型的含义的更多信息。
P	dictionary	(可选;PDF 1.3;不用于FDF文件) 对与此注释相关联的页面(Page)对象的间接引用。注意:此条目用于与渲染操作相关的屏幕注释时时必须的(PDF 1.5;参见第639页的“Screen Annotations”和第668页的“Rendition Actions”)。
NM	text string	(可选;PDF1.4) 注释名称(name)，一个在页面上所有注释中唯一标识它的文本字符串。
M	date or text string	(可选;PDF1.1) 注释最近修改(Modify)的日期和时间。首选的格式是第3.8.3节“日期”中描述的日期字符串，但是查看器应用程序应该准备接受和显示任何格式的字符串。(见附录h的实施说明78)
F	 integer	(可选;PDF1.1) 一组标记(Flags)，指定注释的各种特征(见8.4.2节“Annotation Flags”).。默认值:0。
AP	dictionary	(可选;PDF1.2) 一个外观字典，指定注释如何在页面上显示(见8.4.4节，“外观流”和附录H中的实现注79)。单个注释处理程序可能会忽略这个条目，并提供自己的外观。
AS	name	(如果外观字典AP包含一个或多个子字典则需要;PDF1.2) 注释的外观状态(appearance state)，它从外观子字典中选择合适的外观流(参见8.4.4节“Appearance Streams”以及附录H中的实现说明79)。
Border	array	 (可选) 指定注释边框特征的数组。边框指定为圆角矩形。
在PDF 1.0中，该数组由三个定义水平角半径、垂直角半径和边框宽度的数字组成，所有这些数字都使用默认的用户空间单元。如果角半径为0，则边框有方形(不圆角)角;如果边框宽度为0，则不绘制边框。(见附录h的实施说明81)
在PDF 1.1中，数组可以有第四个元素，一个可选的dash 数组(破折号)，它定义了在绘制边框时使用的破折号和空白的模式。dash数组的指定格式与图形状态的line dash pattern参数相同(参见第217页的line dash pattern)。例如，边界值[0 0 1 [3 2]]指定了一个1单位宽、带有方形角的边界，用3个单位的破折号与2个单位的间隔交替绘制。注意，没有指定破折号阶段;相位假定为0。(见附录h的实施说明82)
注意:在PDF 1.2或更高版本中，本条目可能会被忽略，以支持BS条目(见上文);见附录H的实施说明82。
C	array	(可选;PDF1.1) 一个范围为0.0到1.0的数字数组，表示用于以下目的的颜色(color):
1.关闭时注释图标的背景色
2.注释弹出窗口标题栏的颜色
3.链接注释的边框颜色
数组元素的数量决定了颜色空间:
0 No color; transparent
1 DeviceGray
3 DeviceRGB
4 DeviceCMYK
StructParent	integer	(如果注释是结构化内容项则需要;PDF1.3) 结构父树中注释条目的整数键(参见第868页的“Finding Structure Elements from Content Items”)。
OC	dictionary	 (可选;PDF1.5) 可选内容组或可选内容成员字典(见4.10节“Optional Content”)，指定注释的可选内容属性。在绘制注释之前，它的可见性是基于这个条目以及指定注释标志的F条目来确定的(参见8.4.2节“Annotation Flags”)。如果确定它是不可见的，则跳过注释，就好像它不存在于文档中一样。
8.4.2 Annotation Flags
注释字典的F条目的值是一个无符号的32位整数，它包含指定注释各种特征的标志。标志字内的位从1(低阶)到32(高阶)进行编号。表8.16显示了标志的含义;所有未定义的标志位都被保留并且必须设置为0。
TABLE 8.16 Annotation flags
BIT POSITION	NAME	MEANING
1	Invisible	如果设置，如果注释不属于标准注释类型且没有注释处理程序，则不显示该注释。如果清除，则使用外观字典指定的外观流(如果有的话)显示未知的注释(参见8.4.4节“Appearance Streams”)。
2	Hidden	(PDF 1.2)如果设置了，则不显示或打印注释或允许它与用户交互，而不管它的注释类型或注释处理程序是否可用。在屏幕空间有限的情况下，可以结合外观流(见8.4.4节“Appearance Streams”)有选择地隐藏和显示注释，和在线帮助系统的功能一样显示辅助弹出信息。(见附录h的实施说明83)
3	Print	(PDF1.2)如果该标志位被设置,打印页面时打印该注释。如果该标志位被清空,则不管屏幕上是否显示,都不打印该注释。
注2:这一点对于用于交互的按钮的注释是有用的,而它在打印的页面上没有意义
4	NoZoom	(PDF1.3)如果该标志位被设置,不缩放该注释的外观以使其与页面的缩放一致。注释在页面上的位置(由注释矩形的左上角定义)应保持不变,与页面缩放无关。
5	NoRotate	(PDF1.3)如果该标志位被设置,不旋转该注释的外观来匹配页面的旋转。注释矩形的左上角应保持在页面的固定位置,而与页面是否旋转无关。
6	NoView	(PDF1.3)如果该标志位被设置,不在屏幕上显示该注释,不允许它与用户交互。该注释可以被打印(取决于Print标志的设置),但对用于在屏幕显示和与用户交互,则宜考虑隐藏。
7	ReadOnly	(PDF1.3)如果该标志位被设置,不允许该注释与用户交互。该注释可以被显示或打印(取决于NoView和Print标志的设置),但不宜响应鼠标单击或者在鼠标运动时改变其外观。 
注意：对于小部件注释,应忽略此标志;其功能可以归入相关表单域的 ReadOnly标志 (见表221)。
8	Locked	(PDF1.4)如果该标志位被设置,则不允许用户删除该注释或者修改其属性(包括位置和大小)。但是,此标志不限制对注释内容(比如某表单域的值)的更改。
9	ToggleNoView	(PDF1.5)如果该标志位被设置,则对于某些事件,逆向解释NoView标志。一种典型用途是使注释仅在悬停鼠标时出现。
10	LockedContents	(PDF1.7)如果该标志位被设置,不允许用户修改注释的内容。此标志不限制注释的删除或者对注释属性(比如位置和大小)的修改。

如果设置了NoZoom标志，则注释在屏幕上始终保持相同的固定大小，并且不受页面本身显示的放大级别的影响。类似地，如果设置了NoRotate标志，则在页面旋转时(通过更改page对象中的Rotate条目;参见第144页的“Page Objects”)，注释在屏幕上保持原来的方向。
无论哪一种情况,注释的位置都应由注释矩形左上角的坐标确定,矩形由注释字典中的Rect条目所定义,且以该页面的默认用户空间解释。当默认用户空间被缩放或旋转时,注释矩形的其他三个角的位置在更改后的用户空间中与其在原来的用户空间中是不同的。符合本标准的阅读器应自动更新。但是,这并不真正更改注释的Rect条目,Rect条目仍然描述的是注释与未缩放的、未旋转的用户空间之间的关系。
注:图8.3展示了当注释所在的页面顺时针旋转90度时,设置了 NoRotate标志的注释如何保持向上。该注释的左上角仍位于默认用户空间的同一点;注释以该点为轴转动。

FIGURE 8.3 Coordinate adjustment with the NoRotate flag
8.4.3 Border Styles
在显示或打印时，注释可以有选择地由边框包围。如果存在，则边框将完全绘制在注释矩形内。在PDF 1.1中，边界的特征由注释字典中的Border条目指定(见第606页的表8.15)。从PDF 1.2开始，一些类型的注释可能会在一个边界样式(border style)字典中指定它们的边界特征，由注释的BS条目指定的。这样的字典还用于指定由line、square、circle和 ink注释绘制的线的宽度和虚线模式。表8.17总结了边框样式字典的内容。如果Border和BS条目都不存在，则边框被绘制为宽为1点的实线。
TABLE 8.17 Entries in a border style dictionary
KEY	TYPE	VALUE
Type	name	(可选) 本字典描述的PDF对象类型;如果存在，则必须为边框样式字典的Border。
W	number	(可选) 以点为单位的边界宽度。如果该值为0,没有边界。默认值:1。
S	name	(可选) 边框样式(style):
S    (Solid) 包围注释的实心矩形
D    (Dashed) 包围注释的虚线矩形。破折号模式由D条目指定(见下文)。
I    (Inset) 模拟雕刻矩形似乎嵌入页面的表面下。
U    (Underline) 沿着注释矩形底部的一行。
其他边框样式可能会在将来定义。默认值:S。
D	array	(可选) 一个虚线数组(dash array)，定义了用于绘制虚线边框(边框样式为上面的D)的虚线和间隙的模式。虚线数组的指定格式与图形状态的线虚线样式参数相同(参见第217页的“Line Dash Pattern”)。虚线相位没有指定，并假定为0。例如，D条目[3 2]指定用3点破折号和2点间隙交替绘制的边界。默认值:[3]。

从PDF 1.5开始，一些注释(正方形、圆形和多边形)可以有一个BE条目，这是一个边框效果(border effect)字典，指定要应用于注释边框的效果。从PDF 1.6开始，自由文本注释也可以有BE条目。表8.18描述了边框效果字典中的条目。
TABLE 8.18 Entries in a border effect dictionary
KEY	TYPE	VALUE
S	name	(可选) 表示要应用的边框效果的名称。可能的值是:
S    没有效果:边框是由注释字典的BS条目描述。
C    边框应该显示为“cloudy”。BS指定的宽度和虚线数组被尊重。
默认值:S。
I	number	(可选;仅当S的值为C时有效) 一个数字，描述效果的强度。建议取值范围为0 ~ 2。默认值:0。

8.4.4 Appearance Streams
从PDF 1.2开始，注释可以指定一个或多个外观流，作为早期版本中提供的简单边框和颜色特征的替代。外观流允许注释以不同的方式显示，以反映其与用户的交互。每个外观流是XObject 的形式(见4.9节“form XObjects”):在注释矩形内呈现的自包含内容流。
下面的方法用于从外观XObject的坐标系映射(由其Matrix条目定义;见表4.45)到注释的默认用户空间的矩形:
算法8.1
1.外观的边界框(由其BBox条目指定)使用Matrix进行转换，以生成任意方向的四边形。转换后的外观框是包含这个四边形的最小的直立矩形。
2.计算一个矩阵A，它缩放并平移已转换的外观框，使其与注释的矩形(由Rect条目指定)的边缘对齐。将转换后的外观框的左下角(x和y坐标最小的角落)和右上角(x和y坐标最大的角落)映射到注释矩形的相应角落。
3.Matrix与A连接，形成矩阵AA，从外观坐标系映射到默认用户空间中的注释矩形:
AA = A × Matrix
如果设置了 NoZoom 或 NoRotate标志之一,还可以进一步缩放和旋转该注释(见8.4.2, “Annotation Flags”)。应用于注释的任何转换作为整体都应用于其内的外观。
从 PDF1.4开始，注释外观包括了透明度。如果外观的流字典中没有包含Group条目，应将其视为非孤立的、非击倒的透明度组。否则，应使用组字典(见7.5.5, “Transparency Group XObjects”)中指定的孤立值(isolated)和击倒值(knockout)。
透明度组应与背景(包含页面内容和之前绘制的注释)合成起来,使用的混合模式为Normal，alpha常数为1.0，软掩码为None。(See implementation note 87 in Appendix H.)
 注:如果在没有使用外观流绘制的注释上面绘制透明注释外观,则效果与实现相关。这是因为有时使用与PDF图像模型不一致的方法绘制这样的注释。此外,高亮显示透明注释外观的效果也与实现相关。
一个注释最多可以定义三种不同的外观:
1.当注释不与用户交互时，使用正常(normal)的外观。此外观还用于打印注释。
2.当用户在不按鼠标按钮的情况下将光标移动到注释的活动区域时，将使用滚动(rollover)外观。
3.当在注释的活动区域内按下或按住鼠标按钮时，将使用向下(down)外观。
注意:此处使用的术语鼠标指的是一种通用的指向设备，它控制屏幕上光标的位置，至少有一个可按、按住和释放的按钮。请参阅8.5.2节“Trigger Events”以获得进一步的讨论。
normal, rollover, 和down外观是在外观字典中定义的，它又是注释字典中AP条目的值(见606页的表8.15)。外观字典的内容如表8.19所示：
TABLE 8.19 Entries in an appearance dictionary
KEY	TYPE	VALUE
N	stream or dictionary	(必需) 注释的normal外观。
R	stream or dictionary	(可选) 注释的rollover外观。缺省值:N项的值。
D	stream or dictionary	(可选) 注释的down外观。缺省值:N项的值。

外观字典中的每个条目可以包含单个外观流或外观子字典(appearance subdictionary)。在后一种情况下，子字典定义了对应于注释的不同外观状态的多个外观流。在后一种情况下，子字典定义了对应于注释的不同外观状态的多个外观流。
例如，表示交互式复选框的注释可能有两种外观状态，分别为On和Off。它的外观字典可能被定义为：
/AP << /N <<  /On formXObject1 
/Off formXObject2
>>
/D <<  /On formXObject3 
/Off formXObject4
>>
 >>
其中formXObject1 和formXObject2分别定义复选框在选中和未选中状态时的正常外 观,而formXObject3 和 formXObject4提供可视反馈，比如当用户单击它时，突出显示其轮廓(没有定义R条目，因为当用户在复选框上移动鼠标而未按下按钮时,不需要特殊的外观)。选中和未选中的外观状态之间的选择由注释字典的AS条目确定(Table 8.15 on page 606)。
注意:如果符合本部分的阅读器本身不支持某一具体的注释类型，则符合本部分的阅读器应用其正常(N)外观显示该注释。如果注释的 AS条目指定的外观状态是外观字典中没有定义的外观，符合本部分的阅读器也应试图提供合理的行为(比如什么都不显示)。
为方便管理重复使用的外观流，PDF文档的名称字典的AP条目(见3.6.3, “Name Dictionary”)可包含一个名称树，它把名称字符串映射到外观流。名称字符串没有标准化的含义；PDF对象不能通过名称引用外观流。
8.4.5 Annotation Types
PDF支持表8.20列出的标准注释类型。后面的章节详细描述这些类型。插件扩展可以添加新的注释类型，将来还可以添加更多的标准类型。(见附录h的实现说明88)
表8.20第一列中的值表示注释字典Subtype条目的值。第三列表示该注释是否为标记注释(markup annotation)，如下面的“Markup Annotations”所述。本节还提供了关于不同注释类型的Contents条目值的更多信息。
TABLE 8.20 Annotation types
ANNOTATION TYPE	DESCRIPTION	MARKUP?	DISCUSSED IN SECTION
Text	Text annotation	Yes 	“Text Annotations” on page 621
Link 	Link annotation	No 	“Link Annotations” on page 622
FreeText 	(PDF 1.3) Free text annotation	Yes 	“Free Text Annotations” on page 623
Line	(PDF 1.3) Line annotation	Yes 	“Line Annotations” on page 626
Square	(PDF 1.3) Square annotation	Yes	“Square and Circle Annotations” on page 630
Circle	(PDF 1.3) Circle annotation	Yes	“Square and Circle Annotations” on page 630
Polygon	(PDF 1.5) Polygon annotation	Yes	“Polygon and Polyline Annotations” on page 632
PolyLine	(PDF 1.5) Polyline annotation	Yes	“Polygon and Polyline Annotations” on page 632
Highlight 	(PDF 1.3) Highlight annotation	Yes 	“Text Markup Annotations” on page 633
Underline 	(PDF 1.3) Underline annotation	Yes 	“Text Markup Annotations” on page 633
Squiggly 	(PDF 1.4) Squiggly-underline annotation	Yes 	“Text Markup Annotations” on page 633
StrikeOut 	(PDF 1.3) Strikeout annotation	Yes	“Text Markup Annotations” on page 633
Stamp 	(PDF 1.3) Rubber stamp annotation	Yes 	“Rubber Stamp Annotations” on page 635
Caret 	(PDF 1.5) Caret annotation	Yes	“Caret Annotations” on page 634
Ink 	(PDF 1.3) Ink annotation	Yes	“Ink Annotations” on page 636
Popup 	(PDF 1.3) Pop-up annotation	No	“Pop-up Annotations” on page 637
FileAttachment	(PDF 1.3) File attachment annotation	Yes	“File Attachment Annotations”
Sound 	(PDF 1.2) Sound annotation	Yes	“Sound Annotations” on page 638
Movie	(PDF 1.2) Movie annotation	No	“Movie Annotations” on page 639
Widget	(PDF 1.2) Widget annotation	No	“Widget Annotations” on page 640
Screen	(PDF 1.5) Screen annotation	No	“Screen Annotations” on page 639
PrinterMark	(PDF 1.4) Printer’s mark annotation	No	“Printer’s Mark Annotations” on page 643
TrapNet	(PDF 1.3) Trap network annotation	No	“Trap Network Annotations” on page 643
Watermark	(PDF 1.6) Watermark annotation	No	“Watermark Annotations” on page 644
3D	(PDF 1.6) 3D annotation	No	“3D Annotations” on page 791
 
Markup Annotations
正如8.4.1节“Annotation Dictionaries”中提到的，注释的Contents条目的含义因注释类型而异。通常，它是为注释显示的文本，或者，如果注释不显示文本，则是以人类可读的形式对注释内容的另一种描述。在任何一种情况下，当提取文档内容以支持残疾用户的无障碍或为其他目的时，Contents条目都是有用的(见第10.8.2节“Alternate Descriptions”)。
许多注释类型被定义为标记注释(markup annotations)，因为它们主要用于标记PDF文档(见表8.20)。这些注释具有文本作为注释的一部分出现，并且可以通过查看器应用程序以其他方式显示，例如在Comments面板中。
标记注释可以分为以下几组:
?自由文本注释直接在页面上显示文本。注释的Contents条目指定要显示的文本。
?大多数其他标记注释都有一个可能包含文本的关联弹窗。注释的Contents条目指定打开弹出窗口时要显示的文本。其中包括文本、直线、正方形、圆形、多边形、折线、高亮、下划线、下波浪线(squiggly-underline)、删除线(strikeout)、橡皮图章(rubber 
stamp)、插入符号(caret)、墨水(ink)和文件附件注释。
?声音注释没有弹出窗口，但也可能有由Contents条目指定相关的文本。
注意:当将文本分隔成段落时，应该使用回车符(而不是换行符)。
注意:标记注释的一个子集被称为文本标记注释(“Text Markup Annotations”)。

其余的注释类型不被认为是标记注释:
?弹出注释类型通常不会单独出现；它与一个标记注释相关联，标记注释使用它来显示文本。
注意:弹出注释的Contents条目只有在没有父条目的情况下才相关；在这种情况下，它表示注释的文本。
?对于所有其他注释类型(Link、Movie、Widget、PrinterMark和TrapNet)， Contents条目以人类可读的形式提供了注释内容的替代表示，这在提取文档内容以支持残疾人或其他目的的访问时非常有用(见第10.8.2节，“Alternate Descriptions”)。
表8.21列出了适用于所有标记注释的条目。
TABLE 8.21 Additional entries specific to markup annotations
KEY	TYPE	VALUE
T	text string	(可选;PDF1.1) 当打开并激活时，在注释弹出窗口的标题(title)栏显示的文本。按照约定，该条目标识添加注释的用户。
Popup	dictionary	(可选;PDF1.3) 对弹出注释的间接引用，用于输入或编辑与该注释相关的文本。
CA	number	(可选;PDF1.4) constant alpha,绘制注释时使用的常量不透明度值(见7.1节“Overview of Transparency”和7.2.6节“Shape and Opacity Computations”)。该值适用于注释处于关闭状态时所有可见元素(包括其背景和边框)，但不适用于注释打开时出现的弹出窗口。
如果注释有一个外观流(见8.4.4节“Appearance Streams”)，则指定的值不被使用；在这种情况下，外观流必须指定任何透明度。(但是，如果查看器重新生成注释的外观流，它可能会将CA值合并到流的内容中。)
隐式的混合模式(参见7.2.4节“Blend Mode”)是Normal。默认值:1.0。
注意:如果没有为注释定义显式的外观流，则通过依赖于实现的方式绘制，不一定符合Adobe成像模型; 在这种情况下，这个条目的效果也取决于实现。
RC	text string or text stream	(可选;PDF1.5) Rich Context,当注释打开时，一个富文本字符串(见8.6“Rich Text Strings”)将显示在弹出窗口中。
CreationDate	date 	(可选;PDF1.5) 创建注释的日期和时间(第3.8.3节，“Dates”)。
IRT	dictionary	(如果存在RT条目则必需，否则可选;PDF 1.5) 一个对该注释“回复(in reply to)”注释的引用。两个注释必须在文档的同一页上。两个注释之间的关系由RT条目指定。
如果该条目出现在一个FDF文件中(参见8.6.6“Forms Data Format”)，其类型不是字典，而是一个文本字符串，包含要回复注释的NM条目的内容，用于允许要回复的注释不在同一个PDF文件中的情况。
Subj	text string	(可选;PDF1.5) 一个文本表示注释处理目标的简短描述。
RT	name	(可选;只有IRT存在时才有意义；PDF1.6) 一个名称，指定此注释与IRT指定的注释之间的关系(“回复类型reply type”)。有效值:
R 该注释被认为是对IRT指定的注释的回复。查看器应用程序不应该单独显示注释的回复，而是以线程注释的形式一起显示。
Group 注释与IRT指定的注释分组；请参阅下面的讨论。
默认值为：R。
IT	name	(可选;PDF1.6) 一个名称，描述标记注释意图(intent)。意图允许查看器应用程序区分单一标记注释类型的不同用途和行为。如果该条目不存在，或者其值与注释类型相同，则该注释没有显式意图，应该在查看器应用程序中以通用的方式表现。
ExData	dictionary	(可选;PDF1.7) 一个外部数据字典(external data dictionary)，指定要与注释关联的数据。本字典包含以下条目:
Type (可选): 如果有必须是ExData.
Subtype (必须): 一个名称，指定记注释关联的数据类型。在PDF 1.7中，唯一定义的值是Markup3D。
对于Subtype的每个值，都定义了其他条目。第835页的表9.48列出了子类型Markup3D对应的值。(另见附录h的实施说明96)

在PDF 1.6中，可以对一组注释进行分组，这样当用户与它们交互时，它们就可以作为一个单元发挥作用。组包括一个主注释(它必须没有IRT条目)和一个或多个从属注释(它必须有一个引用主注释的IRT条目)，以及一个值为Group的RT条目。
主注释中的一些条目被视为应该作为整体应用于组的"组属性(group attributes)"；从属注释中相应的条目应该被忽略。这些条目是Contents(或RC和DS)、M、C、T、Popup、CreationDate、Subj和Open。查看器应用程序应该将操作组中的任何注释的操作，如移动、剪切和复制，视为操作整个组。
注意:主注释可能有非从属注释的回复；也就是说，没有Group的RT值。
Annotation States
从PDF 1.5开始，注释可能具有与之关联的特定于作者的状态。该状态没有在注释中指定，而是在一个单独的文本注释中指定，该文本注释通过其IRT(“in reply to”)条目引用原始注释(见表8.24)。状态被分组到许多状态模型(state models)中，如表8.22所示。
TABLE 8.22 Annotation states
STATE MODEL	STATE	DESCRIPTION
Marked	Marked	该注释已被用户标记。
	Unmarked	该注释没有被用户标记(默认值)。
Review	Accepted	用户同意更改。
	Rejected	用户拒绝更改。
	Cancelled	更改已取消。
	Completed	更改已完成。
	None	用户没有表示任何更改(默认值)。
对于每个状态模型，注释最初可以被认为处于默认状态。用户所做的状态更改会在文本注释中通过以下条目表示:
T条目(参见表8.21)指定用户。
IRT条目(见表8.24)引用原始注释。
State和StateModel(见表8.23)更新指定用户的原始注释的状态。
附加的状态更改是通过添加文本注释回复(in reply to) 给定用户的上一个回复来实现。
Text Annotations
文本注释表示附加到PDF文档中某个点的“便利贴”。当关闭时，注释显示为一个图标;当打开时，它会显示一个弹出窗口，其中包含由查看器应用程序选择的字体和大小的注释文本。文本注释不随页面缩放和旋转;它们的行为就像NoZoom和NoRotate注释标志总是设置好一样(参见表8.16)。表8.23显示了特定于这种注释类型的注释字典条目。
TABLE 8.23 Additional entries specific to a text annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于文本注释，必须是Text。
Open	boolean	(可选) 一个标志指定注释最初是否应该打开显示。默认值:false(关闭)。
Name	name	(可选) 用于显示注释的图标名称。查看器应用程序应该至少提供以下标准名称的预定义图标外观:
Comment Key Note Help NewParagraph Paragraph Insert
也可能支持其他名称。默认值:Note 。
注意:注释字典的AP条目(如果存在)，优先于Name条目;参见第606页的表8.15和章节8.4.4“Appearance Streams”。
State	text string	(可选;PDF1.5) 原始注释应该设置的状态; 看到上面的“Annotation States”。
如果StateModel是" Marked "，默认为" Unmarked "; 如果StateModel为“Review”，则为“None”。
StateModel	text string	(如果State字段存在则为必选，否则为可选;PDF1.5)与state对应的state模型;参见上面的“注释状态”。

示例8.8展示了文本注释的定义。
Example 8.8
22 0 obj
<< /Type /Annot
/Subtype /Text
/Rect [266 116 430 204]
/Contents ( The quick brown fox ate the lazy mouse.)
>>
endobj
Link Annotations
一个链接注释(link annotation)表示到文档其他地方处目标的超文本链接(参见8.2.1节“Destinations”)或要执行的动作(8.5节“Actions”)。表8.24显示了特定于这种注释类型的注释字典条目。
TABLE 8.24 Additional entries specific to a link annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于链接注释，必须是Link。
A	dictionary	(可选;PDF1.1) 当链接注释被激活时执行的动作(action，参见第8.5节“Actions”)。
Dest	array, name or 
byte string	(可选;当A条目出现时不允许) 当注释激活时，将显示的目标(参见章节8.2.1“Destinations”;另见附录H中的实施说明89)。
H	name	(可选;PDF1.2) 注释的高亮模式(highlighting mode)，即在其活动区域内按下或保持按下鼠标按钮时，使用的视觉效果:
N    (None) 没有高亮。
I     (Invert) 将注释矩形的内容反色。
O    (Outline) 将注释边框反色。
I     (Push) 显示注释使其好像凹进页面的下方；查看附录H的实现说明90.
默认值:I
注意:在PDF 1.1中，高亮显示总是通过在注释矩形内反转颜色来完成的。
PA	dictionary	(可选;PDF1.3) 一个URI动作(参见第662页的“URI Actions”)，以前与该注释关联的。当Web捕获(章节10.9，“Web Capture”)将注释从URI更改为跳至动作(第654页上的“go-to Actions”)时，它使用这个条目来保存来自原始URI动作的数据，以便在随后删除跳至动作的目标页面时可以将其更改回来。
QuadPoints	array	(可选;PDF1.6) 一个由8 × n个数字组成的数组，指定默认用户空间中的n个四边形的坐标，这些四边形组成了链接应该被激活的区域。每个四边形的坐标按顺序给出
  x1 y1 x2 y2 x3 y3 x4 y4
按逆时针顺序指定四边形的四个顶点。为了定位的目的，例如在应用下划线边框样式时，四边形的底部是由(x1, y1)和(x2, y2)组成的线。
如果该条目不存在或查看器应用程序不认识它，则应该使用Rect条目指定的区域。如果数组中的任何坐标位于由Rect指定的区域之外，那么QuadPoints应该被忽略。

示例8.9显示了一个跳转到文档中其他目标的链接注释。
Example 8.9
93 0 obj
<< /Type /Annot
/Subtype /Link
/Rect [71 717 190 734]
/Border [16 16 1]
/Dest [3 0 R /FitR C4 399 199 533]
>>
endobj
Free Text Annotations
一个自由文本注释(free text annotation)直接在页面上显示文本。不像普通的文本注释(见621页的“Text Annotations”)，自由的文本注释没有打开或关闭状态; 文本总是可见的，而不是在弹出窗口中显示。表8.25显示了特定于这种注释类型的注释字典条目。第677页的“Variable Text”描述了使用这些条目在这些注释中生成文本外观的过程。
TABLE 8.25 Additional entries specific to a free text annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于自由文本注释，必须是FreeText。
DA	string	(必选,default appearance) 用于格式化文本的默认外观字符串(参见“Variable Text”在677页)。
注意:注释字典的AP条目(如果存在)优先于DA条目;参见第606页的表8.15和第8.4.4节“Appearance Streams”。
Q	integer	(可选;PDF1.4) 一个代码，指定用于显示注释文本的空铅排版(quadding, justification)形式:
    0   左对齐 
    1   居中
2   右对齐
默认值：0(左对齐)
RC	text string or 
text stream	(可选;PDF1.5) 一个富文本字符串(rich content)，用于生成注释外观(参见第680页的“Rich Text Strings”)。
DS	text string	(可选;PDF1.5) 一个默认样式(default style)字符串，如680页的“Rich Text Strings”中所述。
CL	array	(可选;PDF1.6) 四个或六个数字的数组，指定附加在自由文本注释上的调出(callout)线。6个数字[x1 y1 x2 y2 x3 y3]表示默认用户空间中直线的起始、膝点(knee point)和终点坐标，如图8.4所示。四个数[x1 y1 x2 y2]表示直线的起点和终点坐标。
IT	name	(可选;PDF1.6，intent) 一个名称，描述自由文本注释意图(参见表8.21)。有效的值是FreeTextCallout，这意味着注释的功能是调出(callout)，以及freetextttypewriter，这意味着注释的功能是单击进行输入或打字机对象。
BE	dictionary	(可选;PDF1.6) 一个边框效果字典(border effect见表8.18)与BS条目指定的边框样式字典一起使用。
RD	rectangle	(可选;PDF1.6) 描述两个矩形之间数值差异的一组4个数字:注释的Rect条目和包含在该矩形内的矩形。内部的矩形是应该显示注释文本的地方。由BS和BE条目指定的任何边框样式和/或边框效果，
分别将应用于内矩形的边框。
这四个数字分别对应Rect的左、上、右、下坐标和内矩形的默认用户空间的差值。每个值必须大于等于0。顶部和底部差值之和必须小于Rect的高度，左侧和右侧差值之和必须小于Rect的宽度。
BS	dictionary	(可选;PDF1.6) 一个边框样式字典(border style参见第611页的表8.17)，指定在绘制注释的边框时使用的线宽和虚线模式。
注意:注释字典的AP条目，如果存在，优先于InkList和BS条目;参见606页表8.15和章节8.4.4“Appearance Streams”
LE	array	(可选;PDF1.6) 由两个名称组成的数组，指定绘制注释边框时使用的线结束样式。数组的第一个和第二个元素指定L数组中第一对和第二对坐标(x1, y1)和(x2, y2)分别定义的端点的线结束样式。表8.27给出了可能的值。缺省值:[/None /None]。


FIGURE 8.4 Free text annotation with callout(调出线)

callout： 调出；插图编号；引线式注记；回调函数
Line Annotations
一个线注释(line annotation,PDF 1.3)在页面上显示一条直线。当打开时，它会显示一个弹出窗口，其中包含相关注释的文本。表8.26显示了特定于这种注释类型的注释字典条目。
TABLE 8.26 Additional entries specific to a line annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本子典描述的注释类型;对于行注释，必须为Line。
L	array	(Required) 一个由四个数字组成的数组，[x1 y1 x2 y2]，指定直线在默认用户空间中的起始和结束坐标。
注:如果LL条目存在，这个值代表的是前导线的端点，而不是线本身的端点;参见图8.5。
BS	dictionary	(可选) 边框样式(border style)字典(见611页的表8.17)，指定绘制直线时使用的线宽和虚线模式。
注意:注释字典的AP条目，如果存在，优先于L和BS条目;参见第606页的表8.15和第8.4.4节“Appearance Streams”。
LE	array	(可选;PDF1.4) 由两个名称组成的数组，指定绘制直线时使用的线端点(line ending)样式。数组的第一个和第二个元素指定L数组中第一对和第二对坐标(x1, y1)和(x2, y2)分别定义的端点的线端点样式。表8.27给出了可能的值。缺省值:[/None /None]。
IC	array	(可选;PDF1.4,interior color) 一个范围在0.0到1.0之间的数字数组，指定填充注释行结束时使用的内部颜色(参见表8.27)。数组元素的个数决定了定义颜色的颜色空间:
0   No color; transparent 
1   DeviceGray
3   DeviceRGB
4   DeviceCMYK
LL	number	(如果存在LLE则为必需，否则为可选;PDF1.6) 默认用户空间中前导线(leader lines)长度，从直线的每个端点垂直于直线本身延伸，如图8.5所示。正值表示前导线从起点到终点(用L表示)呈顺时针方向;负值表示相反的方向。
缺省值:0(无前导线)。
LLE	number	(可选;PDF1.6) 一个非负数表示前导线延伸(leader line extensions)的长度，从与导线成180度的直线延伸，如图8.5所示。
缺省值:0(无leader line extension)。
Cap	boolean	(可选;PDF1.6) 如果为true，由content或RC条目指定的文本应该被复制作为线出现的标题，如图8.6和图8.7所示。文本应以适合内容的方式呈现，并考虑到诸如书写方向等因素。
IT	name	(可选;PDF1.6) 一个名称描述直线注释意图(intent参见表8.21)。有效值是LineArrow，这意味着注释的功能意图是箭头，而LineDimension，这意味着注释的功能意图是维度线。
LLO	number	(可选;PDF1.7) 一个非负的数字，表示前导线偏移(leader line offset)量的长度，它是注释的端点和前导线开始之间的空白量。
CP	name	(可选;只有当Cap为true时才有意义;PDF1.7,caption position) 描述注释的标题位置的名称。有效值是
Inline 表示标题将在线中居中
Top  表示标题将在线顶部
默认值：Inline
Measure	dictionary	(可选;PDF1.7) 一个度量字典(见表8.110)，它指定了应用于行注释的刻度和单位。
CO	array	(可选;只有当Cap为true时才有意义;PDF1.7,caption offset) 由两个数字组成的数组，指定标题文本与正常位置的偏移量。第一个值是从注释线中点开始沿注释线的水平偏移量，一个正值表示向右偏移量，一个负值表示向左偏移量。第二个值是垂直于注释线的垂直偏移量，一个正值表示向上偏移，一个负值表示向下偏移。
默认值:[0, 0] 与正常位置没有偏移


FIGURE 8.5 Leader lines

图8.6演示了在行注释中包含标题的效果，这是通过将Cap设置为true来指定的。

FIGURE 8.6 Lines with captions appearing as part of the line

图8.7演示了将标题应用到具有前导偏移量的行注释的效果。

FIGURE 8.7 Line with a caption appearing as part of the offset

TABLE 8.27 Line ending styles
NAME	APPEARANCE	DESCRIPTION
Square		用注释的内部颜色填充的正方形(如果有的话)
Circle		用注释的内部颜色填充的圆(如果有的话)
Diamond		菱形填充注释的内部颜色(如果有的话)
OpenArrow		两条短线相交成锐角形成一个开口箭头
ClosedArrow		在OpenArrow样式中，两条短线以锐角相交(见上文)，并由第三条线连接，形成一个三角形闭合箭头，填充了注释的内部颜色(如果有的话)
None		没有线的终点
Butt		(PDF 1.5)在终点垂直于直线本身的短线
ROpenArrow		(PDF 1.5)与OpenArrow反向的两行短线
RClosedArrow		(PDF 1.5)与ClosedArrow反向的三角形闭合箭头
Slash		(PDF 1.6)终点处的一条短线，与直线本身的垂直方向顺时针旋转30度

Square and Circle Annotations
正方形(Square)和圆形注释(PDF 1.3)分别在页面上显示矩形或椭圆。当打开它们时，会显示一个弹出窗口，其中包含相关注释的文本。矩形或椭圆内接在注释字典的Rect条目定义的注释矩形内(见606页的表8.15)。图8.8显示了两个注释，每个注释的边框宽度为18点。尽管名称为正方形和圆形，但注释矩形的宽度和高度不必相等。表8.28显示了这些类型的注释字典条目。

FIGURE 8.8 Square and circle annotations

TABLE 8.28 Additional entries specific to a square or circle annotation
KEY	TYPE	VALUE
Subtype	name	(必选)本子典描述的注释类型;对于正方形或圆形注释，必须分别为Square或Circle。
BS	dictionary	(可选)边框样式字典(border style，见611页的表8.17)，指定用于绘制矩形或椭圆的线宽和虚线图案。
注:如果存在注释字典的AP条目，优先于Rect和BS条目;参见第606页的表8.15和第8.4.4节Appearance Streams”。
IC	array	(可选;PDF1.4) 一个范围为0.0到1.0的数字数组，指定填充注释的矩形或椭圆的内部颜色(interior color)。数组元素的个数决定了定义颜色的颜色空间:
0   No color; transparent
1   DeviceGray
3   DeviceRGB
4   DeviceCMYK
BE	dictionary	(可选;PDF1.5) 边界效果(border effect)字典，描述BS条目中所描述的边界效果(见表8.18)。
RD	rectangle	(可选;PDF1.5) 一组四个数字，描述两个矩形之间的数值差异:注释的Rect条目和基础正方形或圆形的实际边界。当边界效果(BE所描述的)导致矩形的大小增加到超出正方形或圆形的大小时，就会出现这种差异。
Polygon and Polyline Annotations
多边形(Polygon)注释(PDF 1.5)在页面上显示关闭的多边形。这样的多边形可以有任意数量的由直线连接的顶点。折线注释(Polyline annotations,PDF 1.5)类似于多边形，除了第一个顶点和最后一个顶点不是隐式连接的。
TABLE 8.29 Additional entries specific to a polygon or polyline annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本子典描述的注释类型;对于正方形或圆形注释，对于多边形或折线注释，必须分别为Polygon或PolyLine。
Vertices	array	(必选) 一个数字数组，分别表示交替地水平和垂直坐标，每个顶点在默认用户空间中。
LE	array	(可选;仅对折线注释有意义，line ending) 两个名称组成的数组，用于指定直线结束样式。数组的第一个和第二个元素分别指定顶点数组中第一个和最后坐标对定义的端点的直线结束样式。表8.27给出了可能的值。缺省值:[/None /None]。
BS	dictionary	(可选)边框样式(border style)字典(见611页的表8.17)，指定绘制直线时使用的宽度和虚线模式。
IC	array	(可选;PDF1.4) 一个范围为0.0到1.0的数字数组，指定填充注释的直线端点的内部颜色(interior color)。数组元素的个数决定了定义颜色的颜色空间:
0   No color; transparent
1   DeviceGray
3   DeviceRGB
4   DeviceCMYK
BE	dictionary	(可选;PDF1.5) 边界效果(border effect)字典，描述BS条目中所描述的边界效果(见表8.18)。
IT	name	(可选;PDF1.6) 一个名称描述多边形或折线注释意图(intent参见表8.21)。有效值是:
PolygonCloud，这意味着注释的功能意图是作为云对象PolyLineDimension，这表明折线注释的功能意图是尺寸
PolygonDimension，这表明多边形注释的功能意图是作为一个尺寸
Measure	dictionary	(可选;PDF1.7) 一个度量字典(见表8.110)，它指定了应用于注释的刻度和单位。
Text Markup Annotations
文本标记注释(Text markup annotations)在文档的文本中以高亮、下划线、删除线(所有的PDF 1.3)或下波浪线(squiggly弯弯曲曲,PDF 1.4)的形式出现。当打开它们时，会显示一个弹出窗口，其中包含关联注释的文本。表8.30显示了特定于这些注释类型的注释字典条目。
TABLE 8.30 Additional entries specific to text markup annotations
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型; 对于高亮注释、下划线注释、波浪线注释或删除注释，必须分别为Highlight、Underline、Squiggly或StrikeOut。
QuadPoints	array	(必选,四方点) 一个8 × n个数字的数组，指定n个四边形在默认用户空间中的坐标。每个四边形包含注释下的文本中的一个词或一组相邻词。每个四边形的坐标是按顺序给出的
x1 y1 x2 y2 x3 y3 x4 y4
以逆时针顺序指定四边形的四个顶点(参见图8.9)。文本的方向为(x1, y1)和(x2, y2)点边连接的方向。(见附录H.执行说明92)
注意:注释字典的AP条目，如果存在，优先于QuadPoints;参见表8.15和章节8.4.4”Appearance Streams”。

FIGURE 8.9 QuadPoints specification
Caret Annotations
一个光标注释(PDF 1.5)是表示文本编辑存在的视觉符号。表8.31列出了光标注释特定的条目。
TABLE 8.31 Additional entries specific to a caret annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于光标注释，必须是Caret。
RD	rectangle	(可选;PDF1.5) 一组四个数字，描述两个矩形之间的数值差异:注释的Rect条目和底层光标的实际边界。例如，当由Sy指定的段落符号和光标一起显示时，就会出现这种差异。
这四个数字分别对应于Rect的左、上、右、下坐标和光标的坐标在默认用户空间中的差异。每个值必须大于等于0。顶部和底部差值之和必须小于Rect的高度，左侧和右侧差值之和必须小于Rect的宽度。
Sy	name	(可选) 指定与光标相关联的符号(symbol)名称:
  P   一个新的段落符号 (?)应当与光标相关联。
  None  没有与此光标关联的符号。

Rubber Stamp Annotations
一个橡皮图章注释(rubber stamp annotation，PDF 1.3)显示的文本或图形看起来就像用橡皮图章在页面上盖章一样。打开时，它会显示一个弹出窗口，包含相关注释的文本。表8.32显示了特定于这种注释类型的注释字典条目。
TABLE 8.31 Additional entries specific to a caret annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于橡皮图章注释，必须是Stamp。
Name	name	(可选) 图标的名称，用于显示注释。查看器应用程序应该至少提供以下标准名称的预定义图标外观:
Approved、Experimental、NotApproved、AsIs、Expired、NotForPublicRelease、Confidential、 Final、Sold、Departmental、ForComment、TopSecret、Draft、ForPublicRelease
也可能支持其他名称。默认值:Draft。
注意:注释字典的AP条目(如果存在)，优先于Name条目;参见606页的表8.15和8.4.4节“Appearance Streams”。

Ink Annotations
一个墨迹注释( ink annotation, PDF 1.3)表示由一条或多条不相交路径组成的手绘“涂鸦”。当打开时，它会显示一个包含相关注释文本的弹出窗口。表8.33显示了特定于这种注释类型的注释字典条目。
TABLE 8.33 Additional entries specific to an ink annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本词典描述的注释类型; 对于墨迹注释，必须是Ink。
InkList	array	(必选) 一个由n个数组组成的数组，每个数组代表一个描边路径。每个数组都是默认用户空间中的一系列交替的水平和垂直坐标，指定路径上的点。绘制时，这些点以一种依赖于实现的方式由直线或曲线连接。(见附录h中的实施说明93)
BS	dictionary	(可选) 一个边框样式字典(border style,参见611页的表8.17)，指定在绘制路径时使用的线宽和虚线模式。
注:注释字典的AP条目，如果存在，优先于InkList和BS条目;参见606页的表8.15和章节8.4.4“Appearance Streams”。

Pop-up Annotations
弹出注释( pop-up annotation, PDF 1.3)在弹出窗口中显示文本，供输入和编辑。它通常不是单独出现的，而是与标记注释(markup annotation,它的父注释parent annotation)相关联，并用于编辑父注释的文本。它本身没有外观流或相关的动作，由父级注释字典中的Popup条目标识(参见618页的表8.21)。表8.34显示了特定于这种注释类型的注释字典条目。
TABLE 8.34 Additional entries specific to a pop-up annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本词典描述的注释类型; 对于弹出注释，必须是Popup。
Parent	dictionary	(可选;必须是间接引用) 与此弹出注释相关联的父注释。
注意:如果存在这个条目，父注释的Contents、M、C和T条目(参见606页的表8.15)将覆盖弹出注释本身的这些条目。
Open	boolean	(可选) 一个标志，指定弹出注释最初是否打开显示。默认值:false(关闭)。
File Attachment Annotations
文件附件注释(file attachment annotation,PDF 1.3)包含对文件的引用，通常嵌入在PDF文件中(见3.10.3节，“Embedded File Streams”);例如，一个数据表可能使用一个文件附件注释来链接到基于该数据的电子表格文件; 激活注释将提取嵌入的文件，并让用户有机会查看它或将它存储在文件系统中。表8.35显示了特定于这种注释的注释字典条目。
TABLE 8.35 Additional entries specific to a file attachment annotation
KEY	TYPE	VALUE
Subtype	name	(必须) 本字典描述的注释类型;对于文件附件注释必须为FileAttachment。
FS	file specification	(必须) 注释关联的文件说明。
Name	name	(可选) 用于显示注释的图标的名称。查看器应用程序应该至少为以下标准名称提供预定义的图标外观:
Graph               PushPin(图钉) 
Paperclip(回形针)     Tag
还可能支持其他名称，默认值:PushPin。
注意:注释字典的AP条目，如果存在，将优先于Name条目; 参见606页的表8.15和8.4.4节“Appearance Streams”。
注释字典的Contents条目可以指定与所附文件有关的描述性文本。查看器应用程序应该使用这个条目，而不是由注释的FS条目标识的文件说明字典(见表3.41)中的可选Desc条目(PDF 1.6);见附录H的实现说明95。
Sound Annotations
一个声音注释(pdf1.2)类似于文本注释，它包含从计算机麦克风录制或从文件导入的声音，而不是文本附注。当注释被激活时，就会播放声音。在大多数情况下，该注释的行为与文本注释类似，只是图标不同(默认为扬声器)，来表示它代表一个声音。表8.36展示了针对这种类型的注释的注释字典条目。9.2节“Sounds”将讨论声音对象。
TABLE 8.31 Additional entries specific to a caret annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于声音注释，必须是Sound。
Sound	stream	(必选) 一个声音对象，定义注释激活时播放的声音(参见9.2“Sounds”)。
Name	name	(可选) 用于显示注释的图标名称。查看器应用程序应该至少为Speaker和Mic提供预定义的图标外观。也可能支持其他名称。默认值:Speaker。
注意:注释字典的AP条目，如果存在，将优先于Name条目; 参见606页的表8.15和8.4.4节“Appearance Streams”。

Movie Annotations
一个电影注释(movie annotation，PDF 1.2)包含要在计算机屏幕上和通过扬声器呈现的动画图形和声音。当注释被激活时，就会播放电影。表8.37显示了特定于这种注释类型的注释字典条目。电影将在9.3节“Movies”中讨论。
TABLE 8.37 Additional entries specific to a movie annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于电影注释，必须是Movie。
T	text string	(可选) 电影注释的标题。电影动作(第664页)可以使用这个标题来引用电影注释。
Movie	dictionary	(必选) 一个电影字典，描述电影静态特征(参见9.3节“Movies”)。
A	boolean or 
dictionary	(可选) 一个标志或字典，指定注释激活(activated)时是否以及如何播放电影。
如果这个值是一个字典，那么它就是一个指定如何播放电影的电影激活字典(参见9.3节“Movies”)。
如果这个值是布尔值true，那么应该使用默认的激活参数播放电影。如果值为false，则不应该播放电影。默认值:true。

Screen Annotations
一个屏幕注释(screen annotation，PDF 1.5)指定可以播放媒体剪辑的页面区域。它还可以作为触发动作的对象。第668页的“Rendition Actions”讨论了屏幕注释和再现动作之间的关系。表8.38显示了特定于这种注释类型的注释字典条目。
TABLE 8.38 Additional entries specific to a screen annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;对于屏幕注释，必须是Screen。
T	text string	(可选) 屏幕标注的标题。
MK	dictionary	(可选) 外观特征字典(见表8.40)。这个字典的I条目提供了用于生成屏幕注释的AP条目所引用的外观的图标(icon)。
A	dictionary	(可选;PDF1.1) 激活注释时要执行的动作(参见第8.5节“Actions”)。
AA	dictionary	(可选;一个附加动作字典(additional-actions)，定义屏幕注释的行为以响应各种触发事件(参见8.5.2节“Trigger Events”)

除上述条目外，屏幕注释还使用标注字典中常见的条目(见表8.15)，以如下方式:
?呈现操作引用的屏幕注释需要P条目。它必须引用一个有效的页面对象，并且注释必须出现在页面的Annots数组中，这样动作才有效。
?AP条目引用一个外观字典(见表8.19)，它的正常外观提供了屏幕注释的视觉外观，用于在媒体剪辑不播放时打印和默认显示。如果AP不存在，则屏幕注释没有默认的视觉外观，并且不打印。
Widget Annotations
交互式表单(见第8.6节“Interactive Forms”)使用窗体注释(widget annotations,PDF 1.2)来表示域的外观并管理用户交互。为了方便起见，当一个域只有一个相关的窗体注释时，域字典(第8.6.2节，字段字典)和注释字典的内容(contents)可以合并到一个字典中，其中包含同时属于一个域和一个注释的条目(这不会产生歧义，因为这两种字典的内容不冲突)。表8.39显示了该类型注释对应的注释字典条目;交互式表单和域将在第8.6节详细讨论。
TABLE 8.39 Additional entries specific to a file widget annotation
KEY	TYPE	VALUE
Subtype	name	(必须) 本字典描述的注释类型;对于窗体注释必须为Widget。
H	name	(可选) 注释的高亮模式(highlighting mode)，在其活动区域内按下鼠标按钮或点击鼠标时使用的视觉效果:
N    (None) No highlighting.
I     (Invert) 反转注释矩形的内容。
O    (Outline) 反转注释的边框。
P    (Push) 显示注释的向下外观，如果有的话(参见8.4.4，“Appearance Streams”)。如果没有定义向下外观，则偏移注释矩形的内容，使其看起来就像被推到页面表面之下一样。
T    (Toggle) 与P相同(P首选)。
除P以外的高亮模式将覆盖为注释定义的任何向下外观。默认值:I
MK	dictionary	(可选) 一个外观特征字典(参见表8.40)，用于构造一个动态外观流，指定注释在页面上的可视化表示。
本条目名称MK仅具有历史意义，没有直接意义。
A	dictionary	(可选;PDF1.1) 当注释被激活时要执行的动作(参见章节8.5 “Actions”)。
AA	dictionary	(可选;PDF1.2) 一个附加动作(additional-actions)字典，定义注释的行为以响应各种触发事件(参见8.5.2节”Trigger Events”)。
BS	dictionary	(可选;PDF1.2) 一个边框样式字典(border style见第611页的表8.17)，指定用于绘制注释边框的宽度和虚线模式。
注意:注释字典的AP条目，如果存在，优先于L和BS条目;参见606页的表8.15和章节8.4.4“外观流”。

MK条目可用于提供一个外观特征(appearance characteristics)字典，包含用于构造注释的外观流的附加信息。表8.40显示了本字典的内容。
TABLE 8.40 Entries in an appearance characteristics dictionary
KEY	TYPE	VALUE
R	integer	(可选) 窗体注释相对于页面逆时针旋转(rotate)的角度数。取值必须为90的倍数。
默认值:0。
BC	array	(可选，)范围为0.0到1.0的数字数组，指定窗体注释的边框颜色(border color)。数组元素的数量决定了颜色定义的颜色空间:
0   No color; transparent 
1   DeviceGray
3   DeviceRGB
4   DeviceCMYK
BG	array	(可选) 范围为0.0到1.0的数字数组，指定窗体注释的背景(background)。数组元素的数量决定了颜色空间，如上面的BC所述。
CA	text string	(可选;仅pushbutton域) 窗体注释的正常标题(normal caption)，当它不与用户交互时显示。
注意:与下面列出的其他条目不同，它们只应用于与按钮域关联的窗体注释(请参阅第686页的“Pushbuttons”)，CA条目可以与任何类型的按钮域一起使用，包括复选框(第686页的“check boxes”)和单选按钮(第688页的“radio buttons”)。
RC	text string	(可选;仅pushbutton域) 窗体注释的滚动标题(rollover caption)，当用户不按鼠标按钮将光标滚动到活动区域时显示。
AC	text string	(可选;仅pushbutton域) 窗体注释的备用(向下)标题(alternate down caption)，当鼠标按钮在其活动区域内被按下时显示。
I	stream	(可选;仅pushbutton域;必须是间接引用) 一个表单XObject，定义窗体注释的正常图标(icon)，当它不与用户交互时显示。
RI	stream	(可选;仅pushbutton域;必须是间接引用) 一个表单XObject，定义窗体注释的滚动图标(rollover icon)，当用户不按鼠标按钮，将光标滚动到活动区域时显示。
IX	stream	(可选;仅pushbutton域;必须是间接引用) 一个表单XObject，定义窗体注释的备用(向下)图标，当鼠标按钮在其活动区域内按下时显示。
IF	dictionary	(可选;仅pushbutton域) 一个图标匹配(icon fit)字典(参见Table 8.97 on page 719)，指定如何在窗体注释矩形内显示窗体注释的图标。如果存在，图标匹配字典将应用于所有注释的图标(normal, rollover, and alternate)。
TP	integer	(可选;仅pushbutton域) 一种代码，指示窗体注释的标题文本相对于图标的位置:
  0 No icon; caption only 
  1 No caption; icon only 
  2 Caption below the icon 
  3 Caption above the icon 
  4 Caption to the right of the icon 
  5 Caption to the left of the icon 
  6 Caption overlaid directly on the icon 
  Default value: 0.

Printer`s Mark Annotations
一个打印机的标记注释(printer`s mark annotation，PDF 1.4)表示添加到页面上的图形符号，如注册目标、颜色条或切割标记，以帮助生产人员识别多版作业的组件并在生产过程中保持一致的输出。有关进一步讨论，请参阅第10.10.2节，“Printer`s Marks”。
Trap Network Annotations凹印网注释
凹印网注释( trap network annotation，PDF 1.3)定义了PDF文档页面的凹印特征。(凹印是沿着颜色边界在页面上添加标记的过程，以避免印刷时由于着色剂的错误配准而产生的不必要的视觉假象)。一个页面最多可以有一个凹印网注释，它的Subtype条目的值为TrapNet，并且总是在页面对象的 Annots数组的最后一个元素(参见第144页的 “Page Objects”)。有关进一步的讨论，请参阅第10.10.5节“Trapping Support”。
Watermark Annotations
水印注释(watermark annotation PDF 1.6)用于表示希望在页面上以固定大小和位置打印的图形，而不管打印页面的尺寸。水印注释字典(见表8.41)的FixedPrint条目是一个字典，它包含了用来指定注释的大小和位置的值(见表8.42)。
TABLE 8.41 Additional entries specific to a watermark annotation
KEY	TYPE	VALUE
Subtype	name	(必选) 本字典描述的注释类型;水印注释必须为Watermark。
FixedPrint	dictionary	(可选) 一个固定打印字典(fixed print dictionary,见表8.42)，它指定了该注释相对于目标媒介的尺寸应该如何绘制。如果不存在此条目，则在绘制注释时不需要特别考虑目标媒介的尺寸。
注:如果在绘制时不知道目标媒介的尺寸，则相对于页面的MediaBox条目指定的尺寸进行绘制(见表3.27)。

TABLE 8.42 Entries in a fixed print dictionary
KEY	TYPE	VALUE
Type	name	(必须) 必须为FixedPrint
Matrix	array	(可选) 用于在渲染前转换注释矩形的矩阵。默认值：单位矩阵 [1 0 0 1 0 0].
注意:当将内容定位在页边附近时，建议使用此条目提供合理的偏移量，以允许不可打印的页边距。
H	number	(可选) 关联内容水平平移量，它是目标媒介宽度的百分比(如果未知，则为页面MediaBox的宽度)。1.0表示100%，0.0表示0%。不建议使用负值，因为它们可能导致内容被绘制出页面。
默认值：0
V	number	(可选) 关联内容垂直平移量，它是目标媒介高度的百分比(如果未知，则为页面MediaBox的高度)。1.0表示100%，0.0表示0%。不建议使用负值，因为它们可能导致内容被绘制出页面。

水印注释没有弹出窗口或其他交互元素。在屏幕上显示水印注释时，查看器应用程序应该使用媒体框的尺寸作为页面大小，以便滚动和缩放行为与其他注释相同。
当使用FixedPrint条目呈现水印注释时，会发生以下行为:
?注释的矩形(由其Rect条目指定)被平移到原点，并由其FixedPrint字典的Matrix条目进行转换，以生成具有任意方向的四边形。
?转换后的注释矩形被定义为包含此四边形的最小直立矩形;它被用来代替第612页算法8.1的步骤2和3中提到的注释矩形。
此外，给定一个矩阵B，它将一个缩放和旋转的页面映射到默认用户空间，一个新的矩阵将被计算出来，抵消B，并将打印页面的原点平移到默认用户空间的原点。此转换用于确保正确的缩放和对齐。
示例8.10显示了一个水印注释，在距印刷页面左、上边缘分别1英寸的位置打印文本字符串。
Example 8.10
8 0 obj 				% Watermark appearance
<<
/Length ...
/Subtype /Form
/Resources ...
/BBox ...
>>
stream
...
BT
/F1 1 Tf
36 0 0 36 0 -36 Tm
(Do Not Build) Tx
ET
...
endstream
endobj

9 0 obj 			% Watermark annotation
<<
/Rect ...
/Type /Annot
/Subtype /Watermark
/FixedPrint 10 0 R
/AP <</N 8 0 R>>
>>

% in the page dictionary
/Annots [9 0 R]

10 0 obj 			% Fixed print dictionary
<<
/Type /FixedPrint
/Matrix [1 0 0 1 72 -72] 	% Translate one inch right and one inch down
/H 0
/V 1.0 						% Translate the full height of the page vertically
>>
endobj
在PDF页面大小等于打印页面大小的常见情况以外的情况下，带有FixedPrint条目的水印注释应按以下方式打印:
?当在查看器应用程序中选择页面平铺时(即单个PDF页面打印在多个页面上)，注释将在每个页面上按照指定的大小和位置打印，以确保任何封闭内容在每个打印页面上清晰展示。
?当选择n-up打印时(即多个PDF页面在单个页面上打印)，注释将按指定的大小打印，它的位置就像打印页面的尺寸限制在页面的单个部分。这确保了任何封闭内容不会覆盖其他页的内容，从而使其难以辨认。(见附录h的实施注97)
8.5 Actions
除简单地跳转到文档中的目标外，注释或提纲项可以指定查看器应用程序要执行的动作(action，pdf1.1)，例如启动应用程序、播放声音或更改注释的外观状态。注释或大纲项字典(参见第606页的表8.15和第585页的表8.4)中的可选A条目指定了激活注释或大纲项时要执行的动作; 在PDF 1.2中，各种其他情况也可能触发动作(参见8.5.2节“Trigger Events”)。此外，文档目录中的可选OpenAction条目(第3.6.1节，“文档目录”)可以指定文档打开时要执行的动作。PDF包括各种各样的标准动作类型，在8.5.3节“Action Types”中详细描述。
8.5.1 Action Dictionaries
一个动作字典(action dictionary)定义了一个动作的特征和行为。表8.43列出了所有动作字典中常见的必选和可选条目。字典可以包含特定于特定操作类型的额外条目;详情参见8.5.3节“Action Types”中对各个动作类型的描述。
TABLE 8.43 Entries common to all action dictionaries
KEY	TYPE	VALUE
Type	name	(可选) 本字典描述的PDF对象的类型;如果存在，动作字典必须为Action。
S	name	(必选) 本词典描述的动作类型; 具体值见653页表8.48。
Next	dictionary or array	(可选;PDF1.2) 本字典所表示的动作之后要执行的下一个动作或动作序列。该值可以是一个单独的动作字典，也可以是一个按顺序执行的动作字典数组;参见下面的进一步讨论。

动作字典的Next条目(PDF 1.2)允许将动作序列链接在一起。例如，用鼠标单击链接注释的效果可能是播放声音、跳转到新页面和播放电影。请注意，Next条目不限于单个动作，而是可以包含一个动作数组，每个动作又可以有自己的Next。因此，动作可以形成树而不是简单的链表。每个Next数组中的动作是按顺序执行的，每个动作之后依次执行其Next条目中指定的任何动作，以此递归执行。查看器应用程序应该尝试在异常情况下提供合理的行为。例如，自引用动作不应该执行多次，关闭文档或下一个动作不可能执行，应该终止执行序列。应用程序还应该提供一些机制，让用户可以中断并手动终止一系列动作。
pdf1.5引入了过渡动作，支持在动作序列的绘制过程中进行控制;请参阅670页的 “Transition Actions”。
注意:任何动作都不应该修改它自己的动作字典或它驻留的动作树中的任何其他动作字典。这种修改树中随后执动作的结果是未定义的。
8.5.2 Trigger Events
注释、页面对象或(从PDF 1.3开始)交互式表单字段可以包含一个名为AA的条目，它指定一个附加动作字典(additional-actions dictionary,PDF 1.2)，扩展可以触发执行动作的事件集。在PDF 1.4中，文档目录字典(参见第3.6.1节，“Document Catalog”)也可能包含一个AA条目，用于触发影响整个文档的事件。表8.44至表8.47给出了这种类型字典的内容。(见附录h的实施说明98及99)
PDF 1.5引入了四个触发事件(Trigger Events)来支持多媒体演示文稿(presentations):
?PO和PC条目与页面对象的附加动作字典(参见表8.45)中的O和C条目具有类似的功能。但是，将这些触发器与注释关联起来可以使注释对象自包含，并极大地简化了制作。例如，包含此类操作的注释可以在页面之间复制或移动，而不需要更改页面打开/关闭动作。
?PV和PI条目允许区分打开的页面和可见的页面。在任何时候，查看器应用程序中只有一个页面被认为是打开的，而多个页面可能是可见的，这取决于页面布局。
注意:对于这些触发事件，由注释的F条目指定的标志的值(参见8.4.2节，“Annotation Flags”)与给定的触发事件是否发生无关。
TABLE 8.44 Entries in an annotation’s additional-actions dictionary
KEY	TYPE	VALUE
E	dictionary	(可选;PDF1.2) 当光标进入(enters)注释的活动区域时要执行的动作。
X	dictionary	(可选;PDF1.2) 当光标退出(exits)注释的活动区域时要执行的操作。(x代表“close”图标。)
D	dictionary	(可选;PDF1.2) 当鼠标按钮在注释的活动区域内被按下时要执行的操作。(D代表“down”。)
U	dictionary	(可选;PDF1.2) 当鼠标按钮在注释的活动区域内释放时要执行的操作。(U代表“up”。)
注意:为了向后兼容，注释字典中的A条目如果存在，优先于此条目(参见606页的表8.15)。
Fo	dictionary	(可选;PDF 1.2;仅窗口注释) 当注释接收到输入焦点(focus)时执行的操作。
Bl	dictionary	(可选;PDF 1.2;仅窗口注释) (大写B，小写L) 当注释失去输入焦点时执行的操作。(Bl代表“blurred”)。
PO	dictionary	(可选;PDF1.5) 当打开包含注释的页面时要执行的动作(例如，当用户从下一页或上一页导航到该页面时，或者通过链接注释或大纲项导航到该页面时)。该动作在页面的附加动作字典中(见表8.45)的O动作和文档目录中的OpenAction条目(参见表3.25)之后执行，如果页面和文档中存在这些动作。(PO代表Page Open)
PC	dictionary	(可选;PDF1.5) 当包含该注释的页面关闭时执行的动作(例如，当用户导航到下一页或上一页，或跟随一个链接注释或大纲项)。如果页面的附加动作字典(参见表8.45)中有C动作，那么该动作将在C动作之前执行。PC=PageOpen
PV	dictionary	(可选;PDF1.5) 当包含注释的页面在查看器应用程序的用户界面中变为可见时执行的动作。PV=PageVisible
PI	dictionary	(可选;PDF1.5) 当包含注释的页面在查看器应用程序的用户界面中不再可见时执行的操作。PI=PageInvisible

TABLE 8.45 Entries in a page object’s additional-actions dictionary
KEY	TYPE	VALUE
O	dictionary	(可选;PDF1.2) 当页面打开(Open)时要执行的动作(例如，当用户从下一页或上一页导航到页面，或者通过链接注释或大纲项导航到页面时)。该操作独立于文档目录中的OpenAction条目中可能定义的任何操作(参见3.6.1节“Document Catalog”)，并在该操作之后执行。(见附录h中的实现注释100)
C	dictionary	(可选;PDF1.2) 当页面关闭(closed)时要执行的动作(例如，当用户导航到下一页或上一页，或跟随链接注释或大纲项)。此操作适用于正在关闭的页面，并在任何其他页面打开之前执行。(见附录h中的实施注释100)
K	dictionary	(可选;PDF1.3) 当用户在文本框或组合框中输入按键(keystroke)或在可滚动列表框中修改选择时执行的JavaScript动作。
此操作可以检查按键的有效性，并拒绝或修改它。
F	dictionary	(可选;PDF1.3) 在字段格式化(formatted)以显示其当前值之前执行的JavaScript动作。此动作可以在格式化前修改字段的值。
V	dictionary	(可选;PDF1.3) 当字段的值改变时执行的JavaScript动作。此动作可以检查新值的有效性。(V代表“validate”)
C	dictionary	(可选;PDF1.3) 当另一个字段的值发生变化时，执行一个JavaScript动作来重新计算这个字段的值。(C代表“calculate”)文档字段重新计算的顺序由交互表单字典中的CO条目定义(参见8.6.1节“Interactive Form Dictionary”)。

TABLE 8.47 Entries in the document catalog’s additional-actions dictionary
KEY	TYPE	VALUE
WC	dictionary	(可选;PDF1.4) 在关闭文档之前执行的JavaScript动作。(WC代表“will close”)
WS	dictionary	(可选;PDF1.4) 保存文档之前要执行的JavaScript动作。(WS代表“will save”)
DS	dictionary	(可选;PDF1.4) 保存文档后执行的JavaScript动作。(DS代表“did save”)
WP	dictionary	(可选;PDF1.4) 在打印文档之前要执行的JavaScript动作。(WP代表“will print”)
DP	dictionary	(可选;PDF1.4) 在打印文档后执行的JavaScript动作。(DP代表“did print”)

对于触发事件E(enter)、X(exit)、D(down)和U(up)，术语mouse表示具有以下特征的通用指向设备:
?一个选择按钮，可以按下、按住和释放。如果有多个鼠标按钮，选择按钮通常是左键。
?位置的概念――也就是设备指向屏幕上的位置的指示。位置通常由屏幕光标表示。
?焦点的概念―即文档中的哪个元素当前正在与用户交互。在许多系统中，此元素由闪烁的光标、焦点矩形或颜色变化表示。
PDF查看器应用程序必须确保存在这样的设备，以便正确地执行相应的动作。与鼠标相关的触发事件受以下约束:
?一个E(enter)事件只能在鼠标按钮打开(up)时发生。
?如果没有前面的E事件，X(exit)事件就不能发生。
?如果没有前面的E和D事件，U (up)事件就不能发生。
?在重叠或嵌套注释的情况下，进入第二个注释的活动区域会导致第一个注释发生X事件。
注意:字段相关的触发事件K(keystroke)，F(format)，V(validate)，和C
(calculate)没有定义按钮字段(参见第685页的“Button Fields”)。由这些事件之一触发的动作的效果只受动作本身的限制，并且可以发生在描述的事件范围之外。例如，即使F事件用于触发在显示之前格式化字段值的动作，也可能由该事件触发一个动作执行计算或对文档进行任何其他修改。
这些字段相关的触发事件可以通过用户交互或编程方式发生，比如响应交互表单字典(参见8.6.1节“Interactive Form Dictionary”)中的NeedAppearances条目，导入
FDF数据(章节8.6.6“Forms Data Format”)，或JavaScript动作(第709页的“JavaScript  Actions”)。例如，用户修改字段值会触发级联计算，并进一步格式化和验证文档中的其他字段。
8.5.3 Action Types
PDF支持表8.48中列出的标准动作类型。以下部分将详细描述每种类型。插件扩展可以添加新的动作类型。
TABLE 8.48 Action types
ACTION TYPE	DESCRIPTION	DISCUSSED IN SECTION
GoTo	转到当前文档中的目标。	“Go-To Actions” on page 654
GoToR	(“Go-to remote”)转到另一个文档中的目标。	“Remote Go-To Actions” on page 655
GoToE	(“Go-to embedded”; PDF 1.6)转到嵌入文件中的目标。	“Embedded Go-To Actions” on page 655
Launch	启动一个应用程序，通常是打开一个文件。	“Launch Actions” on page 659
Thread	开始读一个文章线程。	“Thread Actions” on page 661
URI	解析统一资源标识符。	“URI Actions” on page 662
Sound	(PDF 1.2)播放声音。	“Sound Actions” on page 663
Movie	(PDF 1.2)播放电影。	“Movie Actions” on page 664
Hide	(PDF 1.2)设置注释的隐藏标志。	“Hide Actions” on page 665
Named	(PDF 1.2)执行查看器应用程序预定义的动作。	“Named Actions” on page 666
SubmitForm	(PDF 1.2)将数据发送到统一资源定位器。	“Submit-Form Actions” on page 703
ResetForm	(PDF 1.2)将字段设置为默认值。	“Reset-Form Actions” on page 707
ImportData	(PDF 1.2)从文件导入字段值。	“Import-Data Actions” on page 708
JavaScript	(PDF 1.3)执行JavaScript脚本。	“JavaScript Actions” on page 709
SetOCGState	(PDF 1.5)设置可选内容组的状态。	“Set-OCG-State Actions” on page 667
Rendition	(PDF 1.5)控制多媒体内容的播放。	“Rendition Actions” on page 668
Trans	(PDF 1.5)使用转换字典更新文档的显示。	“Transition Actions” on page 670
GoTo3DView	(PDF 1.6)设置3D注释的当前视图	“Go-To-3D-View Actions” on page 670

注意:PDF规范的以前版本描述了一种称为set-state动作的动作类型;这种类型的动作现在被认为是过时的，不再建议使用。PDF 1.2中定义了另一种动作类型，即无操作操作(no-op action)，但从未实现;它不再被定义，应该被忽略。
Go-To Actions
go-to动作将视图更改为指定的目标(页面、位置和放大倍数)。表8.49显示了特定于这种操作类型的操作字典条目。
TABLE 8.49 Additional entries specific to a go-to action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型;go-to action必须为GoTo。
D	name, 
byte string, 
or array	(必选) 要跳转到的目的地(参见8.2.1节“Destinations”)。

在链接注释或大纲项的A条目中指定转到动作(请参见第622页的表8.24和第585页的表8.4)与直接使用Dest条目指定目标的效果相同。例如，示例8.11中显示的链接注释使用了一个转到动作，与623页上示例8.9中的链接注释直接指定目的地具有相同的效果。然而，转到动作不那么紧凑，并且不兼容PDF 1.0; 因此，最好使用直接目的地。
Example 8.11
93 0 obj
<< /Type /Annot
/Subtype /Link
/Rect [71 717 190 734]
/Border [16 16 1]
/A << /Type /Action
/S /GoTo
/D [3 0 R /FitR C4 399 199 533]
 		>>
>>
endobj
Remote Go-To Actions
远程转到动作类似于普通的转到动作，但会跳转到另一个PDF文件中的目标，而不是当前文件。表8.50显示了特定于这种动作类型的动作字典条目。
注意:远程转到动作不能用于嵌入文件;参见655页的“Embedded GoTo Actions”。
TABLE 8.50 Additional entries specific to a remote go-to action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型;远程转到动作必须为GoToR。
F	file specification	(必选) 目标所在的文件。
D	name,
byte string, 
or array	(必选) 要跳转到的目标(参见8.2.1节“Destinations”)。如果值是一个定义显式目标的数组(582页描述“Explicit Destinations”)，第一个元素必须是远程文档中的页码，而不是对当前文档中的页面对象的间接引用。第一页编号为0。
NewWindow	boolean	(可选;PDF 1.2) 一个标志指定是否在新窗口中打开目标文档。如果此标志为false，目标文档将替换同一窗口中的当前文档。如果没有这个条目，查看器应用程序的行为应该与当前用户的首选项一致。

Embedded Go-To Actions
嵌入式转到动作(PDF 1.6)类似于远程转到动作，但允许跳转到或从嵌入到另一个PDF文件中的PDF文件(参见“Embedded File Streams”)跳转。嵌入文件可能与文件附件注释相关(参见第637页的“文件附件注释”)或与EmbeddedFiles名称树中的条目相关(参见第3.6.3节“Name Dictionary”)。嵌入式文件又可能包含嵌入式文件。表8-51给出了特定于嵌入式转到动作的动作字典条目。
嵌入式转到动作提供了一种完整的工具，用于在嵌套嵌入式文件层次结构中的文件与具有相同或不同层次结构的另一个文件之间进行链接。使用的术语如下:
?源(source)是包含嵌入式转到动作的文档。
?目标(target)是目的地所在的文档。
动作字典中的T条目是一个目标字典，它定位目标与源的关系，与用相对路径描述文件系统中两个文件之间的物理关系的方式非常相似。目标字典可以递归嵌套，以便在到达最后一个目标之前指定一个或多个中间目标。在导航层次结构时，每个中间目标被称为当前文档(current document)。最初，源是当前文档。
注意:目标字典有一个无限循环是错误的(例如，目标字典引用自己的循环)。查看器应用程序应该尝试检测这种情况，并在发现时拒绝执行动作。
?子(child)文档是嵌入在另一个PDF文件中的文档。
?文件嵌入的文档是它的父文档(parent)。
?根文档(root document)是没有嵌入到另一个PDF文件中的文档。目标和源可能包含在根文档中或嵌入文档中。
TABLE 8.51 Additional entries specific to an embedded go-to action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 嵌入式转到动作必须为GoToE。
F	file specification	(可选) 目标的根文档相对于源的根文档。如果没有这个条目，则源和目标共享相同的根文档。
D	name,
byte string, 
or array	(必选) 要跳转到的目标(参见8.2.1节“Destinations”)。如果值是一个定义显式目标的数组(582页描述“Explicit Destinations”)，第一个元素必须是远程文档中的页码，而不是对当前文档中的页面对象的间接引用。第一页编号为0。
NewWindow	boolean	(可选;PDF 1.2) 一个标志指定是否在新窗口中打开目标文档。如果此标志为false，目标文档将替换同一窗口中的当前文档。如果没有这个条目，查看器应用程序的行为应该与当前用户的首选项一致。
T	dictionary	(如果F存在可选;否则必选) 一个目标字典( target dictionary)指定目标文档的路径信息(参见表8.52)。每个目标字典指定到目标的完整路径中的一个元素，并且可能嵌套目标字典指定其他元素。

TABLE 8.52 Entries specific to a target dictionary
KEY	TYPE	VALUE
R	name	(必选) 指定当前文档和目标(可能是中间目标)之间的关系(relationship)。有效值是P(目标是当前文档的父节点)和C(目标是当前文档的子节点)。
N	byte string	(如果R的值是C，目标位于EmbeddedFiles名称树中，则必须;否则，必须不出现) EmbeddedFiles名称树中的文件名称(Name)。
P	integer or 
byte string	(如果R的值是C，目标与文件附件注释相关联，则必须;否则，必须不出现) 如果该值是一个整数，它指定当前文档中包含文件附件注释的页码(从零开始)。如果该值是一个字符串，它指定在当前文档中的一个命名目标，目标提供文件附件注释的页码。P=page
A	integer or text 
string	(如果R的值是C，目标与文件附件注释相关联，则必须;否则，必须不出现) 如果该值是一个整数，它指定了P指定页面的Annots数组(见表3.27)中注释的索引(从零开始)。如果值是一个文本字符串，它指定了
注释字典中的NM的值(见表8.15)。A=annotation
T	dictionary	(可选) 一个目标(target)字典指定目标文档的附加路径信息。如果没有这个条目，当前文档就是包含目标的目标文件。

例8.12说明了源和目标之间几种可能的关系。所示的每个对象都是嵌入式转到动作的动作字典。
Example 8.12
1 0 obj 					% Link to a child 
<< /Type /Action 
/S /GoToE 
/D (Chapter 1)
/T << /R /C 
/N (Embedded document) >>
>> 
endobj

2 0 obj 					% Link to the parent
<< /Type /Action 
/S /GoToE
/D (Chapter 1)
/T << /R /P >>
>>
endobj

3 0 obj 					% Link to a sibling document
<< /Type /Action 
/S /GoToE 
/D (Chapter 1) 
/T << /R /P 
/T << /R /C 
/N (Another embedded document) >>
>>
>>
endobj

4 0 obj 			% Link to an embedded file in an external document 
<< /Type /Action 
/S /GoToE 
/D (Chapter 1) 
/F (someFile.pdf) 
/T << /R /C
/N (Embedded document) >>
>> 
endobj
someFile.pdf文件嵌入了<Embedded document>

5 0 obj 					% Link from an embedded file to a normal file 
<< /Type /Action 
/S /GoToE 
/D (Chapter 1) 
/F (someFile.pdf) 
>> 
endobj

6 0 obj 					% Link to a grandchild 
<< /Type /Action 
/S /GoToE 
/D (Chapter 1)
/T << /R /C
/N (Embedded document) 
/T << /R /C
/P (A destination name)
/A (annotName) 
>>
>>
>>
endobj

7 0 obj 			% Link to a niece/nephew through the source`s parent 
<< /Type /Action 
/S /GoToE 
/D (destination) 
/T << /R /P 
/T << /R /C 
/N (Embedded document)
/T << /R /C
/P 3
/A (annotName)
>>
>>
>> 
>>
endobj
Launch Actions
启动动作启动应用程序或打开或打印文档。表8-53给出了特定于这种类型动作的动作字典条目。
可选的Win、Mac和Unix条目允许动作字典包含特定平台参数，用于启动指定应用程序。如果给定平台没有这样的条目，则使用F条目。表8-54给出了Windows平台的特定平台启动参数。在本文发布时，Mac OS和UNIX平嵌入式转到台的参数还没有定义。
TABLE 8.53 Additional entries specific to a launch action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 启动动作必须为Launch。
F	file specification	(如果Win、Mac或Unix都不存在，则为必须) 要启动的应用程序或要打开或打印的文档。如果没有这个条目，并且查看器应用程序不理解任何备选条目，它就不应该做任何事情。
Win	dictionary	(可选) 一个字典，包含windows特定的启动参数(见表8.54;参见附录H中的实现说明101)。
Mac	(undefined)	Mac OS特定的启动参数;目前没有定义。
Unix	(undefined)	UNIX特定的启动参数;目前没有定义。
NewWindow	boolean	(可选;PDF 1.2) 一个标志指定是否在新窗口中打开目标文档。如果此标志为false，目标文档将替换同一窗口中的当前文档。如果没有这个条目，查看器应用程序的行为应该与当前用户的首选项一致。如果F项指定的文件不是PDF文档，则忽略此项。

TABLE 8.54 Entries in a Windows launch parameter dictionary
KEY	TYPE	VALUE
F	byte string	(必须) 要启动的应用程序或要打开或打印的文档的文件名(file name)，以标准的Windows路径名格式。如果名称字符串包含一个反斜杠字符(\)，反斜杠本身之前必须加一个反斜杠。
注意:该值必须是一个简单字符串;它不是一个文件规范。
D	byte string	(可选) 用标准DOS语法指定默认目录(directory)的字节字符串。
O	ASCII string	(可选) 一个ASCII字符串指定要执行的操作(operation):
open    打开一个文档
print     打印一个文档
如果F条目指定的是应用程序而不是文档，则忽略该条目并启动应用程序。默认值:open。
P	byte string	(可选) 传递给F项指定的应用程序的参数(parameter)字符串。如果F指定文档，则应该忽略此条目。

Thread Actions
一个线程动作跳转到当前文档或其他文档中的文章线程(参见8.3.2节“Articles”)上的指定珠子。表8-55显示了特定于这种类型动作的动作字典条目。
TABLE 8.55 Additional entries specific to a thread action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于线程动作，必须是Thread。
F	file specification	(可选)包含线程的文件。如果没有这个条目，则线程在当前文件中。
D	dictionary, integer, 
or text string	(必须) 目标线程，以下列形式之一指定:
?对线程字典的间接引用(参见8.3.2节“Articles”)。在这种情况下，线程必须在当前文件中。
?线程在其文档目录的Threads数组中的索引(参见第3.6.1节“Document Catalog”)。数组中的第一个线程的索引为0。
?在线程信息字典中指定的线程标题(参见第596页的表8.11)。如果两个或多个线程具有相同的标题，则使用文档目录的threads数组中最先出现的那个。
B	dictionary or integer	(可选) 目标线程上的珠子，以下列形式之一指定:
?间接引用珠子字典(参见第8.3.2节“Articles”)。在这种情况下，线程必须在当前文件中。
?在线程内的珠子索引。线中的第一个珠子的索引为0。

URI Actions
统一资源标识符(URI,uniform resource identifier)是一个字符串，它标识(解析为)internet上的资源――通常是超文本链接的目标文件，尽管它也可以解析为查询或其他实体。URI在Internet RFC 2396，统一资源标识符(URI):通用语法中有描述;见参考文献。)
URI动作导致URI被解析。表8.56显示了特定于这种类型动作的动作字典条目。(参见附录h实现注释102和103。)
TABLE 8.56 Additional entries specific to a URI action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于URI动作，必须是URI。
URI	ASCII 
string	(必选) 要解析的统一资源标识符，以7位ASCII编码。
IsMap	boolean	(可选) 一个标志指定URI解析时是否跟踪鼠标位置(见下文)。默认值:false。
此条目仅适用于用户单击注释所触发的动作;对于与大纲项或文档的OpenAction条目相关联的动作，它会被忽略。

如果IsMap标志为true，并且用户通过单击注释触发了URI动作，则执行该操作时的鼠标位置坐标应该从设备空间转换到用户空间，然后相对于注释矩形左上角偏移(即，URI动作与注释中Rect条目的值相关联)。例如，如果用户空间中的鼠标坐标是(xm, ym)，注释矩形从左下的(llx, lly)扩展到右上的(urx, ury)，最终的坐标(xf, yf)如下:
(xf = xm - llx )
(yf = ury - ym)
如果结果坐标(xf, yf)是小数，它们应该四舍五入到最接近的整数值。然后将它们添加到待解析的URI中，以逗号分隔，以问号开头，如下例所示:
http://www.adobe.com/intro?100,200
为了支持URI动作，PDF文档的目录(参见第3.6.1节“Document Catalog”)可能包含一个URI条目，其值是一个URI字典。在出版时，这种字典只定义了一个条目(见表8.57)。
TABLE 8.57 Entry in a URI dictionary
KEY	TYPE	VALUE
Base	ASCII 
string	(可选) 用于解析相对URI引用的基URI。文档中的URI动作可以以部分形式指定URI，并相对于此基地址进行解释。如果没有指定基URI，则相对于文档本身的位置来解释这些部分URI。这个条目的使用类似于body元素<BASE>的使用，在HTML 4.01规范中有描述(参见参考书目)。

Base条目允许在可能脱离上下文访问文档的情况下记录文档的URI。例如，如果一个文档被移动到一个新位置，但是包含到其他未被移动文档的相对链接，Base条目可以用来将这些链接引用到其他文档的真实位置，而不是被移动文档的位置。
Sound Actions
一个声音动作(PDF 1.2)通过计算机的扬声器播放声音。表格8.58显示了特定于这种类型动作的动作字典条目。声音将在9.2节“Sounds”中讨论。
TABLE 8.58 Additional entries specific to a sound action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于声音动作，必须是Sound。
Sound	stream	(必选) 一个声音对象，定义要播放的声音(见章节9.2“Sounds”;另见附录H中的实施说明104)。
Volume	number	(可选)播放声音的音量，在?1.0 ~ 1.0范围内;参见附录h中的实现注释106。默认值:1.0。
Synchronous	boolean	(可选) 一个标志指定声音是同步播放还是异步播放;参见附录h中的实现注释106。如果该标志为true，查看器应用程序保持控制，除了取消声音外，不允许其他用户交互，直到声音完全播放完毕。默认值:false。
Repeat	boolean	(可选) 指定是否无限重复声音。如果存在此条目，则忽略Synchronous条目。默认值:false。
Mix	boolean	(可选) 一个标志指定是否将此声音与其他正在播放的声音混合;参见附录h中的实现注释107。如果此标志为false，则在开始此声音之前，任何之前播放的声音将被停止;这可以用来停止重复的声音(参见上面的Repeat)。默认值:false。
Movie Actions
电影动作(PDF 1.2)可用于在浮动窗口中或在电影注释的注释矩形内播放电影(参见第639页的“Movie Annotations”和第9.3节“Movies”)。电影注释必须与作为链接注释目标或包含电影动作的大纲项的页面相关联，或者与动作关联的页面对象相关联。(见附录h执行说明108)
注意:电影动作本身并不保证在尝试播放电影之前会显示电影所在的页面;这种页面更改动作必须显式执行。
电影动作字典的内容与电影激活字典相同(参见第785页的表9.31)，额外的条目如表8.59所示。与电影注释关联的激活字典的内容提供默认值。在电影动作字典中指定的任何信息都会覆盖这些值。
TABLE 8.59 Additional entries specific to a movie action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于电影动作，必须是Movie。
Annotation	dictionary	(可选) 对电影注释的间接引用，标识要播放的电影。
T	text string	(可选) 电影注释的标题(title)，标识要播放的电影。
注意:字典必须包含一个Annotation或一个T条目，但不能同时包含两个。
Operation	name	(可选)对电影执行的操作:
Play  开始播放电影，使用字典的mode条目指定的播放模式(参见785页的表9.31)。如果电影当前处于暂停状态，在播放前它将被重新定位到开始位置(或字典的Start条目指定的起点，如果存在)。
Stop  停止播放电影
Pause  暂停一个播放中的电影
Resume  恢复暂停的电影。
Hide Actions
一个隐藏动作(PDF 1.2)在屏幕上隐藏或显示一个或多个注释，通过设置或清除它们的隐藏标记(参见第8.4.2节“Annotation Flags”)。这种类型的动作可以与外观流和触发事件结合使用(8.4.4节“Appearance Streams”和8.5.2节“Trigger Events”)，在屏幕上显示弹出帮助信息。例如，注释的附加动作字典中的E (enter)和X (exit)触发事件可以用于在用户将光标滚动到或移出页面上的活动区域时显示和隐藏注释。这可以用来弹出一个帮助标签或工具提示，描述在页面上的那个位置单击的效果。表8.60给出了特定于这种类型动作的动作字典条目。(见附录h的实施说明109和110)
TABLE 8.60 Additional entries specific to a hide action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于隐藏动作，必须是Hide。
T	dictionary, 
text string, or array	(必选) 要隐藏或显示的注释，以下列任何一种形式指定:
?对注释字典的间接引用
?一个文本字符串，给出交互表单域的完全限定域名，其关联的窗体注释将受到影响(请参阅676页的“Field Names”)
?这样的字典或文本字符串的数组
H	boolean	(可选) 一个标志，指示隐藏注释(true)还是显示注释(false)。默认值:true。
Named Actions
表8.61列出了PDF查看器应用程序期望支持的几个命名动作(PDF 1.2);将来可能会增加更多的名字。(见附录h执行注释111及112)
TABLE 8.61 Named actions
NAME	ACTION
NextPage	转到文档的下一页。
PrevPage	转到文档的上一页。
FirstPage	转到文档的第一页。
LastPage	转到文档的最后一页。

注意:查看器应用程序可能支持附加的、非标准的命名动作，但使用它们的任何文档都是不可移植的。如果查看器遇到不适合查看平台的命名动作，或者查看器不认识该名称，则不应执行任何动作。
表8.62显示了特定于命名动作的动作字典条目。
TABLE 8.62 Additional entries specific to named actions
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于命名动作，必须是Named。
N	name	(必选) 要执行的动作的名称(见表8.61)。
Set-OCG-State Actions
一个设置OCG状态动作(PDF 1.5)设置一个或多个可选内容组的状态(参见第4.10节“Optional Content”)。表8.63显示了特定于这种类型动作的动作字典条目。
TABLE 8.63 Additional entries specific to a set-OCG-state action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于设置OCG状态动作，必须是SetOCGState。
State	array	(必选) 由任意数量的序列组成的数组，以一个名称对象(ON、OFF或Toggle)开头，后面跟着一个或多个可选内容组字典。数组元素从左到右处理;每个名称被应用到随后的组，直到遇到下一个名称:
?ON  设置后续组的状态为ON
?OFF  设置后续组的状态为OFF
?Toggle  反转后续组的状态。
PreserveRB	boolean	(可选) 如果为true，表示当应用State数组中的状态时，可选内容组之间的单选按钮状态关系(由当前配置字典中的RBGroups条目指定;参见376页的表4.51)应该保存。也就是说，在状态数组处理期间，如果将一个组设置为ON(通过ON或Toggle)，则属于同一单选按钮组的任何其他组都将关闭。如果一个组设置为OFF，则对其他组没有影响。
如果PreserveRB为false，则忽略单选按钮状态关系(如果有的话)。
默认值：true

当执行set-OCG-state动作时，从左到右处理State数组。每个名称应用于数组中随后的组，直到遇到下一个名称，如下例所示。
Example 8.13
<< /S /SetOCGState
/State [/OFF 2 0 R 3 0 R /Toggle 16 0 R 19 0 R /ON 5 0 R]
>>
一个组可以在State数组中出现多次;每次遇到它时，根据最近的名称设置它的状态。例如，如果数组包含[/OFF 1 0 R /Toggle 1 0 R]，则执行该操作后，组的状态将为ON。ON, OFF和Toggle序列没有必要的顺序。数组中的多个序列可以包含相同的名称。
注意:虽然规范允许一个组在State数组中出现多次，但这并不打算实现动画或任何其他顺序绘图操作。PDF处理应用程序可以自由累积所有状态更改，并且在重绘之前只对所有受影响的组同时应用净更改。
Rendition Actions
一个渲染动作(PDF 1.5)控制多媒体内容的播放(见第9.1节“Multimedia”)。该动作可以通过以下方式使用:
?要开始播放一个渲染对象(参见第9.1.2节“Renditions”)，将其与屏幕注释(参见第639页的“Screen Annotations”)关联起来。屏幕注释指定播放渲染的位置，除非另有指定。
?停止、暂停或继续一个播放演奏。
?触发可能执行自定义操作的JavaScript脚本的执行。
表8.64列出了渲染动作字典中的条目。
TABLE 8.64 Additional entries specific to a rendition action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于渲染动作，必须是Rendition。
R	dictionary	(当OP值为0或4时必须;否则可选) 一个渲染对象(参见第9.1.2节“Renditions”)。
AN	dictionary	(如果OP值为0、1、2、3或4，则必须;否则可选) 间接引用屏幕注释(参见第639页的“Screen Annotations”)。
OP	integer	(如果JS不存在，则必须;否则可选) 当动作被触发时执行的操作(operation)。有效值:
0  如果没有与AN指定的注释关联的渲染，则播放R指定的渲染，并将其与注释关联。如果一个渲染已经与该注释相关联，则停止该渲染，并将新的渲染与该注释相关联。
1  停止与AN指定的注释关联的任何播放中的渲染，并删除关联。如果没有播放渲染，就没有效果。
2  暂停与AN指定的注释关联的任何播放中的渲染。如果没有播放渲染，就没有效果。
3  恢复与AN指定的注释关联的任何播放的渲染。如果没有播放渲染或渲染没有暂停，则没有效果。
4  播放R指定的渲染，并将其与AN指定的注释相关联。如果渲染已经与注释相关联，如果它暂停则恢复渲染;否则,什么都不做。
JS	text string 
or stream	(如果OP不存在，则必须;否则可选) 一个文本字符串或流包含动作被触发时要执行的JavaScript脚本。

JS条目或者OP条目必须存在。如果两者都存在，如果查看器应用程序无法执行javascript时，则OP是执行的备用方案。如果OP有一个无法识别的值，并且没有JS条目，则动作无效。
在某些情况下，暂停(OP值为2)或恢复(OP值为3)操作可能没有意义(例如，对于JPEG图像)或播放器可能不支持它。在这种情况下，应该在执行操作失败时通知用户。
在执行一个渲染动作之前，查看器应用程序必须确保屏幕注释字典的P条目引用了一个有效的页面对象，并且注释存在于页面对象的Annots数组中(参见表3.27)。
即使注释本身不可见，也可以在屏幕注释占据的矩形中播放渲染;例如，如果设置了它的Hidden或NoView标志(参见表8.16)。如果屏幕注释不可见，因为查看器没有显示它在页面上的位置，渲染则不可见。但是，如果视图发生变化，例如通过滚动，它可能会变为可见。
Transition Actions
一个转换动作(pdf1.5)可以用于控制一系列动作的绘制。如8.5.1“Action Dictionaries”节所述，动作字典中的Next条目可以指定一系列动作。查看器应用程序通常应该在这样的序列开始时暂停绘制，并在结束时恢复绘制。如果在一个序列中出现了一个转换动作作，查看器应该在完成前一个操作之后，呈现页面视图区域的状态，并使用动作字典中指定的转换来显示它(参见表8. 65)。一旦这个转换完成，绘制应该再次暂停。
TABLE 8.65 Additional entries specific to a transition action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于转换动作，必须是Trans。
Trans	dictionary	(必选) 用于更新显示的转换字典(见表8.13)。
Go-To-3D-View Actions
转到3D视图动作(PDF 1.6)标识3D注释并指定注释使用的视图(参见第9.5节“3D Artwork”)。表8.66显示了转到3d视图动作字典中的条目。
TABLE 8.66 Additional entries specific to a go-to-3D-view action
KEY	TYPE	VALUE
S	name	(必选) 本词典描述的动作类型; 对于转到3D视图动作，必须是GoTo3DView。
TA	dictionary	(必选) 要设置视图的目标注释(target annotation)。
V	(various)	(必选) 要使用的视图(view)。它可以是以下类型之一:
?一个3D视图字典(参见第9.5.3节“3D Views”)。
?一个整数，指定到3D流中的VA数组的索引(参见表9.35)。
?一个文本字符串，匹配VA数组中一个视图的IN条目(参见表
?9.39)。
?一个名称，指示VA数组中第一个(F)、最后一个(L)、下一个(N)、前一个(P)或默认(D)条目;请参阅下面的讨论。
V条目选择视图应用于TA指定的注释。这个视图可能是由3D流的VA条目指定的预定义视图之一(见表9.35)或这里指定的唯一视图。
如果预定义视图由名称N(下一个)或P(上一个)指定，它应该这样解释:
?当应用的最后一个视图通过VA数组指定时，N和P分别表示VA数组中的下一个和上一个条目(如有必要则换行)。
?当最后一个视图没有通过VA指定时，使用N或P应该会导致返回到默认视图。
8.6 Interactive Forms
交互式表单(interactive form, PDF 1.2)有时被称为AcroForm，它是一组域(fields)的集合，用于交互式地从用户那里收集信息。PDF文档可以包含出现在任何页面组合上的任意数量的域，所有这些域组成一个单一的、跨越整个文档的全局交互表单。这些域的任意子集可以从文档中导入或导出;参见8.6.4节“Form Actions”。
注意:交互式表单不应与格式XObjects混淆(参见第4.9节“Form XObjects”)。尽管名称相似，但这两者是不同的、不相关的对象类型。
文档的交互表单中的每个域都由域字典(field dictionary)定义(参见第8.6.2节 “Field Dictionaries”)。出于定义和命名的目的，域可以分层组织，并且可以从域层次结构中的祖先继承属性。层次结构中的域的子域还可以包含窗体注释(参见第640页的“Widget Annotations”)，这些窗体注释定义了域在页面上的外观。子域是窗体注释的域称为终端域(terminal field)。
为了方便起见，当域只有一个关联的窗体注释时，域字典和窗体注释字典(章节8.4.1，注释字典)的内容可以合并到一个字典，同时包含属于字段和窗体注释的条目。(这没有歧义，因为这两种字典的内容并不冲突。)如果这样的对象定义了外观流，外观必须与作为域的对象的当前值一致。
注意:包含内容未知的文本的域可能需要动态构造它们的外观流，而不是在外观字典中静态定义它们;参见677页的“Variable Text”。
8.6.1 Interactive Form Dictionary
文档交互表单的内容和属性是由一个交互表单字典(interactive form dictionary)定义的，这个字典由文档目录(参见3.6.1节“Document Catalog”)中的AcroForm条目引用。表8.67显示了本字典的内容。
TABLE 8.67 Entries in the interactive form dictionary
KEY	TYPE	VALUE
Fields	array	(必选) 文档根域(root fields)的引用数组(在域层次结构中，这些域没有祖先)。
NeedAppearances	boolean	(可选) 一个标志，指定是否为文档中所有窗体注释构造外观流和外观字典(参见第677页的“Variable Text”)。默认值:false。
SigFlags	integer	(可选;PDF1.3) 一个标志集，指定与签名域相关的各种文档级特征(参见下面的表8.68和第695页的“Signature Fields”)。默认值:0。
CO	array	(如果文档中的任何域有包含C条目的附加动作字典，则需要;PDF1.3,calculation order) 一个具有计算动作的域字典的间接引用数组，定义了当任何域的值改变时，它们的值将被重新计算的顺序(参见8.5.2节“Trigger Events”)。
DR	dictionary	(可选,default resources) 一个资源字典(见3.7.2节“Resource Dictionaries”)，包含表单域外观流使用的默认资源(如字体、图案或颜色空间)。这个字典至少必须包含一个字体(Font)条目，用于指定显示文本的默认字体的资源名称和字体字典。(见附录H.执行说明113和114)
DA	string	(可选default appearance) 可变文本域(参见第677页的“Variable Text”)的DA属性在文档范围内的默认值。
Q	integer	(可选)可变文本域的Q属性在文档范围内的默认值(参见第677页的“Variable Text”)。
XFA	stream or array	(可选;PDF1.5) 包含XFA资源的流或数组，其格式由Data Package (XDP) Specification描述。(见参考文献)。
这个条目的值必须是一个表示XML数据包全部内容的流，或者是一个文本字符串和流对的数组，表示组成XML数据包的各个数据包。
有关更多信息，请参阅8.6.7节“XFA Forms”。
注意:在PDF 1.5规范的原始版本中，该条目的值仅定义为流;见附录H中的实现说明115。

交互式表单字典的SigFlags条目的值是一个无符号32位整数，其中包含指定与签名域相关的各种文档级特征的标志(请参阅第695页的“Signature Fields”)。标志字内的位从1(低阶)编号到32(高阶)。表8.68给出了标志的含义;所有未定义的标志位都被保留，并且必须设置为0。
TABLE 8.68 Signature flags
BIT POSITION	NAME	MEANING
1	SignaturesExist	设置后，该文档至少包含一个签名域。该标志允许查看器应用程序启用与签名处理相关的用户界面项(如菜单项或按钮)，而不必扫描整个文档以查看签名域的存在。
2	AppendOnly	如果设置了，则文档包含的签名可能会失效，如果文件以改变先前内容的方式保存(写入)，而不是增量更新。仅仅通过在前一个版本的末尾添加新信息来更新文件是安全的(参见章节G.6， “Updating Example”)。查看器应用程序可以使用此标志向请求完整保存的用户显示一个附加警告框，警告签名将失效，并在继续操作之前需要显式确认。
8.6.2 Field Dictionaries域字典
文档交互表单中的每个域由域字典(field dictionary)定义，该域字典必须是一个间接对象。域字典可以按层次结构组织成一个或多个树结构。许多域属性是可继承的(inheritable)，这意味着如果没有为给定域显式地指定它们，它们的值将取自域层次结构中其父域的值。这样的可继承属性在下面的表中指定。 (Required; inheritable)指定意味着必须为每个域定义属性，无论是在其自己的域字典中显式定义，还是通过从层次结构中的祖先继承。表8.69显示了所有域字典通用的条目，无论是什么类型。只属于特定类型域的条目将在下面的相关部分中进行描述。
TABLE 8.69 Entries common to all field dictionaries
KEY	TYPE	VALUE
FT	name	(终端域Required;inheritable) 这个字典描述的域类型(field type):
Btn        按钮(参见第685页的“Button Fields”)
Tx         文本(见第691页的“Text Fields”)
Ch         选择(见第693页的 “Choice Fields””)
Sig         (PDF 1.3)签名(见第695页的“Signature Fields”)
注意:这个条目可以出现在一个非终止域中(它的后代是域)，以提供一个可继承的FT值。然而，非终止域在逻辑上没有自己的类型;它只是一个可继承属性的容器，用于任何类型的后代终端域。
Parent	dictionary	(在层次结构中，如果此域是另一个域的子域，则Required; 否则不存在) 此域是当前域的直接父(如果有的话，它的Kids数组包含这个域)。一个域最多可以有一个父域(parent); 也就是说，它最多可以包含在其他一个域的Kids数组中。
Kids	array	(有时需要，如下所述) 对该域的直接子域的间接引用数组。
在非终端域中，需要使用Kids数组来引用该域的直接后代域字典。在终端域中，Kids数组通常必须引用与该域相关的一个或多个单独的窗体注释。但是，如果只有一个相关的窗体注释，并且它的内容已经合并到域字典中，则必须省略Kids。
T	text string	(可选，title) 部分域名称(参见下面的“Field Names”;另见附录H的实现说明116和117)。
TU	text string	(可选;PDF1.3) 当域必须在用户界面中标识时(例如在引用该域的错误或状态消息中)，使用替代域名称来代替实际域名称。当为了支持残疾用户的可访问性或其他目的而提取文档内容时，此文本也很有用(参见第10.8.2节，“Alternate Descriptions”)。TU=Text Use
TM	text string	(可选;PDF1.3) 从文档导出交互式表单域数据时使用的映射名称(mapping name)。
Ff	integer	(Optional; inheritable) 指定域的各种特征的标志集(flags见表8.70)。默认值:0。
V	(various)	(Optional; inheritable) 域的值(value)，其格式取决于域的类型。有关进一步信息，请参阅各个域类型的说明。
DV	(various)	(Optional; inheritable) 当执行reset-form动作时(参见第707页的reset-form Actions)，域恢复到的默认值( default value)。该值的格式与V相同。
AA	dictionary	(可选;PDF1.2) 一个附加动作字典(additional-actions)，定义域的行为以响应各种触发事件(参见8.5.2节，“Trigger Events”)。这个条目与注释字典中的AA条目的含义完全相同(参见第8.4.1节“Annotation Dictionaries”)。
域字典的Ff条目的值是一个无符号32位整数，包含指定域各种特征的标志。标志字内的位位置从1(低序)到32(高序)编号。表8.70所示的标志对所有类型的字段都是通用的。仅应用于特定字段类型的标志将在描述这些类型的部分中讨论。所有未定义的标志位都是保留的，必须设置为0。
TABLE 8.70 Field flags common to all field types
BIT POSITION	NAME	MEANING
1	ReadOnly	如果设置了，则用户不能更改域的值。任何相关的窗体注释都不会与用户交互;也就是说，它们不会响应鼠标点击或响应鼠标移动而改变外观。这个标志对于从数据库计算或导入值的域很有用。
2	Required	如果设置了，该域必须在提交表单动作导出时有一个值(参见第703页的“Submit-Form Actions”)。
3	NoExport	如果设置了，该字段不能通过提交表单动作导出(参见第703页的“Submit-Form Actionss”)。
Field Names域名称
域字典中的T条目(参见第675页的表8.69)包含一个定义域的部分域名称(partial field name)的文本字符串。完全限定域名称(fully qualified field name)没有显式定义，而是由域的部分域名称和其所有祖先构造。对于没有父级的域，部分限定名称和完全限定名称是相同的。对于作为另一个域的子域，完全限定名是通过将子域的部分名称附加到父域的完全限定名，用句点(.)分隔:
parent`s_full_name.child`s_partial_name
例如，如果一个具有部分域名称PersonalData的域有一个部分名称为Address的子域，而Address又有一个部分名称为ZipCode的子域，那么最后一个域的完全限定名为
PersonalData.Address.ZipCode
因此，来自一个共同祖先的所有域共享该祖先的全限定域名，作为它们自己的全限定名的公共前缀。
不同的域字典具有相同的完全限定字段名是可能的，如果它们是一个共同祖先的子节点并且没有他们自己的部分域名(T条目)。这样的域字典是相同基础域的不同表示;它们应该只在指定其视觉外观的属性上有所不同。特别是，具有相同全限定域名的域字典必须具有相同的字段类型(FT)、值(V)和默认值(DV)。
Variable Text
如果预先知道域的内容和属性，则可以通过PDF文件中定义的外观流来指定其可视化外观(参见第8.4.4节，“Appearance Streams”和640页的“Widget Annotations”)。然而，在某些情况下，域可能包含直到查看时才知道其值的文本。例如包括用户从键盘输入的文本填充的文本域，以及在显示文档时以交互方式确定内容的可滚动列表框。
在这种情况下，PDF文档不能提供静态定义的外观流来显示域。相反，查看器应用程序必须在查看时动态构造一个外观流。表8.71所示的字典条目提供了关于域外观的一般信息，可以将这些信息与域包含的特定文本结合起来，以构建外观流。
TABLE 8.71 Additional entries common to all fields containing variable text
KEY	TYPE	VALUE
DA	string	(Required; inheritable) 默认外观字符串(default appearance)，包含一系列有效的页面内容图形或文本状态操作符，这些操作符定义域的文本大小和颜色等属性。
Q	integer	(Optional; inheritable) 一个代码指定用于显示文本的空铅排版(quadding,调整justification)格式:
 0    Left-justified
 1    Centered
 2    Right-justified
默认值：0 (left-justified)
DS	text string	(可选;PDF1.5) 一个默认样式(default style)字符串，在第680页的“Rich Text Strings”中描述。
RV	text string or 
text stream	(可选;PDF1.5) 一个富文本字符串，在下节的“Rich Text Strings”中描述的。Rich Variable

新的外观流成为与域的窗体注释相关联的外观字典中的正常外观(N)(参见第614页的表8.19)。(如果窗体注释没有外观字典，查看器应用程序必须创建一个并将其存储在注释字典的AP条目中。)
在PDF 1.5中，设置了RichText标志(见表8.77)的表单域指定680页“Rich Text Strings”描述的格式信息。对于这些域，不使用下面描述的约定，并且在每次值更改时重新生成整个注释外观。
对于非富文本域，外观流――和所有外观流一样，它是一个form xobject――其form字典的内容初始化如下:
?资源字典(Resources)使用来自交互表单字典的DR条目的资源创建(参见表8.67);参见执行说明附录H第118条。
?边界框(BBox)的左下角被设置为form坐标系统中的坐标(0,0)。边界框的右上角坐标取自注释矩形的尺寸(窗体注释字典中的Rect条目)。
?外观流的form字典中的所有其他条目都被设置为它们的默认值(参见第4.9节“Form XObjects”)。
外观流包括以下标记内容的部分，它表示绘制文本的流的部分:
Example 8.14
/Tx BMC 					% Begin marked content with tag Tx 
q 						% Save graphics state
…Any required graphics state changes, such as clipping…
BT 				% Begin text object
…Default appearance string (DA)… 
…Text-positioning and text-showing operators to show the variable text…
ET 				% End text object
Q 						% Restore graphics state
EMC 						% End marked content
BMC(开始标记内容)和EMC(结束标记内容)操作符在第10.5节“Marked Content”中讨论。q(保存图形状态)和Q(恢复图形状态)在第4.3.3节“Graphics State Operators”中讨论。BT(开始文本对象)和ET(结束文本对象)在第5.3节“Text Objects”中讨论。示例参见例8.18。
默认外观字符串(DA)包含建立图形状态参数所需的任何图形状态或文本状态操作符，例如文本大小和颜色，用于显示域的可变文本。这个字符串中只能出现文本对象中允许的操作符(见197页的图4.1)。这个字符串至少要包含一个Tf (text font)操作符以及它的两个操作数:font和size。指定的font值必须匹配默认资源字典(引用自交互式表单字典的DR条目;见表8.67)Font条目中的资源名称。size值为0意味着字体将自动调整大小:其大小是根据注释矩形的高度计算的函数。
默认的外观字符串最多包含一个Tm(文本矩阵)操作符。如果存在这个操作符，查看器应用程序应该根据字段值、quadding (Q)属性和它采用的任何布局规则，用它认为合适的定位值替换水平和垂直平移分量。如果默认外观字符串不包含Tm操作符，查看器应该在外观流中插入一个(使用适当的水平和垂直平移分量)，在默认外观字符串之后，并在变量文本的文本定位和文本显示操作符之前。
要更新现有的外观流以反映新的字段值，查看器应用程序应该首先从文档的DR字典(见表8.67)中复制任何需要的资源到流的资源(Resources)字典中。(如果DR字典和Resources字典中存在同名的资源，则Resources字典中已存在的资源应保持不变，不能替换为DR字典中对应的值)。然后，查看器应用程序应该用相应的新内容替换/Tx BMC到匹配EMC的外观流中的现有内容，如示例8.14所示。(如果现有的外观流不包含标记为Tx的内容，则新内容应该添加到原始流的末尾。)参见附录H中的实现说明119。
Rich Text Strings
从PDF 1.5开始，可变文本表单域的文本内容以及标记注释可以包含格式化(style)信息。这些富文本字符串(rich text strings)是完全形式的XML文档，符合XML表单架构(XML Forms Architecture，XFA)规范指定的富文本约定,这本身就是XHTML 1.0规范的一个子集,增强与限制的CSS2样式属性(详见参考文献引用这些标准)。
表8.72列出了可以出现在富文本字符串中的XHTML元素。<body>元素是根元素;其必需的属性列于表8.73。其他元素(<p>和<span>)包含可能带有样式属性(如表8.74所示)的封闭文本。这些样式属性是name:value形式的CSS内联样式属性声明，每个声明用分号(;)分隔，如684页的示例8.15所示。
在PDF 1.6中，PDF支持XML表单结构规范2.2(XFA, XML Forms Architecture (XFA) Specification 2.2,参见参考书目)中指定的富文本元素和属性。这些富文本元素和属性是表8.72、表8.73和表8.74中描述的元素和属性的超集。在PDF 1.7中，PDF支持“XML Forms Architecture (XFA) Specification, 2.4 (see Bibliography)”中指定的富文本元素和属性。XFA 2.2和XFA 2.4描述了相同的富文本元素和属性;然而，XFA 2.4扩展了所支持的字符编码的范围。
TABLE 8.72 XHTML elements used in rich text strings
ELEMENT	DESCRIPTION
<body>	XML文档根的元素。表8.73列出了此元素所需的属性。
<p>	包含被解释为段落的文本。它可以采用表8.74中列出的样式属性。
<i>	包含以斜体显示的文本。
<b>	包含以粗体显示的文本。
<span>	将文本分组仅仅是为了应用样式(使用表8.74中的属性)。

TABLE 8.73 Attributes of the <body> element
ELEMENT	DESCRIPTION
xmlns	富文本字符串中元素的默认名称空间(namespaces)。必须是 xmlns="http://
www.w3.org/1999/xhtml" 
xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0".
xfa:contentType	必须是"text/html"
xfa:APIVersion	一个字符串，标识用于生成富文本字符串的软件。它的形式必须是software_name:software_version，其中
1.Software_name通过名称来标识软件。不能包含空格。
2.Software_version标识软件的版本。它由一系列用小数点分隔的整数组成。每个整数都是一个版本号，最左边的值是主版本号，右边的值是逐渐减小的版本号。在比较字符串时，版本是按顺序比较的。例如5.2小于5.13，因为2小于13;字符串不被视为十进制数。在比较具有不同区段数量的字符串时，区段较少的字符串会隐式地在右侧填充包含0的区段，以使区段数量相等。
xfa:spec	富文本字符串所遵从的XML Forms Architecture (XFA)规范的版本。PDF 1.5支持XFA 2.0; PDF 1.6支持XFA 2.2; 和PDF 1.7支持XFA 2.4。

TABLE 8.74 CSS2 style attributes used in rich text strings
ELEMENT	VALUE	DESCRIPTION
text-align	keyword	水平对齐。可能值:left、right、center。
vertical-align	decimal	用来调整封闭文本基线的数量。正值表示上标; 负值表示下标。该值的形式为<decimal number>pt，可选地前面加符号，后面跟着pt。例子: -3pt, 4pt。
font-size	decimal	所封闭文本的字体大小。值的形式<decimal number>pt。
font-style	keyword	指定所封闭文本应使用正常或斜体(斜体)字体显示。可能的值:normal、italic。
font-weight	keyword	所封闭文本的字体粗细。可能的值:normal, bold, 100, 200, 300, 400, 500, 600, 700, 800, 900。
注意：normal相当于400，bold相当于700。
font-family	list	用于显示封闭文本的字体名称或字体名称列表。(如果提供了一个列表，则使用第一个包含指定文本的字形的名字。)
font	list	一个简写CSS字体属性的形式：
font:<font-style> <font-weight> <font-size> <font-family>
color	RGB value	所封闭文本的颜色。它可以有两种形式:
? #rrggbb 每个分量具有2位16进制值。
? rgb(rrr,ggg,bbb) 每个分量具有一个10进制值。
注意:虽然color属性指定的值被解释为sRGB值，但当用于生成注释的外观时，它们被转换为non-ICC based颜色空间中的值。
text-decoration	keyword	以下关键词之一:
? underline: 所附文本应加下划线。
? line-through: 所附文本应该有一条贯穿它的线。
font-stretch	keyword	指定字体族中的正常、压缩或扩展字型。从最窄到最宽的支持值是 ultra-condensed, extra-condensed, condensed, semi-condensed, normal, semi-expanded, expanded, extraexpanded, 和ultra-expanded.

富文本字符串由可变文本表单域字典的RV条目(见表8.71)和标记注释字典的RC条目指定(见表8.21)。富文本字符串可以打包为文本流(参见章节3.8.2“Text Streams”)。使用富文本流的表单域也应该设置RichText标志(见表8.77)。
默认的样式字符串(default style string)由自由文本注释(见表8.25)或可变文本表单域(见表8.71)的DS条目指定。此字符串指定样式属性的默认值，用于未显式为注释或域指定的任何样式属性。表8.74中列出的所有属性在默认样式字符串中都是合法的。这个字符串，除了RV或RC条目之外，还用于生成外观。遵循PDF 1.5的查看器会忽略以下条目:注释的Contents条目，自由文本注释的DA条目，表单域的V、DA和Q条目。
注意:除了自由文本注释之外的标记注释(参见第616页的“Markup Annotations”)不使用默认的样式字符串，因为它们的外观是通过平台控件实现的，这些控件要求查看器应用程序选择合适的系统字体来显示。
当表单域或注释包含富文本字符串时，还应该保留字符串的平文本(字符数据，在表单域的V条目和注释的Contents条目中)。这使得旧的查看器应用程序能够读取和编辑数据(尽管会丢失格式化信息)。当文件被保存时，DA条目也应该被写入。
如果在不支持PDF 1.5的查看器中编辑了包含富文本字符串的文档，则富文本字符串保持不变(因为查看器不知道它们)，即使相应的普通文本可能已经更改。当支持PDF 1.5的查看器从文档中读取富文本字符串时，它必须使用以下过程检查相应的平文本是否已更改：
1.创建一个新的平文本字符串，其中包含来自富文本字符串的字符数据。字符引用(例如&#13;)应该转换为它们的等价字符。
注意:不应试图保留标记元素指定的格式。例如，尽管<p>元素意味着新行，但不应该在相关的平文本中生成回车。
2.如果其中一个值使用UTF-16编码，必要时将其它值提升为UTF-16。
3.比较结果字符串。
如果字符串不相等，则假定该字段已被较老的查看器修改，应该从平面文本创建一个新的富文本字符串。
当一个富文本字符串指定字体属性时，查看器应用程序应该使用CSS2规范第15.3节中描述的字体名称选择(参见参考书目)。强烈建议优先考虑默认资源字典中的字体，如表8.67中的DR条目所指定;见附录H中的实施说明120。
下面的示例演示了窗体注释字典中用于富文本的条目。DS条目指定默认字体。RV条目包含两段富文本:第一段指定默认字体的粗体和斜体文本;第二段改变字体大小。
Example 8.15
/DS (font: 18pt Arial) 			% Default style string using an abbreviated font
% descriptor to specify 18pt text using an Arial font
/RV (<?xml version="1.0"?><body xmlns="http://www.w3.org/1999/xtml"
xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0/" 
xfa:contentType="text/html" xfa:APIVersion="Acrobat:8.0.0" xfa:spec="2.4">
<p style="text-align:left">
<b>
<i>
Here is some bold italic text
</i>
</b>
</p>
<p style= "font-size:16pt">
This text uses default text state parameters but changes the font size to 16.
</p>
</body> )
8.6.3 Field Types
交互式表单支持以下域类型:
? Button fields 表示屏幕上用户可以用鼠标操作的交互式控件。它们包括按钮(pushbuttons)、复选框(check boxes)和单选按钮(radio buttons)。
? Text fields 文本域是用户可以从键盘输入文本的框或空间(spaces)。
? Choice fields 选择域包含多个文本项，最多可以选择其中一个作为域值。它们包括可滚动的列表框(list boxes)和组合框(combo boxes)。
? Signature fields 签名域表示用于验证用户身份和文档内容有效性的电子签名。
下面的部分将详细描述这些域类型。未来可能会添加更多类型。
Button Fields
按钮域(button field，域类型Btn)表示用户可以用鼠标操作的屏幕上的交互式控件。有三种类型的按钮域:
?一个按钮(pushbutton)是一个纯粹的交互控件，立即响应用户的输入，而不保留一个永久的值(参见第686页的“Pushbuttons”)。
?一个复选框(check box)在开和关两种状态之间切换(参见686页中的“Check Boxes”)。
?单选按钮域(Radio button fields)包含一组相关的按钮，每个按钮都可以打开或关闭。通常情况下，一组单选按钮中最多有一个在任何给定时间都可能是打开的，选择其中任何一个按钮都会自动取消选择其他所有按钮。(这个规则也有例外，详见第688页的“Radio Buttons”。)
不同类型的按钮域由Ff条目中的标志来区分，如表8.75所示。
TABLE 8.75 Field flags specific to button fields
BIT POSITION	NAME	MEANING
15	NoToggleToOff	(仅单选按钮) 如果设置，则必须始终选中一个单选按钮; 点击当前选中的按钮没有效果。如果清除，则单击选中按钮取消选中，不选中任何按钮。
16	Radio	如果设置，则该域是一组单选按钮;如果清除，则该域是一个复选框。只有当Pushbutton标志为清除时，此标志才有意义。
17	Pushbutton	如果设置，则该域是一个不保留永久值的按钮。
26	RadiosInUnison	(PDF1.5) 如果设置了，单选按钮域中的一组单选按钮将使用相同的状态值，同时打开和关闭;也就是说，如果一个被选中，所有的都被选中。如果清除，则按钮是互斥的(行为与HTML单选按钮相同)。
Pushbuttons
最简单的域类型是按钮域(pushbutton field)，它的域类型为Btn，并设置了pushbutton标志(见表8 - 75)。因为这种类型的按钮没有保留永久值，所以它不使用域字典中的V和DV条目(参见第675页的表8.69)。
Check Boxes
一个复选框域(check box field)表示一个或多个复选框，当用户用鼠标或键盘操作时，它们可以在打开和关闭两种状态之间切换。它的域类型是Btn，按钮和单选按钮的标志(见表8 - 75)都被清除。每个状态都可以有一个单独的外观，由域的窗体注释的外观字典中的外观流定义(参见8.4.4节“Appearance Streams”)。off状态的外观是可选的，如果存在，则必须存储在外观字典中的Off名称中。建议(但不是必需的)开启状态的名称是Yes。
域字典中的V条目(参见第675页的表8.69)保存了一个表示复选框外观状态的名称对象，用于从外观字典中选择合适的外观。
例8.16显示了典型的复选框定义。
Example 8.16
1 0 obj
<< /FT /Btn
 	/T (Urgent)
 	/V /Yes
 	/AS /Yes
 	/AP << /N << /Yes 2 0 R /Off 3 0 R>>
>>
endobj
2 0 obj
<< /Resources 20 0 R
 	/Length 104
>>
stream
q
0 0 1 rg
BT
/ZaDb 12 Tf
0 0 Td
(8) Tj
ET
Q
endstream
endobj
3 0 obj
<< /Resources 20 0 R
 		/Length 104
>>
stream
q
0 0 1 rg
BT
/ZaDb 12 Tf
0 0 Td
(8) Tj
ET
Q
endstream
endobj
从PDF 1.4开始，复选框和单选按钮的域字典包含一个可选的Opt条目(参见表8.76)，其中包含一个文本字符串数组，表示域中每个注释的导出值。它的用途如下:
?在非拉丁书写系统中表示复选框和单选按钮域的导出值。因为外观字典中的名称对象仅限于PDFDocEncoding，所以它们不能表示非拉丁文本。
?允许独立选中单选按钮或复选框，即使它们具有相同的导出值。
一个例子是在多个页面上重复的一组复选框，期望的行为是当用户选中一个复选框时，也选中其他每个页面上对应的复选框。在本例中，每个对应的复选框都是复选框域的Kids数组中的一个窗体。
注意:对于单选按钮，只有设置了RadiosInUnison标志，才会发生相同的行为。如果没有设置，一个字段中每次最多只能设置一个单选按钮。参见附录H实现说明121。
TABLE 8.76 Additional entry specific to check box and radio button fields
KEY	TYPE	VALUE
Opt	array of 
text strings	(可选;可继承的;PDF1.4) 一个数组，为单选按钮或复选框字段的Kids数组中的每个窗体注释包含一个条目。每个条目都是一个文本字符串，表示对应窗体注释的打开状态。
当这个条目出现时，用于表示每个注释的AP字典中的打开状态的名称是计算机生成的数字，相当于该注释在Kids数组中的数值位置(从0开始)。这允许区分注释，即使其中两个或多个注释在Opt数组中具有相同的值。例如，两个单选按钮可能具有相同的打开状态，但如果RadiosInUnison标志未设置，则用户一次只能选中其中一个按钮。
Radio Buttons
单选按钮域是一组相关的按钮。与复选框一样，单选按钮也有两种状态，开和关。单个单选按钮不能直接关闭，只能通过打开另一个按钮来关闭。通常，一组单选按钮(单个单选按钮字段的子注释)在任何给定时间最多有一个按钮处于on状态;选择任意一个按钮将自动取消选择其他所有按钮。
注意:当一个域中的多个单选按钮具有相同的打开状态并且设置了RadiosInUnison标志时，一个例外会发生。在这种情况下，打开其中一个按钮就会打开所有按钮。
字段类型为Btn, Pushbutton标志(参见第686页的表8.75)被清0，Radio标志被设置。这种类型的按钮域有一个附加标志NoToggleToOff，它指定(如果设置了)在任何时候都必须选择其中一个单选按钮。在这种情况下，单击当前选中的按钮没有效果;如果NoToggleToOff标志被清0，单击选中的按钮将取消选中它，不选中任何按钮。
单选按钮域的域字典(见表8.69)中的Kids条目保存了一个窗体注释数组，表示集合中的各个按钮。父字段的V条目保存了一个名称对象，对应于当前处于打开状态的子域的外观状态;该条目的默认值是Off。示例8.17是一组单选按钮的对象定义。
Example 8.17
10 0 obj 				% Radio button field
<< /FT /Btn
 /Ff … 			% …Radio flag = 1, Pushbutton = 0…
 /T (Credit card)
 /V /MasterCard
 /Kids [ 11 0 R
 		 12 0 R
]
>>
endobj
11 0 obj 			% First radio button
<< /Parent 10 0 R
 	/AS /MasterCard
 	/AP << /N << /MasterCard 8 0 R
 					/Off 9 0 R
>>
>>
>>
endobj
12 0 obj 			% Second radio button
<< /Parent 10 0 R
 	/AS /Off
 	/AP << /N << /Visa 8 0 R
 					/Off 9 0 R
>>
>>
>>
endobj
8 0 obj 			% Appearance stream for "on" state
<< /Resources 20 0 R
 	/Length 104
>>
stream
q
0 0 1 rg
BT
/ZaDb 12 Tf
0 0 Td
(8) Tj
ET
Q
endstream
endobj
9 0 obj 		% Appearance stream for "off" state
<< /Resources 20 0 R
 	/Length 104
>>
stream
q
0 0 1 rg
BT
/ZaDb 12 Tf
0 0 Td
(4) Tj
ET
Q
endstream
endobj
与复选框域一样，单选按钮域可以使用域字典(PDF 1.4)中的Opt条目为其组成的单选按钮定义导出值，对非拉丁字符使用Unicode编码(见表8.76)。Opt保存了一个文本字符串数组，该数组对应 表示域的Kids数组中各个按钮的窗体注释。
Text Fields
文本域(域类型Tx)是一个框或空格，用户可以在其中从键盘输入文本。文本可以被限制为单行，也可以允许跨越多行，这取决于域字典的Ff条目中的多行(Multiline)标志的设置。表8.77显示了与这种类型域相关的标志。
TABLE 8.77 Field flags specific to text fields
BIT POSITION	NAME	MEANING
13	Multiline	如果设置，域可以包含多行文本;如果清0，则域文本被限制为单行。
14	Password	如果设置，则该域用于输入一个不应在屏幕上显示的安全密码。用键盘输入的字符应该以某种不可读的形式出现，例如星号或子弹字符。
为了保护密码机密性，如果设置了此标志，查看器应用程序不应该在PDF文件中存储文本字段的值。
21	FileSelect	(PDF 1.4) 如果设置，在域中输入的文本表示文件的路径名，其内容将作为域的值提交。
23	DoNotSpellCheck	(PDF 1.4) 如果设置了，在域中输入的文本不会进行拼写检查。
24	DoNotScroll	(PDF 1.4) 如果设置了，域不会滚动(单行域为水平滚动，多行域为垂直滚动)以容纳超出其注释矩形范围的更多文本。一旦域被填满，就不再接受其他文本。
25	Comb	(PDF 1.5) 只有当MaxLen条目出现在文本域字典中(见表8.78)并且Multiline、Password和FileSelect标志清零。如果设置了该域，则该域将自动划分为与MaxLen值相同的等距位置(或梳)，并且文本将被布局到这些梳中。
26	RichText	如果设置，该域的值应该表示为富文本字符串(参见第680页的“Rich Text Strings”)。如果域有值，则域字典(表8.71)的RV条目指定富文本字符串。

域的文本保存在域字典的V (value)条目中，是一个文本字符串(或者从PDF 1.5开始是一个流)。这个文本字符串或流的内容被用来构造一个显示域的外观流，如第677页“Variable Text”中所述。文本以单一样式(字体、大小、颜色等)显示，由DA(default appearance)字符串指定。
如果设置了FileSelect标志(PDF 1.4)，则该域将用作文件选择控件。在这种情况下，域的文本表示文件的路径名，其内容将作为域的值提交:
?对于以HTML表单格式提交的域，提交使用MIME内容类型multipart/ Form-data，如互联网RFC 2045，多用途互联网邮件扩展(MIME)，第一部分:互联网消息体的格式(见参考书目)所述。
?对于表单数据格式(FDF)提交，FDF字段字典(参见第717页的“FDF Fields”)中的V条目的值是一个标识所选文件的文件规范(第3.10节“File Specifications”)。
?文件选择控件不支持XML格式;因此，在本例中不提交任何值。
除了所有域(见第675页的表8.69)和包含变量文本的域(见表8.71)的常见条目之外，文本域的域字典还可以包含表8.78所示的附加条目。
TABLE 8.78 Additional entry specific to a text field
KEY	TYPE	VALUE
MaxLen	integer	(可选;可继承) 域文本的最大长度，以字符为单位。
例8.18显示了典型文本域的对象定义。
Example 8.18
6 0 obj
<< /FT /Tx
 	/Ff … 		% Set Multiline flag
 	/T (Silly prose)
 	/DA (0 0 1 rg /Ti 12 Tf )
 	/V ( The quick brown fox ate the lazy mouse)
 	/AP << /N 5 0 R >>
>>
endobj
5 0 obj
<< /Resources 21 0 R
 	/Length 172
>>
stream
/Tx BMC
q
BT
0 0 1 rg
/Ti 12 Tf
1 0 0 1 100 100 Tm
0 0 Td
( The quick brown fox ) Tj
0 ?13 Td
(ate the lazy mouse.) Tj
ET
Q 
EMC
endstream
endobj
Choice Fields
一个选择域(choice field，域类型为Ch)包含多个文本项，可以选择其中一个或多个文本项作为域值。这些项可以以两种形式之一呈现给用户:
?一个可滚动的列表框
?一个组合框，由下拉列表，可选地伴随一个编辑文本框组成，用户可以在其中输入预定义选项以外的值。
TABLE 8.79 Field flags specific to choice fields
BIT POSITION	NAME	MEANING
18	Combo	如果设置，该域是一个组合框;如果清0，则该域是一个列表框。
19	Edit	如果设置，组合框包括一个可编辑的文本框和一个下拉列表;如果清零，则只包含一个下拉列表。只有设置了Combo标志，这个标志才有意义。
20	Sort	如果设置，域的选项条目应该按字母顺序排序。此标志供表单创作工具使用，而不是供PDF查看器应用程序使用。查看器应该简单地按照选项在Opt数组中出现的顺序显示选项(参见表8.80)。
22	MultiSelect	(PDF 1.4) 如果设置，可以同时选择多个域的选项; 如果清零，一次只能选择一个项目。
23	DoNotSpellCheck	(PDF 1.4) 如果设置了，在字段中输入的文本不会进行拼写检查。只有同时设置了Combo和Edit标志，这个标志才有意义。
27	CommitOnSelChange	如果设置了，新值将在使用指向设备进行选择时立即提交。该选项允许应用程序在做出选择后执行动作，而不需要用户退出该域。如果清零，则在用户退出该域之后提交新值。

不同类型的选择域通过Ff条目中的标志来区分，如表8.79所示。表8.80显示了特定于选择域的域字典条目。
TABLE 8.80 Additional entries specific to a choice field
KEY	TYPE	VALUE
Opt	array	(可选) 显示给用户的选项数组。数组的每个元素要么是表示一个可用选项的文本字符串，要么是由两个文本字符串组成的数组:选项的导出值和作为选项名称显示的文本(参见附录H中的实现注释122)。
如果此条目不存在，则不应向用户显示任何选项。
TI	integer	(可选) 对于可滚动的列表框，顶部索引(top index，列表中可见的第一个选项的Opt数组中的索引)。默认值:0。
I	array	(有时是必需的，否则是可选的;PDF1.4) 对于允许多选的选择域(设置了MultiSelect标志)，一个整数数组，按升序排序，表示当前选择的选项项的Opt数组中的从零开始的索引。当Opt数组中的两个或多个元素具有不同的名称但具有相同的导出值时，或者选择域的值是一个数组时，需要此项。在其他情况下，该条目是允许的但不是必需的。如果该条目标识的项与域字典V条目标识的项不同(见下文)，则V条目优先。

Opt数组指定选择域中的选项列表，每个选项都由要显示在屏幕上的文本字符串表示。Opt数组的每个元素要么单独包含这个文本字符串，要么包含两个元素的数组，第二个元素是文本字符串，第一个元素是文本字符串，表示从文档导出交互式表单字段数据时使用的导出值。
域字典的V (value)条目(参见675页的表8.69)标识了选择域中当前选择的一个或多个项。如果域不允许多选，即没有设置MultiSelect标志(pdf1.4)，或者支持多选但当前只选中一项，则V是表示选中项名称的文本字符串，在字段字典的Opt数组中给出。如果选中了多个元素，则V是由这些字符串组成的数组。(对于Opt数组中以二元素数组表示的项，name字符串是二元素数组中的第二个。)V的默认值是null，表示当前没有选中任何项。
例8.19显示了一个典型的选择域定义。
Example 8.19
<< /FT /Ch
 /Ff …
 /T (Body Color)
 /V (Blue)
 /Opt [ (Red)
 		(My favorite color)
 		(Blue)
]
>>
Signature Fields
一个签名域(signature field，PDF 1.3)是一个包含数字签名的表单域(参见第8.7节 “Digital Signatures”)。表示签名域的域字典可以包含表8 .81列出的其他条目，以及表8.69描述的标准条目。域类型FT (field type)是Sig，域值V(value)是一个签名字典( signature dictionary)，包含签名并指定签名域的各种属性(见表8.102)。
填写(签名)签名域至少需要更新V条目，通常还需要更新相关窗体注释的AP条目。导出签名域通常导出T、V和AP条目。
与任何其他域一样，签名域实际上可以由一个窗体注释字典描述，该字典包含与一个注释和一个域相关的条目(参见第640页的“Widget Annotations”)。字典中的注释矩形(Rect)给出了域在页面上的位置。不希望可见的签名域应该具有高度和宽度均为零的注释矩形。
签名域的窗体注释的外观字典(AP)定义了该域在页面上的视觉外观(参见8.4.4节“Appearance Streams”)。有关Acrobat如何处理数字签名外观的信息见技术说明Digital Signature Appearances(请参阅参考书目)。
TABLE 8.81 Additional entries specific to a signature field
KEY	TYPE	VALUE
Lock	dictionary	(可选;必须是间接引用;PDF1.5) 一个签名域锁字典(signature field lock dictionary)，指定当签名域被签名时要锁定的一组表单域。表8.82列出了本子典的条目。
SV	dictionary	(可选;必须是间接引用;PDF1.5) 一个种子值字典(seed value dictionary见表8.83)，包含约束应用于此域的签名属性的信息。
域字典中SV条目的值是一个种子值字典，它的条目(参见表8.83)提供了在应用签名时使用的约束信息。它的Ff条目指定字典中的其他条目是否需要被尊重，或者它们是否仅仅是推荐的。
注意:种子值字典可能包括属于多个处理程序的私有条目的种子值。给定的处理程序应该只使用与自己相关的条目，而忽略其他条目。
TABLE 8.82 Entries in a signature field lock dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型; 如果存在，签名域锁字典必须是SigFieldLock。
Action	name	(必选) 一个名称，与Fields一起指示应该被锁定的域集和。有效值:
All   文档中的所有域
Include   “Fields”中指定的所有域
Exclude    除“Fields”中指定的域外的所有域
Fields	array	(当Action的值为Include或Exclude时必须) 包含域名称的文本字符串数组。

TABLE 8.83 Entries in a signature field seed value dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型; 如果存在，种子值字典必须是SV。
Filter	name	(可选) 用于签名域的签名处理程序。从PDF 1.7开始，如果指定了Filter，并且Ff条目表示此条目是必需的约束，那么在签名时必须使用此条目指定的签名处理程序;否则，不能进行签名。如果Ff表示这是一个可选约束，则应该在该处理程序可用的情况下使用。如果它不可用，则可以使用不同的处理程序代替。
SubFilter	array	(可选) 指定签名时使用的编码的名称数组。数组中与签名处理程序支持的编码匹配的第一个名称应该是实际用于签名的编码。如果指定了SubFilter，并且Ff条目表明该项是一个必需的约束，那么签名时必须使用第一个匹配的编码;否则，不能签署。如果Ff表示这是一个可选的约束，那么如果第一个匹配的编码可用，则应该使用它。如果不可用，可以使用不同的编码。
DigestMethod	array	(可选;PDF1.7) 一个名称数组，指示签名时使用的可接受摘要算法。有效值为SHA1、SHA256、SHA384、SHA512和RIPEMD160。默认值是特定于实现的。
注意:此属性仅适用于数字凭据签名包含RSA公钥/私钥。如果包含DSA公钥/私钥，则摘要算法始终为SHA1，该属性将被忽略。
V	real	(可选) 签名域种子值字典解析器所需的最小能力。值1指定解析器必须能够识别PDF 1.5中指定的所有种子值字典条目。值2指定它必须能够识别PDF 1.7及更早版本中指定的所有种子值字典条目。
Ff条目指示这是否是必需的约束。
注意:PDF参考第五版(PDF 1.6)和更早的版本错误地指出V条目是整数类型。这个条目的类型是实数。
Cert	dictionary	(可选) 一个证书种子值字典(见表8.84)，包含签名时要使用的证书的信息。
Reasons	array	(可选) 文本字符串数组，用于指定签署文档的可能原因。如果指定，则此条目中提供的原因将替换查看器应用程序使用的原因。Ff条目指定是否必须在签名中使用数组中的一个原因。
?如果提供了Reasons数组，并且Ff条目指示Reasons是必需的约束，则数组中的一个原因必须用于签名字典;否则，不能进行签名。如果Ff项指示Reasons是可选约束，则可以选择数组中的一个原因，或者提供自定义原因。
?如果Reason数组被省略或包含一个0字符长度的字符串，并且Ff条目表示Reason是必需的约束，则必须从签名字典中忽略Reason条目(见表8.102)。
MDP	dictionary	(可选;PDF1.6) 包含单个条目的字典，其键为P，值为0到3之间的整数。值为0将签名定义为普通(非作者)签名(参见第8.7节“Digital Signatures”)。值1到3用于作者签名，并对应于DocMDP转换参数字典中的P值(参见表8.104)。
如果此条目不存在或不包含P条目，则不定义关于签名类型或其权限的规则。
TimeStamp	dictionary	(可选;PDF1.6) 包含两个条目的时间戳字典:
URL    一个ASCII字符串，指定时间戳服务器的URL，提供符合RFC 3161, Internet X.509 Public Key Infrastructure Time-Stamp rotocol(见参考书目)。
Ff    取值为1(要求签名具有时间戳)或0(不要求签名具有时间戳)的整数。默认值:0。
LegalAttestation	array	(可选;PDF1.6) 一个文本字符串数组，指定可能的合法认证(参见第8.7.4节“Legal Content Attestations”)。Ff条目中相应标志的值表示这是否是必需的约束。
AddRevInfo	boolean	(可选;PDF1.7) 一个标志指示是否应进行撤销检查。如果AddRevInfo为true，查看器应用程序在签名域签名时执行以下附加任务:
?对用于签名的证书(以及相应的颁发证书)执行撤销检查。
?在签名值中包含撤销信息。
只有当SubFilter是adbe.pkcs7.detached或adbe.pkcs7.sha1时，true值才相关。如果SubFilter为x509.Rsa_sha1，该条目必须省略或设置为false;否则，可能导致签名过程失败。
如果AddRevInfo为true，并且Ff条目指示这是必需的约束，则必须执行上述任务。如果不能执行，则签名必须失败。
默认值：false
Ff	integer	(可选) 一组位标志，指定字典中特定条目的解释。标志的值为1表示关联条目是必需的约束。值为0表示关联的条目是可选约束。位位置1 (Filter);2 (SubFilter);3 (V);4(Reasons);5(LegalAttestation);6 (AddRevInfo);和7 (DigestMethod)。默认值:0。

TABLE 8.84 Entries in a certificate seed value dictionary
KEY	TYPE	VALUE
Type	name	(可选) 这个字典描述的PDF对象的类型; 如果存在，证书种子值字典必须是SVCert。
Subject	array	(可选) 一个字节字符串数组，包含可接受签名的DER-encoded X.509v3证书。X.509v3证书在RFC 3280、Internet X.509公钥基础设施、证书和证书吊销列表(CRL)配置文件中有描述(参见参考书目)。Ff条目中对应标志的值表明该约束是否是必需的。
SubjectDN	array of 
dictionaries	(可选;PDF1.7) 一个字典数组，其中每个字典都包含键值对，指定了Subject可分辨名称(Distinguished Name,DN)，该名称必须出现在证书中，才能被签名接受。证书至少必须包含字典中指定的所有属性。也就是说，证书可以包含额外的属性。主题可分辨名称在RFC 3280中有描述(参见参考书目)。键可以是任何合法的属性标识符。属性名通常是` cn `、` o `、` email `、` 2.5.4.43 `的形式，并且总是包含a-z、A-Z、0-9和` . `之间的字符。值是文本字符串。一个字典例子是
<</cn (John Smith) /1.5.4.43 (JS)>>
Ff条目中相应标志的值表示该表项是否是必需的约束。
KeyUsage	array of 
ASCII 
strings	(可选;PDF1.7) 一个ASCII字符串数组，其中每个字符串指定一个可接受的密钥使用扩展名，该扩展名必须出现在签名证书中。多个字符串指定可接受的键使用扩展的范围。key-usage扩展在RFC 3280中有描述(见参考书目)。
字符串中的每个字符表示一个key-usage类型，其中字符的顺序指示它所表示的key-usage扩展。数组中从左到右的第1到9个字符表示以下key-usage扩展的必须值:
1 digitalSignature   4 dataEncipherment  7 cRLSign
2 non-Repudiation   5 keyAgreement    8 encipherOnly
3 keyEncipherment   6 keyCertSign     9 decipherOnly
任何额外的字符将被忽略。任何缺少的字符或不是以下值之一的字符，都应该设置为' X '。支持以下字符值:
0    不能设置相应的key-usage。
1    相应的key-usage必须设置。
X    相应的key-usage状态并不重要。
例如，字符串值' 1 '和' 1XXXXXXXX '表示必须设置键使用类型digitalSignature的设置，并且所有其他键使用类型的状态都不重要。
Ff条目中相应标志的值表示这是否是必需的约束。
Issuer	array	(可选) 一个字节字符串数组，包含可接受发行者的DER-encoded X.509v3证书。如果签名者的证书链接到任何指定的颁发者(issuers，直接或间接)，则认为该证书可被签名。Ff条目中相应标志的值表示这是否是必需的约束。
OID	array	(可选) 一个字节字符串数组，包含签名证书中必须存在的证书策略的对象标识符(Object identifier, OIDs)。这样的字符串的一个例子是(2.16.840.1.113733.1.7.1.1)。只有当Issuer的值不为空时，该字段才适用。证书策略扩展在RFC 3280中有描述(参见参考书目)。Ff项中对应标志的值表明该约束是否是必需的。
URL	ASCII 
string	(可选) 一个URL，它的用途由URLType条目定义。
URLType	Name	(可选;PDF1.7) 一个名称，表示URL条目的用法。这个URL有标准的用途，也有特定于实现的用途。以下值指定了一个有效的标准用法:
Browser -- 应该在web浏览器中显示URL引用的内容，以便在没有找到匹配的证书时注册新证书。Ff属性的URL位在这种用法中被忽略。
以下值指定了一个有效的特定于实现的用法，定义为由Adobe Systems使用:
ASSP -- 该URL引用一个签名web服务器，可用于基于服务器的签名。如果Ff属性的URL位表明这是必需的约束，这意味着签名时使用的证书必须来自此服务器。
第三方可以使用他们自己的属性值扩展该属性的使用，这些属性值必须符合附录E中描述的准则。
默认值为Browser。
Ff	integer	(可选) 一组位标志，用于指定该字典中特定条目的解释。标志的值为1，意味着签名者只需要使用该项的指定值。值为0意味着允许其他值。比特位置为1(Subject);2(Issuer);3 (OID);4 (SubjectDN);5(Reserved);6 (KeyUsage);7 (URL)。
默认值：0.
8.6.4 Form Actions
交互表单除了8.5.3节“Action Types”中描述的动作外，还支持四种特殊类型的动作:
?提交表单动作(Submit-form actions)：将选择的交互表单域的名称和值传送到指定的统一资源定位符(URL)，这可能是将处理它们并发回响应的Web服务器的地址。
?重置表单动作(Reset-form actions)：将选定的交互表单域重置为默认值。
?导入数据动作(Import-data actions)：从指定文件将表单数据格式(FDF)数据导入到文档的交互表单中。
?JavaScript动作(PDF 1.3)：导致JavaScript解释器编译和执行脚本。
Submit-Form Actions
一个提交表单动作将选择的交互式表单字段的名称和值传输到指定的统一资源定位符(URL)，这可能是将处理它们并返回响应的Web服务器的地址。表8-85给出了该类动作对应的动作字典条目。
动作字典的Flags条目的值是一个32位无符号整数，包含指定动作的各种特征的标志。标志字内的位位置从1(低位)到32(高位)编号。表8.86显示了这些标志的含义;所有未定义的标志位都被保留，必须设置为0。
TABLE 8.85 Additional entries specific to a submit-form action
KEY	TYPE	VALUE
S	name	(必选) 本字典描述的动作类型;对于提交表单动作必须SubmitForm。
F	file specification	(必需) 一个URL文件规范(参见第3.10.4节“URL Specifications”)，给出Web服务器上处理提交的脚本的统一资源定位符(URL)。
Fields	array	(可选) 一个数组，根据Flags项中include / exclude标志的设置，标识哪些域要包含在提交中，哪些域要排除(见表8-86)。数组中的每个元素要么是对域字典的间接引用，要么(PDF 1.3)是表示域全限定名称的文本字符串。这两种类型的元素可以混合在同一个数组中。
如果省略此条目，则忽略Include/Exclude标志，并且提交文档交互表单中的所有域，除了设置了NoExport标志的域(参见676页的表8.70)。(没有值的域也可能被排除，这取决于IncludeNoValueFields标志的设置;见表8.86)。进一步讨论请参见表8.86下的文本。
Flags	integer	(可选;可继承) 一组标志，指定动作的各种特征(见表8.86)。默认值:0。

TABLE 8.86 Flags for submit-form actions
BIT POSITION	NAME	MEANING
1	Include/Exclude	如果清0, Fields数组(参见表8.85)指定在提交中包含哪些域。(域层次结构中指定域的所有后代也会被提交。)
如果设置了，Fields数组会告诉要排除哪些域。除了Fields数组中列出的域和设置了NoExport标志(见表8.70)的域外，文档的交互式表单中的所有域都会被提交。
2	IncludeNoValueFields	如果设置了，则提交Fields数组和Include/ Exclude标志指定的所有域，无论它们是否有值(字段字典中有V条目)。对于没有值的域，只传输域名。
如果清0，则不提交无值的域。
3	ExportFormat	只有SubmitPDF和XFDF标志为0才有意义。
如果设置了，则以HTML表单格式提交域名称和值。
如果清0，则以表单数据格式(FDF)提交;参见8.6.6节“Forms Data Format”。
4	GetMethod	如果设置了，则使用HTTP GET请求提交域名称和值。
如果清0，则使用POST请求提交。只有当设置了ExportFormat标志时，此标志才有意义;如果ExportFormat为0，则此标志也必须为0。
5	SubmitCoordinates	如果设置，导致提交表单动作的鼠标单击的坐标将作为表单数据的一部分传输。坐标值相对于域的窗体注释矩形的左上角。它们用以下形式表示在数据中 
name.x=xval&name.y=yval
其中name是域的映射名称(域字典中的TM)，如果存在的话;否则，name为域名。如果TM条目的值是一个空格字符，则名称和后面的点都将被抑制，从而产生这种格式 
x=xval&y=yval
只有设置了ExportFormat标志，该标志才有意义。如果ExportFormat是0，该标志也必须是0。

6	XFDF	(PDF 1.4) 只有在SubmitPDF标志清0时才有意义。
如果设置了，域名称和值将作为XFDF提交。
7	IncludeAppendSaves	(PDF 1.4) 只有在表单以表单数据格式提交时才有意义(也就是说，XFDF和ExportFormat标志都为0)。
如果设置了，提交的FDF文件包括基础PDF文档的所有增量更新的内容，包含在FDF字典的Differences条目中(参见表8.93的第714页)。
如果清0，则不包括增量更新。
8	IncludeAnnotations	(PDF 1.4) 只有在表单以表单数据格式提交时才有意义(也就是说，XFDF和ExportFormat标志都为0)。
如果设置了，则提交的FDF文件包含基础PDF文档中的所有标记注释(请参见第616页的“Markup Annotations”)。
如果清0，则不包含标记注释。
9	SubmitPDF	(PDF 1.4) 如果设置，该文档以PDF的形式提交，使用application/ PDF MIME内容类型(描述于互联网RFC 2045，多用途互联网邮件扩展(MIME)，第一部分:互联网消息体的格式;参考书目)。
如果设置了，除了GetMethod，所有其他标志都会被忽略。
10	CanonicalFormat	(PDF 1.4) 如果设置了，任何提交的表示日期的域值都会转换为3.8.3节“Dates”中描述的标准格式。(将表单域解释为日期并不是在字段本身明确指定的，而是在处理它的JavaScript代码中指定的。)
11	ExclNonUserAnnots	(PDF 1.4) 只有当表单以表单数据格式提交(即XFDF和ExportFormat标志为0)，并且设置了IncludeAnnotations标志时才有意义。
如果设置了，它只包含那些T条目(见表8 - 21)与当前用户名匹配的标记注释，由表单提交到的远程服务器确定。(标记注释的T条目指定要在注释弹出窗口的标题栏中显示的文本标签，并假定表示编写注释的用户的名称。) 这允许多个用户协作注释单个远程PDF文档，而不会影响彼此的注释。
12	ExclFKey	(PDF 1.4) 只有在表单以表单数据格式提交时才有意义(也就是说，XFDF和ExportFormat标志都为0)。
如果设置了，则提交的FDF将排除F条目。
14	EmbedForm	(PDF 1.5) 只有在表单以表单数据格式提交时才有意义(也就是说，XFDF和ExportFormat标志都为0)。
如果设置，则提交的FDF的F条目是一个文件规范，其中包含一个嵌入式文件流，表示提交FDF的PDF文件。

要提交名称和值的域集合由动作字典中的Fields数组(表8 - 85)以及Flags条目中的Include/Exclude和IncludeNoValueFields标志(表8.86)定义。Fields数组的每个元素都标识了一个交互式表单域，可以通过对域字典的间接引用，或者(PDF 1.3)通过其完全限定域名称(请参见第676页的“Field Names”)。如果Include/Exclude标志清0，则提交Fields数组中列出的所有域，以及这些域在域层次结构中的所有后代域。如果设置了Include/Exclude标志，则提交包含文档交互表单中的所有字段，除了Fields数组中列出的域。
注意:域字典的Ff条目中的NoExport标志(参见第675页的表8.69和第676页的表8.70)优先于动作的Fields数组和Include/Exclude标志。设置了NoExport标志的域永远不会包含在提交表单动作中。
域名和值可以以以下任何一种格式提交，这取决于动作的ExportFormat、SubmitPDF和XFDF标志的设置(参见参考书目):
?HTML表单格式(在HTML 4.01规范中描述)
?表单数据格式(FDF)，在8.6.6节“Forms Data Format”中描述;参见附录H中的实现说明123。
?XFDF，基于XML的FDF版本。XFDF在Adobe技术说明XML表单数据格式规范2.0版本中有描述。XML在W3C文档“可扩展标记语言(XML) 1.1”中有描述。
?PDF(在这种情况下，提交的是整个文档，而不是单个域和值)。
为每个域提交的名称是它的完全限定名(参见第676页的“Field Names”)，其值由域字典中的V条目指定。
注意:对于在FDF中提交的按钮域，提交的值是该域的窗体注释字典中的AP条目的值。如果提交表单动作字典不包含Fields条目，则根本不会提交此类按钮域。
没有值的域(即域字典中不包含V条目)通常不包含在提交中。提交表单动作的IncludeNoValueFields标志可以覆盖此行为。如果设置了此标志，则这些无值域在提交中仅包含名称，没有关联值。
Reset-Form Actions
一个重置表单动作重置所选交互表单域为默认值;也就是说，它将域字典中V条目的值设置为DV条目的值(参见第675页的表8.69)。如果一个域没有定义默认值，它的V条目将被删除。对于可以没有值的域(例如按钮)，动作没有效果。表8.87显示了特定于这种类型的动作的动作字典条目。
动作字典的Flags条目的值是一个32位无符号整数，包含指定动作的各种特征的标志。标志字内的位位编号从1(低位)到32(高位)。在发布时，这种类型的动作只定义了一个标志位;表8.88显示了它的含义。所有未定义的标志位都被保留，必须设置为0。
TABLE 8.87 Additional entries specific to a reset-form action
KEY	TYPE	VALUE
S	name	(必选) 本字典描述的动作类型;对于重置表单动作必须ResetForm。
Fields	array	(可选) 一个数组，标识哪些域需要重置，哪些域不需要重置，这取决于Flags条目中的Include/exclude标志的设置(参见表8.88)。数组的每个元素要么是对域字典的间接引用，要么是表示域的完全限定名的文本字符串(PDF 1.3)。这两种类型的元素可以混合在同一个数组中。
如果省略此条目，则忽略Include/Exclude标志;文档交互表单中的所有域都将重置。
Flags	integer	(可选;可继承) 一组指定动作的各种特征的标志(见表8.88)。默认值:0。

TABLE 8.88 Flag for reset-form actions
BIT POSITION	NAME	MEANING
1	Include/Exclude	如果清0, Fields数组(参见表8.85)指定哪些域要重置。(域层次结构中指定域的所有后代也会被重置。)
如果设置了，Fields数组会告诉要排除重置哪些域。除了Fields数组中列出的域，文档的交互式表单中的所有域都会被重置。
Import-Data Actions
一个导入数据动作将表单数据格式(FDF)数据从指定文件导入到文档的交互表单中(参见第8.6.6节“Forms Data Format”)。表8.89显示了特定于这种类型动作的动作字典条目。
TABLE 8.89 Additional entries specific to an import-data action
KEY	TYPE	VALUE
S	name	(必选) 本字典描述的动作类型;对于导入数据动作必须ImportData。
F	file specification	(可选) 要从中导入数据的FDF文件。(见附录h实施说明124和125)
JavaScript Actions
一个JavaScript动作(PDF 1.3)会导致JavaScript解释器编译并执行脚本。根据脚本的性质，文档中的各种交互表单域可能会更新它们的值或更改它们的视觉外观。网景通信公司的客户端JavaScript参考文件和Adobe JavaScript for Acrobat API参考文件(参见参考书目)详细介绍了JavaScript脚本的内容和效果。表8.90显示了特定于这种类型的动作的动作字典条目。
TABLE 8.90 Additional entries specific to a JavaScript action
KEY	TYPE	VALUE
S	name	(必选) 本字典描述的动作类型;对于JavaScript动作必须是JavaScript。
JS	file specification	(必选) 包含要执行的JavaScript脚本的文本字符串或文本流。
注意:PDFDocEncoding或Unicode encoding(后者由Unicode前缀U+FEFF标识)用于对字符串或流的内容进行编码。(见附录h执行说明126)

为了支持在JavaScript脚本中使用参数化函数调用，PDF文档的名称字典(参见3.6.3节)中的JavaScript条目可以包含一个名称树，将名称字符串映射到文档级的JavaScript动作。当文档被打开时，执行这个名称树中的所有动作，定义文档中其他脚本使用的JavaScript函数。
注意:名称字典中与单个JavaScript动作相关联的名称字符串只是作为组织和打包脚本的方便手段。名称是任意的，不需要与JavaScript名称空间有任何关系。
8.6.5 Named Pages
文档名称字典(参见章节3.6.3“Name Dictionary”)中的可选Pages条目(PDF 1.3)包含一个名称树，该名称树将名称字符串映射到文档中的各个页面。命名页面允许以两种不同的方式引用它：
? 一个导入数据( import-data)动作可以将命名页面添加到要导入FDF的文档中，可以作为页面或按钮外观。
? 由JavaScript动作执行的脚本可以将命名页面作为常规页面添加到当前文档中。
一个对用户可见的命名页面应该留在页面树中(参见章节3.6.2“Page Tree”)，并且在名称字典的Pages树的适当叶节点中应该引用它。如果查看器应用程序不显示该页，则应该从名称字典的Templates树中引用它。这种不可见的页面应该有一个对象类型Template而不是Page，并且不应该有Parent或B条目(参见145页的表3.27)。无论页面是在Pages或Templates树中命名的，还是通过import-data或JavaScript动作添加到文档中的，新副本本身都没有命名。
8.6.6 Forms Data Format
本节介绍表单数据格式(FDF，Forms Data Format)，这是用于交互式表单数据的文件格式(PDF 1.2)。在向服务器提交表单数据、接收响应并将其合并到交互式表单中时，将使用FDF。它还可以用于将表单数据导出到独立文件中，这些文件可以以电子方式存储、传输，并导入回相应的PDF交互式表单中。此外，从PDF 1.3开始，FDF可以用来为注释定义容器，这些注释与它们所应用的PDF文档是分开的。
FDF基于PDF;它使用相同的语法(参见第3.1节“Lexical Conventions”)和基本对象类型(第3.2节“Objects”)，并具有本质上相同的文件结构(第3.4节“File Structure”)。但是，它与PDF有以下不同之处:
?交叉引用表(第3.4.3节“Cross-Reference Table”)是可选的。
?FDF文件不能更新(参见第3.4.5节“Incremental Updates”)。对象的生成号只能为0，并且两个对象不能有相同的对象号。
?文档结构比PDF简单得多，因为FDF文档的主体(body)只包含一个必需的对象。
?流的长度不能由间接对象指定。
?FDF使用MIME内容类型application/vnd.fdf。在Windows和UNIX平台上，FDF文件的扩展名是.FDF;在Mac OS上，它们的文件类型是'FDF '。
